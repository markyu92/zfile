import{a3 as W,r as k,f as o,$ as j,b as u,e as b,w as n,k as l,x as r,a0 as i,y as J,g as w,l as _}from"./index-008199ed.js";/* empty css                *//* empty css                  */import"./tooltip-4ed993c7.js";/* empty css               */import{E as K}from"./image-viewer-3212b1b6.js";import{E as Q}from"./button-30635c71.js";import{E as X,a as Y}from"./radio-7917ad9b.js";import{E as Z,a as h}from"./input-73d413ba.js";import{E as ee}from"./switch-6e3117dc.js";import{_ as oe}from"./admin-form-header-819a5389.js";import{t as te}from"./vue3-clipboard.esm-f774ce6a.js";import{u as le,a as ne}from"./useAdminSetting-8228330a.js";import{f as T,E as C,b as ie}from"./request-7014ab81.js";import{b as F}from"./route-block-83d24a4e.js";import{r as ae}from"./ClipboardDocumentIcon-6b97f9b9.js";import{E as S}from"./index-c0734d0a.js";import{E as re}from"./index-60380bfa.js";import{v as se}from"./directive-20abcd4b.js";import"./index-4ea0a277.js";import"./debounce-3f0c1a7c.js";import"./scroll-374ad3fb.js";import"./_initCloneObject-ffec0ace.js";import"./validator-38288ad7.js";import"./index-8286893b.js";import"./vnode-5e2fd68e.js";const me=()=>T({url:"/admin/2fa/setup",method:"get"}),x=E=>T({url:"/admin/2fa/verify",method:"post",data:E}),de={class:"el-form-item-tips"},ue={class:"text-blue-400"},fe={key:0,class:"w-full"},pe={key:1},ce={key:2,class:"el-form-item-tips"},_e={__name:"index",setup(E){const g=W(),{siteSetting:t,siteSettingReload:B,saveData:f,saveLoading:A}=le(ne),m=k({}),V=()=>{me().then(s=>{m.value=s.data})},I=()=>{x(m.value).then(s=>{C.success("绑定成功"),B()})},L=()=>{S.prompt("请输入双因素认证 APP 中的验证码","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputValidator(s){return!!s},inputErrorMessage:"验证码不能为空."}).then(({value:s})=>{let e={secret:t.value.loginVerifySecret,code:s};x(e).then(()=>{C.success("验证成功")})})},U=()=>{te(m.value.secret).then(()=>{C.success("复制成功")})},R=()=>{t.value.loginVerifySecret="",V()},M=()=>{S.confirm("是否确认取消绑定，确认后将关闭双因素认证。","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"success",callback:s=>{s==="confirm"&&(t.value.loginVerifySecret="",t.value.adminTwoFactorVerify=!1)}})},D=()=>{t.value.adminTwoFactorVerify===!1&&(t.value.loginVerifySecret="",f()),t.value.adminTwoFactorVerify&&!t.value.loginVerifySecret&&V()},P=k(window.location.origin);return(s,e)=>{const q=oe,y=ee,d=Z,v=ie,c=X,z=Y,p=Q,N=K,G=re,H=h,$=se;return o(t)?j((u(),b(H,{key:0,model:o(t),"label-width":o(g).adminForm.labelWidth,"label-position":o(g).adminForm.labelPosition,size:o(g).adminForm.size,"scroll-to-error":"","status-icon":"",class:"z-admin-form"},{default:n(()=>[l(q,{title:"安全设置","sub-title":"此处设置可保护您的站点安全"}),l(d,{label:"是否显示登录入口"},{default:n(()=>[l(y,{modelValue:o(t).showLogin,"onUpdate:modelValue":e[0]||(e[0]=a=>o(t).showLogin=a),onChange:o(f)},null,8,["modelValue","onChange"]),r("div",de,[e[7]||(e[7]=i(" 启用后，会在首页上方工具栏显示后台登录入口，请根据自身情况选择是否启用。(这里只是控制是否显示，直接访问登录页 URL: ")),r("span",ue,J(o(P))+"/login",1),e[8]||(e[8]=i(" 也能访问) "))])]),_:1}),l(d,{label:"匿名用户首页显示"},{default:n(()=>[l(v,{type:"textarea",rows:8,modelValue:o(t).guestIndexHtml,"onUpdate:modelValue":e[1]||(e[1]=a=>o(t).guestIndexHtml=a),onChange:o(f)},null,8,["modelValue","onChange"]),e[9]||(e[9]=r("div",{class:"el-form-item-tips"},[i(" 可填写 html 代码，用于强制匿名用户访问首页时显示的内容，留空则显示默认首页内容。"),r("br"),i(" 如强制跳转到登录页，可填写 "),r("code",{class:"code select-all"},"<script>location.href = '/login';<\/script>")],-1))]),_:1,__:[9]}),l(d,{label:"登录日志模式"},{default:n(()=>[l(z,{modelValue:o(t).loginLogMode,"onUpdate:modelValue":e[2]||(e[2]=a=>o(t).loginLogMode=a),onChange:o(f)},{default:n(()=>[l(c,{value:"off"},{default:n(()=>e[10]||(e[10]=[i("关闭")])),_:1,__:[10]}),l(c,{value:"all"},{default:n(()=>e[11]||(e[11]=[i("全部记录")])),_:1,__:[11]}),l(c,{value:"ignoreSuccessPwd"},{default:n(()=>e[12]||(e[12]=[i("不记录成功密码")])),_:1,__:[12]}),l(c,{value:"ignoreAllPwd"},{default:n(()=>e[13]||(e[13]=[i("不记录密码")])),_:1,__:[13]})]),_:1},8,["modelValue","onChange"]),e[14]||(e[14]=r("div",{class:"el-form-item-tips"}," 启用图片验证码可以防止批量恶意登录，但将密码设置为高强度才是最有效的防止恶意登录的方法。 ",-1))]),_:1,__:[14]}),l(d,{label:"是否启用图片验证码"},{default:n(()=>[l(y,{modelValue:o(t).loginImgVerify,"onUpdate:modelValue":e[3]||(e[3]=a=>o(t).loginImgVerify=a),onChange:o(f)},null,8,["modelValue","onChange"]),e[15]||(e[15]=r("div",{class:"el-form-item-tips"}," 启用图片验证码可以防止批量恶意登录，但将密码设置为高强度才是最有效的防止恶意登录的方法。 ",-1))]),_:1,__:[15]}),l(d,{label:"是否启用管理员双因素认证"},{default:n(()=>[l(y,{modelValue:o(t).adminTwoFactorVerify,"onUpdate:modelValue":e[4]||(e[4]=a=>o(t).adminTwoFactorVerify=a),onChange:D},null,8,["modelValue"]),e[16]||(e[16]=r("div",{class:"el-form-item-tips"},[i(" 双因素认证可完美保护登录认证，可使用任意支持 2FA 认证的软件，如 "),r("b",null,"Google 身份验证器"),i("、"),r("b",null,"Microsoft Authenticator"),i(" 等软件.（仅适用于管理员登录，不影响其他用户登录。） ")],-1))]),_:1,__:[16]}),o(t).adminTwoFactorVerify?(u(),b(d,{key:0,label:"双因素认证密钥"},{default:n(()=>{var a;return[o(t).loginVerifySecret?(u(),w("div",fe,[l(p,{type:"primary",onClick:R},{default:n(()=>e[17]||(e[17]=[i("重新绑定")])),_:1,__:[17]}),l(p,{type:"primary",onClick:M},{default:n(()=>e[18]||(e[18]=[i("取消绑定")])),_:1,__:[18]}),l(p,{type:"primary",onClick:L},{default:n(()=>e[19]||(e[19]=[i("验证绑定")])),_:1,__:[19]})])):(u(),w("div",pe,[l(N,{onClick:V,src:(a=o(m))==null?void 0:a.qrcode},null,8,["src"]),l(v,{readonly:"",modelValue:o(m).secret,"onUpdate:modelValue":e[5]||(e[5]=O=>o(m).secret=O)},{append:n(()=>[l(G,{class:"item",effect:"dark",content:"复制",placement:"bottom"},{default:n(()=>[l(p,{onClick:U,icon:o(ae)},null,8,["icon"])]),_:1})]),_:1},8,["modelValue"])])),o(t).loginVerifySecret?_("",!0):(u(),w("div",ce," 可扫描上方二维码或复制下方密钥到支持双因素认证的软件中添加。 "))]}),_:1})):_("",!0),o(t).adminTwoFactorVerify&&!o(t).loginVerifySecret?(u(),b(d,{key:1,label:"双因素认证验证码"},{default:n(()=>[l(v,{modelValue:o(m).code,"onUpdate:modelValue":e[6]||(e[6]=a=>o(m).code=a)},null,8,["modelValue"]),l(p,{class:"mt-2",onClick:I,type:"primary"},{default:n(()=>e[20]||(e[20]=[i("验证并绑定")])),_:1,__:[20]}),e[21]||(e[21]=r("div",{class:"el-form-item-tips"}," 请绑定双因素认证软件后，输入显示的验证码进行绑定 ",-1))]),_:1,__:[21]})):_("",!0)]),_:1},8,["model","label-width","label-position","size"])),[[$,o(A)]]):_("",!0)}}};typeof F=="function"&&F(_e);export{_e as default};
