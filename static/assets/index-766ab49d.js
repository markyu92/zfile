import{b as v,g as D,x as m,a3 as ie,r as u,o as me,k as t,w as n,f as e,F as pe,G as de,e as U,y as w,al as ce,am as ue,an as _e,a0 as y,$ as fe,h as ge,a2 as he}from"./index-008199ed.js";/* empty css                */import{E as be}from"./dialog-9877e468.js";import"./overlay-64b24548.js";import{E as ke}from"./pagination-27ecf7be.js";/* empty css            */import{E as we,a as ye}from"./select-275ec4c7.js";/* empty css                  *//* empty css               */import{E as ve,a as xe}from"./input-73d413ba.js";/* empty css                     *//* empty css                 */import"./tooltip-4ed993c7.js";import{E as Ee}from"./popconfirm-dacced9d.js";/* empty css                */import{E as ze}from"./button-30635c71.js";import{_ as Ce}from"./open-in-new-ca72a0c9.js";import{_ as Se}from"./baseline-content-copy-92f2b234.js";/* empty css                  */import{E as Le}from"./row-5d0d9aad.js";import{E as Ve,_ as De}from"./col-abb40228.js";import{_ as Re}from"./admin-form-header-819a5389.js";import{d as L}from"./dayjs.min-3b74a704.js";import{t as Te}from"./vue3-clipboard.esm-f774ce6a.js";import{c as B}from"./path-229a1735.js";import $e from"./basic-setting-9a71ddf7.js";import{l as Me}from"./admin-storage-185041e5.js";import{f as x,E as g,b as Ue}from"./request-7014ab81.js";import{b as F}from"./route-block-83d24a4e.js";import{_ as Be}from"./_plugin-vue_export-helper-c27b6911.js";import{r as Fe}from"./MagnifyingGlassIcon-c7e26493.js";import{r as Ie}from"./ArrowPathIcon-f6c0972c.js";import{r as V}from"./TrashIcon-6780b292.js";import{r as Ye}from"./DocumentArrowDownIcon-aca8ea00.js";import{E as I}from"./index-c0734d0a.js";import{E as je}from"./index-9e699d2b.js";import{E as qe,a as He}from"./index-91840f01.js";import{E as Ke}from"./index-60380bfa.js";import{v as Ne}from"./directive-20abcd4b.js";import"./index-8286893b.js";import"./vnode-5e2fd68e.js";import"./index-4ea0a277.js";import"./scroll-374ad3fb.js";import"./refs-9142934b.js";import"./index-0da14aee.js";import"./index-dc7d0be4.js";import"./strings-535b4609.js";import"./debounce-3f0c1a7c.js";import"./index-293710b7.js";import"./_initCloneObject-ffec0ace.js";import"./index-3c7e69e5.js";import"./base-00eb0fe9.js";import"./tab-pane-33044fe9.js";import"./input-number-89d86f4f.js";import"./ArrowUpIcon-0322479b.js";import"./radio-7917ad9b.js";import"./switch-6e3117dc.js";import"./validator-38288ad7.js";import"./useAdminSetting-8228330a.js";import"./useClientInfo-4d899306.js";import"./CheckBadgeIcon-af1628c6.js";function Pe(p,s){return v(),D("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[m("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10.5 6h9.75M10.5 6a1.5 1.5 0 1 1-3 0m3 0a1.5 1.5 0 1 0-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-9.75 0h9.75"})])}const Oe=p=>x({url:"/admin/link/list",method:"get",data:p}),Ae=p=>x({url:"/admin/link/delete/".concat(p),method:"delete"}),Ge=p=>x({url:"/admin/link/delete/batch",method:"post",data:p}),Ze=()=>x({url:"/admin/link/deleteExpireLink",method:"delete"}),Je=p=>x({url:"/admin/link/export",method:"get",data:p,config:{responseType:"blob",showDefaultMsg:!1,responseIntercept:!1}});const Qe={class:"zfile-admin-down-link"},We={class:"flex justify-between"},Xe={class:"flex justify-between space-x-20"},et={class:"text-gray-400"},tt={class:"z-admin-table-tools"},ot={class:"space-x-2"},Y={__name:"index",setup(p){let s=ie();const E=u(!1),j=()=>{E.value=!0},r=u({storageId:null,page:1,limit:10,key:"",url:"",searchDate:[],total:0}),R=u(),q=()=>{R.value.resetFields()},T=u(),H=()=>{Me().then(l=>{T.value=l.data})},$=u(),z=u(!1),d=()=>{z.value=!0,Oe(r.value).then(l=>{$.value=l.data,r.value.total=l.dataCount}).finally(()=>{z.value=!1})};me(()=>{d(),H()});const K=l=>{r.value.limit=l,r.value.page=1,d()},N=l=>{r.value.page=l,d()},P=l=>{Ae(l).then(o=>{g.success("删除成功"),d()})},M=u(),O=()=>{let l=M.value.getSelectionRows();if(l.length===0){g.warning("请至少选择一条数据");return}I.confirm("是否确认删除？","提示",{type:"warning"}).then(()=>{let o=l.map(_=>_.id);Ge({ids:o}).then(_=>{g.success("删除成功"),d()})})},A=()=>{I.confirm("是否确认删除过期短链并级联删除其下载日志？","提示",{type:"warning"}).then(()=>{Ze().then(l=>{g.success("成功删除 ".concat(l.data," 条.")),d()})})},G=()=>{const l=je.service({fullscreen:!0,lock:!0,text:"下载中...",background:"rgba(0, 0, 0, 0.5)"});Je(r.value).then(o=>{const{data:_,headers:C}=o,S="ZFile 短链导出 - ".concat(L().format("YYYY-MM-DD HH:mm:ss"),".xlsx"),f=new Blob([_],{type:C["content-type"]});let i=document.createElement("a"),h=window.URL.createObjectURL(f);i.href=h,i.download=decodeURI(S),i.style.display="none",document.body.appendChild(i),i.click(),i.parentNode.removeChild(i),window.URL.revokeObjectURL(h)}).catch(()=>{g.error("下载失败.")}).finally(()=>{l.close()})};let Z=l=>{Te(B(s.serverAddress,"s",l)).then(()=>{g.success("复制成功")})},J=l=>{window.open(B(s.serverAddress,"s",l))};return(l,o)=>{const _=Re,C=we,S=ye,f=ve,i=Ve,h=Ue,Q=De,b=ze,W=Le,X=xe,c=qe,ee=Ke,te=Se,oe=Ce,ae=Ee,ne=He,le=ke,re=be,se=Ne;return v(),D("div",Qe,[t(_,{"hide-bottom-border":""},{title:n(()=>[m("div",We,[o[6]||(o[6]=m("span",null,"短链管理",-1)),m("span",{onClick:j},[t(e(Pe),{class:"h-5 w-5 text-blue-500 cursor-pointer"})])])]),_:1}),t(X,{inline:"",class:"z-admin-search-from",size:e(s).adminSearch.size,"label-width":"80",ref_key:"searchFormRef",ref:R,"label-position":e(s).adminSearch.labelPosition,model:e(r)},{default:n(()=>[t(W,{class:"z-admin-search-from-row",gutter:20},{default:n(()=>[t(i,{span:e(s).adminSearch.spanSize},{default:n(()=>[t(f,{label:"存储源",prop:"storageId"},{default:n(()=>[t(S,{modelValue:e(r).storageId,"onUpdate:modelValue":o[0]||(o[0]=a=>e(r).storageId=a),placeholder:"请选择存储源",clearable:""},{default:n(()=>[(v(!0),D(pe,null,de(e(T),a=>(v(),U(C,{key:a.id,label:a.name,value:a.id},{default:n(()=>[m("div",Xe,[m("span",null,w(a.name),1),m("span",et,w(a.type.description),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["span"]),t(i,{span:e(s).adminSearch.spanSize},{default:n(()=>[t(f,{label:"文件名",prop:"url"},{default:n(()=>[t(h,{modelValue:e(r).url,"onUpdate:modelValue":o[1]||(o[1]=a=>e(r).url=a),clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["span"]),t(i,{span:e(s).adminSearch.spanSize},{default:n(()=>[t(f,{label:"短链 Key",prop:"key"},{default:n(()=>[t(h,{modelValue:e(r).key,"onUpdate:modelValue":o[2]||(o[2]=a=>e(r).key=a),clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["span"]),t(i,{span:e(s).adminSearch.spanSize},{default:n(()=>[t(f,{label:"创建时间",prop:"searchDate"},{default:n(()=>[t(Q,{modelValue:e(r).searchDate,"onUpdate:modelValue":o[3]||(o[3]=a=>e(r).searchDate=a),shortcuts:e(ce),type:"daterange","value-format":e(ue),"default-time":e(_e),"range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间"},null,8,["modelValue","shortcuts","value-format","default-time"])]),_:1})]),_:1},8,["span"]),t(i,{span:e(s).adminSearch.spanSize},{default:n(()=>[t(b,{type:"primary",icon:e(Fe),loading:e(z),onClick:d},{default:n(()=>o[7]||(o[7]=[y(" 查询 ")])),_:1,__:[7]},8,["icon","loading"]),t(b,{icon:e(Ie),onClick:q},{default:n(()=>o[8]||(o[8]=[y("重置")])),_:1,__:[8]},8,["icon"])]),_:1},8,["span"])]),_:1})]),_:1},8,["size","label-position","model"]),m("div",tt,[t(b,{size:e(s).adminTable.size,onClick:O,icon:e(V),type:"danger"},{default:n(()=>o[9]||(o[9]=[y(" 批量删除 ")])),_:1,__:[9]},8,["size","icon"]),t(b,{size:e(s).adminTable.size,onClick:A,icon:e(V),type:"danger"},{default:n(()=>o[10]||(o[10]=[y(" 批量删除过期短链 ")])),_:1,__:[10]},8,["size","icon"]),t(b,{size:e(s).adminTable.size,onClick:G,icon:e(Ye),type:"primary"},{default:n(()=>o[11]||(o[11]=[y(" 导出短链 ")])),_:1,__:[11]},8,["size","icon"])]),fe((v(),U(ne,{border:"",data:e($),size:e(s).adminTable.size,ref_key:"tableRef",ref:M},{default:n(()=>[t(c,{type:"selection",width:"55"}),t(c,{width:"120",label:"存储源名称"},{default:n(a=>{var k;return[t(ee,{content:(k=a.row.storageType)==null?void 0:k.description,placement:"right"},{default:n(()=>[m("span",null,w(a.row.storageName),1)]),_:2},1032,["content"])]}),_:1}),t(c,{width:"150",prop:"shortKey",label:"短链 Key"},{default:n(a=>[m("div",ot,[m("span",null,w(a.row.shortKey),1),t(te,{onClick:k=>e(Z)(a.row.shortKey),class:"inline cursor-pointer"},null,8,["onClick"]),t(oe,{onClick:k=>e(J)(a.row.shortKey),class:"inline cursor-pointer text-blue-500 text-sm"},null,8,["onClick"])])]),_:1}),t(c,{"show-overflow-tooltip":"",prop:"url",label:"路径"}),t(c,{width:"180",prop:"createDate",label:"创建时间"}),t(c,{width:"180",prop:"expireDate",label:"过期时间"},{default:n(a=>[m("div",{class:ge(e(L)(a.row.expireDate).isBefore(e(L)().format("YYYY-MM-DD HH:mm"))?"text-red-500":"")},[m("span",null,w(a.row.expireDate),1)],2)]),_:1}),t(c,{width:"60",label:"操作"},{default:n(a=>[t(ae,{title:"是否确认删除?",onConfirm:k=>P(a.row.id)},{reference:n(()=>[t(e(V),{class:"z-btn-danger"})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data","size"])),[[se,e(z)]]),t(le,{class:"mt-3","page-size":e(r).limit,background:"",layout:e(s).adminTable.pager.layout,size:e(s).adminTable.pager.size,"pager-count":e(s).adminTable.pager.pagerCount,onCurrentChange:N,onSizeChange:K,"current-page":e(r).page,"onUpdate:currentPage":o[4]||(o[4]=a=>e(r).page=a),"default-current-page":10,"page-sizes":[10,50,100,200,1e3,99999999],total:e(r).total},null,8,["page-size","layout","size","pager-count","current-page","total"]),t(re,{modelValue:e(E),"onUpdate:modelValue":o[5]||(o[5]=a=>he(E)?E.value=a:null),"destroy-on-close":!0,title:"直链设置",class:"zfile-admin-down-link-dialog",draggable:"",top:"5vh",width:"80%"},{default:n(()=>[t($e)]),_:1},8,["modelValue"])])}}};typeof F=="function"&&F(Y);const po=Be(Y,[["__scopeId","data-v-333f6d59"]]);export{po as default};
