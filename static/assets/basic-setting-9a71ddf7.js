import{b as p,g as c,x as t,r as k,B as le,f as l,F as Z,G as H,k as n,aB as te,w as s,a8 as G,e as z,h as O,$ as y,a1 as C,y as f,l as I,aC as oe,a3 as ne,a2 as M,a0 as i,aD as se}from"./index-008199ed.js";/* empty css                */import{E as ae}from"./dialog-9877e468.js";import"./overlay-64b24548.js";/* empty css                     *//* empty css                 */import"./tooltip-4ed993c7.js";/* empty css               *//* empty css                  *//* empty css            *//* empty css                  */import{E as ie,a as re}from"./tab-pane-33044fe9.js";import{E as de,a as ue}from"./select-275ec4c7.js";import{E as me,a as pe}from"./input-73d413ba.js";import{E as X}from"./input-number-89d86f4f.js";import{r as fe,a as ve}from"./ArrowUpIcon-0322479b.js";import{E as _e}from"./button-30635c71.js";import{E as be,a as ce}from"./radio-7917ad9b.js";import{E as ge}from"./switch-6e3117dc.js";import{g as we,u as xe,b as Ve,t as ke}from"./useAdminSetting-8228330a.js";import{e as ye}from"./admin-storage-185041e5.js";import{u as Le}from"./useClientInfo-4d899306.js";import{_ as Ee}from"./_plugin-vue_export-helper-c27b6911.js";import{d as Ce,c as Ie,b as he}from"./request-7014ab81.js";import{r as Pe}from"./CheckBadgeIcon-af1628c6.js";import{E as $e,a as Te}from"./index-91840f01.js";import{v as Se}from"./directive-20abcd4b.js";import"./index-8286893b.js";import"./vnode-5e2fd68e.js";import"./index-4ea0a277.js";import"./scroll-374ad3fb.js";import"./refs-9142934b.js";import"./strings-535b4609.js";import"./index-60380bfa.js";import"./index-0da14aee.js";import"./index-dc7d0be4.js";import"./debounce-3f0c1a7c.js";import"./index-293710b7.js";import"./_initCloneObject-ffec0ace.js";import"./index-3c7e69e5.js";import"./validator-38288ad7.js";function ze(x,u){return p(),c("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"fill-rule":"evenodd",d:"M4.755 10.059a7.5 7.5 0 0 1 12.548-3.364l1.903 1.903h-3.183a.75.75 0 1 0 0 1.5h4.992a.75.75 0 0 0 .75-.75V4.356a.75.75 0 0 0-1.5 0v3.18l-1.9-1.9A9 9 0 0 0 3.306 9.67a.75.75 0 1 0 1.45.388Zm15.408 3.352a.75.75 0 0 0-.919.53 7.5 7.5 0 0 1-12.548 3.364l-1.902-1.903h3.183a.75.75 0 0 0 0-1.5H2.984a.75.75 0 0 0-.75.75v4.992a.75.75 0 0 0 1.5 0v-3.18l1.9 1.9a9 9 0 0 0 15.059-4.035.75.75 0 0 0-.53-.918Z","clip-rule":"evenodd"})])}function Re(x,u){return p(),c("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{d:"M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"}),t("path",{"fill-rule":"evenodd",d:"M1.323 11.447C2.811 6.976 7.028 3.75 12.001 3.75c4.97 0 9.185 3.223 10.675 7.69.12.362.12.752 0 1.113-1.487 4.471-5.705 7.697-10.677 7.697-4.97 0-9.186-3.223-10.675-7.69a1.762 1.762 0 0 1 0-1.113ZM17.25 12a5.25 5.25 0 1 1-10.5 0 5.25 5.25 0 0 1 10.5 0Z","clip-rule":"evenodd"})])}function Ue(x,u){return p(),c("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"fill-rule":"evenodd",d:"M4.25 12a.75.75 0 0 1 .75-.75h14a.75.75 0 0 1 0 1.5H5a.75.75 0 0 1-.75-.75Z","clip-rule":"evenodd"})])}function Fe(x,u){return p(),c("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"fill-rule":"evenodd",d:"M12 3.75a.75.75 0 0 1 .75.75v6.75h6.75a.75.75 0 0 1 0 1.5h-6.75v6.75a.75.75 0 0 1-1.5 0v-6.75H4.5a.75.75 0 0 1 0-1.5h6.75V4.5a.75.75 0 0 1 .75-.75Z","clip-rule":"evenodd"})])}const De={key:0,class:"flex flex-wrap w-full"},Ae={class:"flex items-center"},Be=["onClick"],Me=["onClick"],Ze=["onClick"],Ne=["onClick"],qe={class:"ml-3 text-gray-500"},He={__name:"TimePicker",props:{modelValue:{type:Array,required:!0}},emits:["update:modelValue"],setup(x,{emit:u}){const L=x,o=k(L.modelValue?L.modelValue:[{value:"1",unit:"d",second:86400}]),R=u;le(o,r=>{R("update:modelValue",r)},{deep:!0});const h=r=>{o.value.splice(r,0,{value:1,unit:"s",second:1})},U=r=>{if(r===0)return;const v=o.value[r];o.value.splice(r,1),o.value.splice(r-1,0,v)},P=r=>{if(r===o.value.length-1)return;const v=o.value[r];o.value.splice(r,1),o.value.splice(r+1,0,v)},$=r=>{o.value.splice(r,1)},E=r=>{r.seconds=oe(r)};return(r,v)=>{const g=X,T=de,F=ue;return l(o)?(p(),c("div",De,[(p(!0),c(Z,null,H(L.modelValue,(m,w)=>(p(),c("div",{key:m.second,class:"mb-4 w-full"},[t("div",Ae,[n(g,{class:"min-w-[100px]",modelValue:m.value,"onUpdate:modelValue":d=>m.value=d,min:1,max:l(te)(m.unit),onChange:d=>E(m),disabled:m.unit==="forever"},null,8,["modelValue","onUpdate:modelValue","max","onChange","disabled"]),n(F,{onChange:d=>E(m),modelValue:m.unit,"onUpdate:modelValue":d=>m.unit=d,class:"ml-1 min-w-[75px]"},{default:s(()=>[(p(!0),c(Z,null,H(("constant"in r?r.constant:l(G)).timeUnitArr,d=>(p(),z(T,{key:d.value,label:d.label,value:d.value},null,8,["label","value"]))),128))]),_:2},1032,["onChange","modelValue","onUpdate:modelValue"]),t("button",{class:O([w===0?"invisible":"visible","ml-2 py-2 px-2 rounded-md bg-blue-500 text-white hover:bg-blue-600 focus:bg-blue-700 focus:outline-none font-bold"]),type:"button",onClick:d=>U(w)},[n(l(fe),{class:"h-4"})],10,Be),y(t("button",{type:"button",onClick:d=>P(w),class:"ml-2 py-2 px-2 rounded-md bg-blue-500 text-white hover:bg-blue-600 focus:bg-blue-700 focus:outline-none font-bold"},[n(l(ve),{class:"h-4"})],8,Me),[[C,w!==l(o).length-1]]),y(t("button",{type:"button",onClick:d=>h(w+1),class:"ml-2 py-2 px-2 rounded-md bg-blue-500 text-white hover:bg-blue-600 focus:bg-blue-700 focus:outline-none font-bold"},[n(l(Fe),{class:"h-4"})],8,Ze),[[C,w===l(o).length-1]]),y(t("button",{type:"button",onClick:d=>$(w),class:"ml-2 py-2 px-2 rounded-md bg-red-500 text-white hover:bg-red-600 focus:bg-red-700 focus:outline-none font-bold"},[n(l(Ue),{class:"h-4"})],8,Ne),[[C,l(o).length>1]])]),t("small",qe,f(m.formatted),1)]))),128))])):I("",!0)}}},W=k([]);function We(){return{linkLimitInfoList:W,loadLinkLimitInfo:()=>{we().then(u=>{W.value=u.data})}}}const Ge={class:"zfile-admin-down-link-body"},Oe={class:"el-form-item-tips"},Xe={key:0},Ke={key:1},je={class:"mt-4"},Je={class:"text-blue-500"},Qe={class:"el-form-item-tips"},Ye={class:"text-blue-400 select-all"},el={class:"el-form-item-tips"},ll={class:"select-all"},tl={class:"text-red-400 font-bold"},ol={class:"text-blue-400"},nl={class:"text-blue-400"},sl={class:"text-blue-400"},al={class:"text-center text-gray-400"},il={class:"dialog-footer"},rl={__name:"basic-setting",setup(x){const u=ne(),L=k(),{siteSetting:o,saveData:R,saveLoading:h}=xe(Ve,L),{clientIp:U}=Le(),{loadLinkLimitInfo:P,linkLimitInfoList:$}=We(),E=k("a"),r={directLinkPrefix:[{required:!0,message:"直链前缀不能为空",trigger:"change"},{validator:(d,e,_)=>{if(e==null||e===""){_();return}if(G.systemNames.includes(e)){_(new Error("不可占用系统级名称，请修改。"));return}if(!/^[\w\-]+$/.test(e)){_(new Error("只允许使用字母、数字、下划线、横杠。"));return}ye({storageKey:e}).then(V=>{V.data?_(new Error("不可与存储源别名重复，请修改。")):_()})}}]},v=k(""),g=k(null),T=se(()=>{var e;let d={ruleType:"antPath",rules:(e=o==null?void 0:o.value)==null?void 0:e.refererValue,testValue:v.value};if(!d.rules||!d.testValue){g.value!==null&&(g.value=null);return}ke(d).then(_=>{g.value=_.data})},250),F=()=>u.serverAddress.endsWith("/")?u.serverAddress:u.serverAddress+"/",m=k(!1),w=()=>{P(),m.value=!0};return(d,e)=>{const _=ge,b=me,V=be,N=ce,D=he,q=X,A=_e,B=ie,K=He,j=re,J=pe,S=$e,Q=Te,Y=ae,ee=Se;return p(),c(Z,null,[t("div",Ge,[l(o)?y((p(),z(J,{key:0,model:l(o),rules:r,"label-width":l(u).adminForm.labelWidth,"label-position":l(u).adminForm.labelPosition,size:l(u).adminForm.size,"status-icon":"",class:"z-admin-form",ref_key:"settingFormRef",ref:L,"element-loading-text":"保存中..."},{default:s(()=>[n(j,{modelValue:l(E),"onUpdate:modelValue":e[11]||(e[11]=a=>M(E)?E.value=a:null)},{default:s(()=>[n(B,{label:"通用设置",name:"a"},{default:s(()=>[n(b,{label:"记录下载日志"},{default:s(()=>[n(_,{modelValue:l(o).recordDownloadLog,"onUpdate:modelValue":e[0]||(e[0]=a=>l(o).recordDownloadLog=a)},null,8,["modelValue"]),e[15]||(e[15]=t("div",{class:"el-form-item-tips"}," 是否记录直/短链下载日志 ",-1))]),_:1,__:[15]}),n(b,{label:"Referer 防盗链"},{default:s(()=>[n(N,{modelValue:l(o).refererType,"onUpdate:modelValue":e[1]||(e[1]=a=>l(o).refererType=a)},{default:s(()=>[n(V,{value:"off"},{default:s(()=>e[16]||(e[16]=[i("不启用 Referer 防盗链")])),_:1,__:[16]}),n(V,{value:"white_list"},{default:s(()=>e[17]||(e[17]=[i("启用白名单")])),_:1,__:[17]}),n(V,{value:"black_list"},{default:s(()=>e[18]||(e[18]=[i("启用黑名单")])),_:1,__:[18]})]),_:1},8,["modelValue"]),e[19]||(e[19]=t("div",{class:"el-form-item-tips"}," 防盗链支持访问文件直链或短链时校验，如用户直接访问直链跳转后的存储源原始链接，无法进行校验和拦截。 ",-1))]),_:1,__:[19]}),y(n(b,{label:"Referer 配置"},{default:s(()=>[n(N,{modelValue:l(o).refererAllowEmpty,"onUpdate:modelValue":e[2]||(e[2]=a=>l(o).refererAllowEmpty=a)},{default:s(()=>[n(V,{value:!0},{default:s(()=>e[20]||(e[20]=[i("允许 Referer 为空")])),_:1,__:[20]}),n(V,{value:!1},{default:s(()=>e[21]||(e[21]=[i("禁止 Referer 为空")])),_:1,__:[21]})]),_:1},8,["modelValue"])]),_:1},512),[[C,l(o).refererType!=="off"]]),y(n(b,{label:l(o).refererType==="white_list"?"白名单":"黑名单"},{default:s(()=>[n(D,{type:"textarea",onInput:l(T),rows:6,modelValue:l(o).refererValue,"onUpdate:modelValue":e[3]||(e[3]=a=>l(o).refererValue=a)},null,8,["onInput","modelValue"]),t("div",Oe,[e[24]||(e[24]=i(" 每行输入一个域名，如： ")),e[25]||(e[25]=t("ul",null,[t("li",null,[i("限制泛域名 "),t("span",{class:"text-red-400"},"http 协议"),i(" 全部子目录可访问： "),t("div",{class:"inline select-all font-bold"},[t("span",{class:"text-red-400"},"http://"),i("*example.com/** ")])]),t("li",null,[i("限制泛域名 "),t("span",{class:"text-red-400"},"https 协议"),i(" 全部子目录可访问： "),t("div",{class:"inline select-all font-bold"},[t("span",{class:"text-red-400"},"https://"),i("*example.com/** ")])]),t("li",null,[i("限制泛域名 "),t("span",{class:"text-red-400"},"全部协议"),i(" 全部子目录可访问： "),t("div",{class:"inline select-all font-bold"},[t("span",{class:"text-red-400"},"*://"),i("*example.com/** ")])])],-1)),l(o).refererType==="white_list"?(p(),c("div",Xe," 每行输入一个域名，需要写协议头支持 * 通配符，如白名单 http://*zfile.vip 将只允许 http://zfile.vip、http://www.zfile.vip、http://demo.zfile.vip 等网站访问。 ")):I("",!0),l(o).refererType==="black_list"?(p(),c("div",Ke," 每行输入一个域名，需要写协议头，支持 * 通配符，如黑名单 http://*zfile.vip 将禁止所有如 http://zfile.vip、http://www.zfile.vip、http://demo.zfile.vip 等网站访问。 ")):I("",!0),t("div",je,[e[23]||(e[23]=t("div",null,"可在下方输入你要测试的地址，应包含协议和路径（如 http://example.com/1.html）",-1)),n(D,{onInput:l(T),modelValue:l(v),"onUpdate:modelValue":e[4]||(e[4]=a=>M(v)?v.value=a:null)},{suffix:s(()=>[l(v)&&l(g)===null?(p(),z(l(Ce),{key:0,class:"w-4 text-red-500"})):l(v)&&l(g)!==null?(p(),z(l(Ie),{key:1,class:"w-4 text-green-500"})):I("",!0)]),_:1},8,["onInput","modelValue"]),y(t("div",null,[e[22]||(e[22]=i("输入的测试地址匹配了规则: ")),t("span",Je,f(l(g)),1)],512),[[C,l(g)]])])])]),_:1},8,["label"]),[[C,l(o).refererType!=="off"]]),n(b,{label:"下载频率限制"},{default:s(()=>[t("div",null,[e[27]||(e[27]=t("span",null,"单 IP",-1)),n(q,{modelValue:l(o).linkLimitSecond,"onUpdate:modelValue":e[5]||(e[5]=a=>l(o).linkLimitSecond=a),min:0,max:86400,step:1,size:"small",class:"mx-2"},null,8,["modelValue"]),e[28]||(e[28]=t("span",null,"秒内允许下载",-1)),n(q,{modelValue:l(o).linkDownloadLimit,"onUpdate:modelValue":e[6]||(e[6]=a=>l(o).linkDownloadLimit=a),min:0,max:9999999,step:1,size:"small",class:"mx-2"},null,8,["modelValue"]),e[29]||(e[29]=t("span",null,"次",-1)),n(A,{icon:l(Re),size:"small",type:"primary",class:"ml-2",onClick:w},{default:s(()=>e[26]||(e[26]=[i("统计信息 ")])),_:1,__:[26]},8,["icon"])]),t("div",Qe,[e[32]||(e[32]=t("span",null,"用来防止恶意下载，单 IP N 秒内只允许访问 M 次直链，如其中一个为 0 则不做任何限制.",-1)),e[33]||(e[33]=t("br",null,null,-1)),e[34]||(e[34]=t("br",null,null,-1)),e[35]||(e[35]=t("span",null,"注意：此功能对直链、短链都有效，且共享限制次数。但直链/短链跳转后的实际下载链接无法限制，因为那些链接不经过 ZFile.",-1)),e[36]||(e[36]=t("br",null,null,-1)),e[37]||(e[37]=t("br",null,null,-1)),t("span",null,[e[30]||(e[30]=i('注意：如果你使用了反向代理，而不是直接访问的 ZFile 端口, 那你需要在反向代理处设置以下请求头为用户真实 IP："X-Forwarded-For", "X-Real-IP", "Proxy-Client-IP", "WL-Proxy-Client-IP", "HTTP_CLIENT_IP", "HTTP_X_FORWARDED_FOR"，不然不论谁访问 ZFile 都只能获取到反代服务器的 IP，同服务器一般是获取到 127.0.0.1 或 localhost, 这样此功能就无法正常使用!!! (辅助信息: 系统获取到您当前 IP 为 ')),t("span",Ye,f(l(U)),1),e[31]||(e[31]=i(")"))])])]),_:1})]),_:1}),n(B,{label:"直链设置",name:"b"},{default:s(()=>[n(b,{label:"是否允许使用直链（路径）"},{default:s(()=>[n(_,{modelValue:l(o).showPathLink,"onUpdate:modelValue":e[7]||(e[7]=a=>l(o).showPathLink=a)},null,8,["modelValue"]),e[38]||(e[38]=t("div",{class:"el-form-item-tips"},[i(" 全局控制是否显示获取直链按钮及是否允许使用直链进行下载，"),t("span",{class:"font-bold"},"优先级大于存储源权限设置.")],-1))]),_:1,__:[38]}),n(b,{label:"直链地址前缀",prop:"directLinkPrefix"},{default:s(()=>[n(D,{modelValue:l(o).directLinkPrefix,"onUpdate:modelValue":e[8]||(e[8]=a=>l(o).directLinkPrefix=a)},null,8,["modelValue"]),t("div",el,[e[40]||(e[40]=i(" 直链地址前缀, 如 ")),t("span",ll,[i(f(F()),1),t("span",tl,f(l(o).directLinkPrefix),1),e[39]||(e[39]=i("/path/filename"))])])]),_:1})]),_:1}),n(B,{label:"短链设置",name:"c"},{default:s(()=>[n(b,{label:"是否允许使用短链"},{default:s(()=>[n(_,{modelValue:l(o).showShortLink,"onUpdate:modelValue":e[9]||(e[9]=a=>l(o).showShortLink=a)},null,8,["modelValue"]),e[41]||(e[41]=t("div",{class:"el-form-item-tips"},[i(" 全局控制是否显示生成短链按钮及是否允许使用已存在的短链进行下载，"),t("span",{class:"font-bold"},"优先级大于存储源权限设置.")],-1))]),_:1,__:[41]}),n(b,{label:"短链有效期"},{default:s(()=>[n(K,{modelValue:l(o).linkExpireTimes,"onUpdate:modelValue":e[10]||(e[10]=a=>l(o).linkExpireTimes=a)},null,8,["modelValue"]),e[42]||(e[42]=t("div",{class:"el-form-item-tips"}," 控制生成短链的有效期 ",-1))]),_:1,__:[42]})]),_:1})]),_:1},8,["modelValue"]),n(b,{"label-width":l(u).adminForm.labelWidth,class:"admin-from-footer"},{default:s(()=>[n(A,{class:"ml-auto",type:"primary",size:l(u).adminForm.size,icon:l(Pe),loading:l(h),onClick:e[12]||(e[12]=a=>l(R)(!0))},{default:s(()=>e[43]||(e[43]=[i(" 保存设置 ")])),_:1,__:[43]},8,["size","icon","loading"])]),_:1},8,["label-width"])]),_:1},8,["model","label-width","label-position","size"])),[[ee,l(h)]]):I("",!0)]),n(Y,{"append-to-body":"",title:"统计信息",modelValue:l(m),"onUpdate:modelValue":e[14]||(e[14]=a=>M(m)?m.value=a:null),width:"80%",top:"5vh"},{footer:s(()=>[t("span",il,[n(A,{onClick:e[13]||(e[13]=a=>m.value=!1)},{default:s(()=>e[47]||(e[47]=[i("关 闭")])),_:1,__:[47]})])]),default:s(()=>[t("span",null,[e[44]||(e[44]=i("当前系统限制单 IP ")),t("span",ol,f(l(o).linkLimitSecond),1),e[45]||(e[45]=i(" 秒内下载 ")),t("span",nl,f(l(o).linkDownloadLimit),1),e[46]||(e[46]=i(" 次，已记录 ")),t("span",sl,f(l($).length),1),i(" 条记录。（超出 "+f(l(o).linkLimitSecond)+" 秒的记录将被清除。）",1)]),n(l(ze),{onClick:l(P),class:"w-4 inline-block cursor-pointer hover:text-blue-400"},null,8,["onClick"]),n(Q,{data:l($),"max-height":"400px"},{empty:s(()=>[t("div",al,f(l(o).linkLimitSecond)+" 秒内没有任何下载记录",1)]),default:s(()=>[n(S,{prop:"key",label:"IP"}),n(S,{prop:"count",label:"次数"},{default:s(({row:a})=>[t("div",{class:O([a.value>l(o).linkDownloadLimit?"text-red-500":""])},f(a.value),3)]),_:1}),n(S,{prop:"ttl",label:"统计区间"},{default:s(({row:a})=>[i(f(a.ttl/1e3)+" 秒 ",1)]),_:1}),n(S,{prop:"expiredTime",label:"过期时间"})]),_:1},8,["data"])]),_:1},8,["modelValue"])],64)}}},jl=Ee(rl,[["__scopeId","data-v-3f4df69f"]]);export{jl as default};
