import{m as Ce,u as V,h as Pe}from"./request-7014ab81.js";import{aL as Ae,aM as X,p as Le,q,C as ve,d as ae,aN as we,M as ze,a as Ee,aO as Me,r as L,aP as Be,s as Ye,c as p,B as me,ad as _e,o as Se,b as h,e as pe,w as g,k as d,T as Ve,x as I,h as m,f as e,n as ye,i as Xe,l as C,g as z,F as Z,j as x,a0 as Fe,y as Ne,z as De,G as He,aQ as je,m as Oe,ay as Ke,aR as We,K as qe,H as be,W as Ze,I as ke,aS as Ie,aT as Ge,v as Qe,u as Ue}from"./index-008199ed.js";import{a as Je,c as et}from"./button-30635c71.js";import{K as tt,L as at,E as $,e as st,n as nt,o as ot,M as lt,z as rt,N as it,O as ct,_ as Te,A as Y}from"./index-4ea0a277.js";import{d as ut}from"./debounce-3f0c1a7c.js";import{g as dt}from"./scroll-374ad3fb.js";var ft="Expected a function";function fe(s,f,n){var o=!0,r=!0;if(typeof s!="function")throw new TypeError(ft);return Ae(n)&&(o="leading"in n?!!n.leading:o,r="trailing"in n?!!n.trailing:r),ut(s,f,{leading:o,maxWait:f,trailing:r})}const vt=(s,f)=>{if(!X||!s||!f)return!1;const n=s.getBoundingClientRect();let o;return f instanceof Element?o=f.getBoundingClientRect():o={top:0,right:window.innerWidth,bottom:window.innerHeight,left:0},n.top<o.bottom&&n.bottom>o.top&&n.right>o.left&&n.left<o.right},Tt=s=>{let f,n;return s.type==="touchend"?(n=s.changedTouches[0].clientY,f=s.changedTouches[0].clientX):s.type.startsWith("touch")?(n=s.touches[0].clientY,f=s.touches[0].clientX):(n=s.clientY,f=s.clientX),{clientX:f,clientY:n}},mt=Le({urlList:{type:q(Array),default:()=>Ce([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:{type:Boolean,default:!1},crossorigin:{type:q(String)}}),pt={close:()=>!0,switch:s=>ve(s),rotate:s=>ve(s)},gt=ae({name:"ElImageViewer"}),ht=ae({...gt,props:mt,emits:pt,setup(s,{expose:f,emit:n}){var o;const r=s,w={CONTAIN:{name:"contain",icon:we(tt)},ORIGINAL:{name:"original",icon:we(at)}};let F,D="";const{t:se}=ze(),l=Ee("image-viewer"),{nextZIndex:P}=Me(),E=L(),B=L([]),A=Be(),v=L(!0),y=L(r.initialIndex),O=Ye(w.CONTAIN),c=L({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),ne=L((o=r.zIndex)!=null?o:P()),H=p(()=>{const{urlList:t}=r;return t.length<=1}),G=p(()=>y.value===0),j=p(()=>y.value===r.urlList.length-1),K=p(()=>r.urlList[y.value]),oe=p(()=>[l.e("btn"),l.e("prev"),l.is("disabled",!r.infinite&&G.value)]),le=p(()=>[l.e("btn"),l.e("next"),l.is("disabled",!r.infinite&&j.value)]),Q=p(()=>{const{scale:t,deg:u,offsetX:i,offsetY:k,enableTransition:S}=c.value;let N=i/t,R=k/t;const W=u*Math.PI/180,ge=Math.cos(W),he=Math.sin(W);N=N*ge+R*he,R=R*ge-i/t*he;const de={transform:"scale(".concat(t,") rotate(").concat(u,"deg) translate(").concat(N,"px, ").concat(R,"px)"),transition:S?"transform .3s":""};return O.value.name===w.CONTAIN.name&&(de.maxWidth=de.maxHeight="100%"),de}),U=p(()=>"".concat(y.value+1," / ").concat(r.urlList.length));function M(){ee(),F==null||F(),document.body.style.overflow=D,n("close")}function J(){const t=fe(i=>{switch(i.code){case Y.esc:r.closeOnPressEscape&&M();break;case Y.space:_();break;case Y.left:ce();break;case Y.up:T("zoomIn");break;case Y.right:ue();break;case Y.down:T("zoomOut");break}}),u=fe(i=>{const k=i.deltaY||i.deltaX;T(k<0?"zoomIn":"zoomOut",{zoomRate:r.zoomRate,enableTransition:!1})});A.run(()=>{V(document,"keydown",t),V(document,"wheel",u)})}function ee(){A.stop()}function re(){v.value=!1}function ie(t){v.value=!1,t.target.alt=se("el.image.error")}function a(t){if(v.value||t.button!==0||!E.value)return;c.value.enableTransition=!1;const{offsetX:u,offsetY:i}=c.value,k=t.pageX,S=t.pageY,N=fe(W=>{c.value={...c.value,offsetX:u+W.pageX-k,offsetY:i+W.pageY-S}}),R=V(document,"mousemove",N);V(document,"mouseup",()=>{R()}),t.preventDefault()}function b(){c.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function _(){if(v.value)return;const t=je(w),u=Object.values(w),i=O.value.name,S=(u.findIndex(N=>N.name===i)+1)%t.length;O.value=w[t[S]],b()}function te(t){const u=r.urlList.length;y.value=(t+u)%u}function ce(){G.value&&!r.infinite||te(y.value-1)}function ue(){j.value&&!r.infinite||te(y.value+1)}function T(t,u={}){if(v.value)return;const{minScale:i,maxScale:k}=r,{zoomRate:S,rotateDeg:N,enableTransition:R}={zoomRate:r.zoomRate,rotateDeg:90,enableTransition:!0,...u};switch(t){case"zoomOut":c.value.scale>i&&(c.value.scale=Number.parseFloat((c.value.scale/S).toFixed(3)));break;case"zoomIn":c.value.scale<k&&(c.value.scale=Number.parseFloat((c.value.scale*S).toFixed(3)));break;case"clockwise":c.value.deg+=N,n("rotate",c.value.deg);break;case"anticlockwise":c.value.deg-=N,n("rotate",c.value.deg);break}c.value.enableTransition=R}function Re(t){var u;((u=t.detail)==null?void 0:u.focusReason)==="pointer"&&t.preventDefault()}function $e(){r.closeOnPressEscape&&M()}function xe(t){if(t.ctrlKey){if(t.deltaY<0)return t.preventDefault(),!1;if(t.deltaY>0)return t.preventDefault(),!1}}return me(K,()=>{_e(()=>{const t=B.value[0];t!=null&&t.complete||(v.value=!0)})}),me(y,t=>{b(),n("switch",t)}),Se(()=>{J(),F=V("wheel",xe,{passive:!1}),D=document.body.style.overflow,document.body.style.overflow="hidden"}),f({setActiveItem:te}),(t,u)=>(h(),pe(e(et),{to:"body",disabled:!t.teleported},{default:g(()=>[d(Ve,{name:"viewer-fade",appear:""},{default:g(()=>[I("div",{ref_key:"wrapper",ref:E,tabindex:-1,class:m(e(l).e("wrapper")),style:ye({zIndex:ne.value})},[d(e(Je),{loop:"",trapped:"","focus-trap-el":E.value,"focus-start-el":"container",onFocusoutPrevented:Re,onReleaseRequested:$e},{default:g(()=>[I("div",{class:m(e(l).e("mask")),onClick:Xe(i=>t.hideOnClickModal&&M(),["self"])},null,10,["onClick"]),C(" CLOSE "),I("span",{class:m([e(l).e("btn"),e(l).e("close")]),onClick:M},[d(e($),null,{default:g(()=>[d(e(st))]),_:1})],2),C(" ARROW "),e(H)?C("v-if",!0):(h(),z(Z,{key:0},[I("span",{class:m(e(oe)),onClick:ce},[d(e($),null,{default:g(()=>[d(e(nt))]),_:1})],2),I("span",{class:m(e(le)),onClick:ue},[d(e($),null,{default:g(()=>[d(e(ot))]),_:1})],2)],64)),t.$slots.progress||t.showProgress?(h(),z("div",{key:1,class:m([e(l).e("btn"),e(l).e("progress")])},[x(t.$slots,"progress",{activeIndex:y.value,total:t.urlList.length},()=>[Fe(Ne(e(U)),1)])],2)):C("v-if",!0),C(" ACTIONS "),I("div",{class:m([e(l).e("btn"),e(l).e("actions")])},[I("div",{class:m(e(l).e("actions__inner"))},[x(t.$slots,"toolbar",{actions:T,prev:ce,next:ue,reset:_,activeIndex:y.value,setActiveItem:te},()=>[d(e($),{onClick:i=>T("zoomOut")},{default:g(()=>[d(e(lt))]),_:1},8,["onClick"]),d(e($),{onClick:i=>T("zoomIn")},{default:g(()=>[d(e(rt))]),_:1},8,["onClick"]),I("i",{class:m(e(l).e("actions__divider"))},null,2),d(e($),{onClick:_},{default:g(()=>[(h(),pe(De(e(O).icon)))]),_:1}),I("i",{class:m(e(l).e("actions__divider"))},null,2),d(e($),{onClick:i=>T("anticlockwise")},{default:g(()=>[d(e(it))]),_:1},8,["onClick"]),d(e($),{onClick:i=>T("clockwise")},{default:g(()=>[d(e(ct))]),_:1},8,["onClick"])])],2)],2),C(" CANVAS "),I("div",{class:m(e(l).e("canvas"))},[(h(!0),z(Z,null,He(t.urlList,(i,k)=>(h(),z(Z,{key:k},[k===y.value?(h(),z("img",{key:0,ref_for:!0,ref:S=>B.value[k]=S,src:i,style:ye(e(Q)),class:m(e(l).e("img")),crossorigin:t.crossorigin,onLoad:re,onError:ie,onMousedown:a},null,46,["src","crossorigin"])):C("v-if",!0)],64))),128))],2),x(t.$slots,"default")]),_:3},8,["focus-trap-el"])],6)]),_:3})]),_:3},8,["disabled"]))}});var wt=Te(ht,[["__file","image-viewer.vue"]]);const yt=Oe(wt),bt=Le({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:q([String,Object])},previewSrcList:{type:q(Array),default:()=>Ce([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:{type:Boolean,default:!1},crossorigin:{type:q(String)}}),kt={load:s=>s instanceof Event,error:s=>s instanceof Event,switch:s=>ve(s),close:()=>!0,show:()=>!0},It=ae({name:"ElImage",inheritAttrs:!1}),Ct=ae({...It,props:bt,emits:kt,setup(s,{expose:f,emit:n}){const o=s,{t:r}=ze(),w=Ee("image"),F=Ke(),D=p(()=>We(Object.entries(F).filter(([a])=>/^(data-|on[A-Z])/i.test(a)||["id","style"].includes(a)))),se=Pe({excludeListeners:!0,excludeKeys:p(()=>Object.keys(D.value))}),l=L(),P=L(!1),E=L(!0),B=L(!1),A=L(),v=L(),y=X&&"loading"in HTMLImageElement.prototype;let O;const c=p(()=>[w.e("inner"),H.value&&w.e("preview"),E.value&&w.is("loading")]),ne=p(()=>{const{fit:a}=o;return X&&a?{objectFit:a}:{}}),H=p(()=>{const{previewSrcList:a}=o;return qe(a)&&a.length>0}),G=p(()=>{const{previewSrcList:a,initialIndex:b}=o;let _=b;return b>a.length-1&&(_=0),_}),j=p(()=>o.loading==="eager"?!1:!y&&o.loading==="lazy"||o.lazy),K=()=>{X&&(E.value=!0,P.value=!1,l.value=o.src)};function oe(a){E.value=!1,P.value=!1,n("load",a)}function le(a){E.value=!1,P.value=!0,n("error",a)}function Q(){vt(A.value,v.value)&&(K(),J())}const U=Ue(Q,200,!0);async function M(){var a;if(!X)return;await _e();const{scrollContainer:b}=o;Ge(b)?v.value=b:Qe(b)&&b!==""?v.value=(a=document.querySelector(b))!=null?a:void 0:A.value&&(v.value=dt(A.value)),v.value&&(O=V(v,"scroll",U),setTimeout(()=>Q(),100))}function J(){!X||!v.value||!U||(O==null||O(),v.value=void 0)}function ee(){H.value&&(B.value=!0,n("show"))}function re(){B.value=!1,n("close")}function ie(a){n("switch",a)}return me(()=>o.src,()=>{j.value?(E.value=!0,P.value=!1,J(),M()):K()}),Se(()=>{j.value?M():K()}),f({showPreview:ee}),(a,b)=>(h(),z("div",be({ref_key:"container",ref:A},e(D),{class:[e(w).b(),a.$attrs.class]}),[P.value?x(a.$slots,"error",{key:0},()=>[I("div",{class:m(e(w).e("error"))},Ne(e(r)("el.image.error")),3)]):(h(),z(Z,{key:1},[l.value!==void 0?(h(),z("img",be({key:0},e(se),{src:l.value,loading:a.loading,style:e(ne),class:e(c),crossorigin:a.crossorigin,onClick:ee,onLoad:oe,onError:le}),null,16,["src","loading","crossorigin"])):C("v-if",!0),E.value?(h(),z("div",{key:1,class:m(e(w).e("wrapper"))},[x(a.$slots,"placeholder",{},()=>[I("div",{class:m(e(w).e("placeholder"))},null,2)])],2)):C("v-if",!0)],64)),e(H)?(h(),z(Z,{key:2},[B.value?(h(),pe(e(yt),{key:0,"z-index":a.zIndex,"initial-index":e(G),infinite:a.infinite,"zoom-rate":a.zoomRate,"min-scale":a.minScale,"max-scale":a.maxScale,"show-progress":a.showProgress,"url-list":a.previewSrcList,crossorigin:a.crossorigin,"hide-on-click-modal":a.hideOnClickModal,teleported:a.previewTeleported,"close-on-press-escape":a.closeOnPressEscape,onClose:re,onSwitch:ie},Ze({toolbar:g(_=>[x(a.$slots,"toolbar",ke(Ie(_)))]),default:g(()=>[a.$slots.viewer?(h(),z("div",{key:0},[x(a.$slots,"viewer")])):C("v-if",!0)]),_:2},[a.$slots.progress?{name:"progress",fn:g(_=>[x(a.$slots,"progress",ke(Ie(_)))])}:void 0]),1032,["z-index","initial-index","infinite","zoom-rate","min-scale","max-scale","show-progress","url-list","crossorigin","hide-on-click-modal","teleported","close-on-press-escape"])):C("v-if",!0)],64)):C("v-if",!0)],16))}});var Lt=Te(Ct,[["__file","image.vue"]]);const Rt=Oe(Lt);export{Rt as E,Tt as g};
