import{a3 as fe,B as $,r as V,c as j,b as i,g as b,k as s,w as n,a0 as v,$ as ge,a1 as ye,f as e,x as c,y as P,F as U,G as H,aj as Ve,_ as Ae,Y as xe,e as w,ah as N,W as Ee,a8 as oe,l as I,o as Ce}from"./index-008199ed.js";/* empty css                  */import{E as _e}from"./button-30635c71.js";import{_ as Ue}from"./baseline-content-copy-92f2b234.js";import{E as Te}from"./drawer-19330d17.js";import"./overlay-64b24548.js";import{E as ve,a as Se}from"./input-73d413ba.js";import{E as Ie}from"./input-number-89d86f4f.js";/* empty css                       *//* empty css                 *//* empty css                     */import"./tooltip-4ed993c7.js";/* empty css               *//* empty css                  */import{_ as He}from"./rename-outline-9169668c.js";/* empty css            */import{r as Me}from"./TrashIcon-6780b292.js";import{r as ke}from"./CheckBadgeIcon-af1628c6.js";import{E as Oe}from"./index-60380bfa.js";import{E as Le,a as Re}from"./index-91840f01.js";import{b as we,e as ze,t as Ne,f as Y,E as me}from"./request-7014ab81.js";/* empty css                */import{E as Fe}from"./link-64f58088.js";import{E as $e}from"./switch-6e3117dc.js";import{E as qe,a as De}from"./select-275ec4c7.js";import{_ as Be}from"./Cancel-b93a9a48.js";import{g as Ke,h as Ge,e as We,i as Ze,j as je}from"./admin-storage-185041e5.js";import{t as Ye}from"./vue3-clipboard.esm-f774ce6a.js";import{c as pe}from"./base-00eb0fe9.js";import{c as F}from"./path-229a1735.js";import{b as ce}from"./route-block-83d24a4e.js";import{_ as Je}from"./_plugin-vue_export-helper-c27b6911.js";import{r as ie}from"./LinkIcon-7af8e7e3.js";import{E as Qe}from"./index-c0734d0a.js";import{E as Xe}from"./index-dc7d0be4.js";import{E as el}from"./index-751f7128.js";import"./index-4ea0a277.js";import"./index-8286893b.js";import"./vnode-5e2fd68e.js";import"./scroll-374ad3fb.js";import"./_initCloneObject-ffec0ace.js";import"./index-3c7e69e5.js";import"./index-0da14aee.js";import"./index-293710b7.js";import"./debounce-3f0c1a7c.js";import"./validator-38288ad7.js";import"./strings-535b4609.js";import"./admin-form-header-819a5389.js";import"./arrow-left-6c74187b.js";import"./dropdown-40114633.js";const ll={class:"zfile-cors-wrapper"},tl={class:"space-x-2"},al={class:"el-form-item-tips"},ol={class:"list-disc ml-4"},rl={class:"select-all"},sl={__name:"Cors",props:{modelValue:{type:Object,required:!0}},emits:["update:modelValue"],setup(C,{emit:E}){const R=fe(),J=C,Q=E,q=y=>{Q("update:modelValue",y)};$(()=>J.modelValue,y=>{A.value=y});const A=V(J.modelValue||[]);A.value.forEach((y,r)=>{y.id||(y.id=Date.now()+r),y.allowedOrigins||(y.allowedOrigins=[]),y.allowedMethods||(y.allowedMethods=[]),y.allowedHeaders||(y.allowedHeaders=[]),y.exposeHeaders||(y.exposeHeaders=[]),y.maxAgeSeconds||(y.maxAgeSeconds=0)});const z=V(!1),l=V({allowedOrigins:"",allowedMethods:["GET","PUT"],allowedHeaders:"",exposeHeaders:"",maxAgeSeconds:0}),re=["GET","POST","PUT","DELETE","HEAD"];function D(y,r){y==="edit"&&r?l.value={...r,allowedOriginsStr:r.allowedOrigins.join("\n").trim(),allowedHeadersStr:r.allowedHeaders?r.allowedHeaders.join("\n").trim():"",exposeHeadersStr:r.exposeHeaders?r.exposeHeaders.join("\n").trim():""}:l.value={allowedOriginsStr:"",allowedMethods:["GET","PUT"],allowedHeadersStr:"content-type",exposeHeadersStr:"",maxAgeSeconds:0},z.value=!0}function G(){X.value.validate(y=>{if(y){let r={...l.value,allowedOrigins:l.value.allowedOriginsStr.split("\n").filter(x=>x.trim()),allowedHeaders:l.value.allowedHeadersStr.split("\n").filter(x=>x.trim()),exposeHeaders:l.value.exposeHeadersStr.split("\n").filter(x=>x.trim())};if(r.id){const x=A.value.findIndex(B=>B.id===r.id);A.value[x]=r}else A.value.push({...r,id:Date.now()});z.value=!1,q(A.value)}})}function W(y){A.value=A.value.filter(r=>r!==y),q(A.value)}const X=V(null),ee={allowedOriginsStr:[{required:!0,message:"请输入允许来源",trigger:"blur"}],allowedMethods:[{type:"array",required:!0,message:"请选择允许方法",trigger:"change"}]},Z=window.location.origin,le=j(()=>A.value.some(y=>y.allowedOrigins.includes(Z)&&y.allowedMethods.includes("GET")&&y.allowedMethods.includes("PUT"))),te=()=>{le.value||(A.value.push({id:Date.now(),allowedOrigins:[Z],allowedMethods:["GET","PUT"],allowedHeaders:["content-type"],exposeHeaders:[],maxAgeSeconds:0}),q(A.value))};return(y,r)=>{const x=_e,B=Oe,M=Le,ae=He,se=Re,O=we,L=ve,ne=ze,g=Ne,t=Ie,k=Se,_=Te;return i(),b("div",ll,[s(x,{onClick:r[0]||(r[0]=u=>D("add",null)),type:"primary"},{default:n(()=>r[8]||(r[8]=[v("新增配置")])),_:1,__:[8]}),s(B,{content:"检测到当前跨域配置异常，可能会影响在线预览、上传等功能，请点击添加推荐配置",placement:"top"},{default:n(()=>[ge(s(x,{onClick:te,type:"success"},{default:n(()=>r[9]||(r[9]=[v("添加推荐配置")])),_:1,__:[9]},512),[[ye,!e(le)]])]),_:1}),s(se,{data:A.value,width:"100%"},{default:n(()=>[s(M,{prop:"allowedOrigins",label:"允许来源","show-overflow-tooltip":""}),s(M,{prop:"allowedMethods",label:"允许Method","show-overflow-tooltip":""}),s(M,{prop:"allowedHeaders",label:"允许Headers","show-overflow-tooltip":""}),s(M,{prop:"exposeHeaders",label:"暴露Headers","show-overflow-tooltip":""}),s(M,{prop:"maxAgeSeconds",width:"110",label:"缓存时间(秒)","show-overflow-tooltip":""}),s(M,{label:"操作",align:"center","min-width":"60px"},{default:n(({row:u})=>[c("div",tl,[s(ae,{class:"z-btn-primary",onClick:m=>D("edit",u)},null,8,["onClick"]),s(e(Me),{class:"z-btn-danger",onClick:m=>W(u)},null,8,["onClick"])])]),_:1})]),_:1},8,["data"]),s(_,{class:"zfile-cors-drawer-wrapper",modelValue:z.value,"onUpdate:modelValue":r[7]||(r[7]=u=>z.value=u),"append-to-body":"",title:"跨域规则配置","destroy-on-close":!0,"close-on-click-modal":!1,size:e(Ve)?"80%":"30%"},{header:n(()=>r[10]||(r[10]=[c("div",{class:"zfile-cors-drawer-title"},[c("div",{class:"mr-2"},"跨域规则配置"),c("a",{target:"_blank",class:"text-xs my-auto link",type:"success",href:"https://docs.aws.amazon.com/zh_cn/AmazonS3/latest/userguide/ManageCorsUsing.html"}," 参考文档 ")],-1)])),default:n(()=>[s(k,{model:l.value,"label-width":e(R).adminForm.labelWidth,"label-position":e(R).adminForm.labelPosition,size:e(R).adminForm.size,"status-icon":"",class:"z-admin-form",ref_key:"corsFormRef",ref:X,rules:ee},{default:n(()=>[s(L,{label:"来源",prop:"allowedOriginsStr"},{default:n(()=>[s(O,{modelValue:l.value.allowedOriginsStr,"onUpdate:modelValue":r[1]||(r[1]=u=>l.value.allowedOriginsStr=u),type:"textarea",placeholder:"请输入允许来源，如 https://xxx.com 或 http://192.168.0.1",autosize:{minRows:3,maxRows:6}},null,8,["modelValue"]),c("div",al,[c("ul",ol,[r[12]||(r[12]=c("li",null,"来源可以设置多个，每行一个，每行最多能有一个通配符 *，每行前后不要后空格，最后不要加 /",-1)),r[13]||(r[13]=c("li",null,"如你有多个地址/域名访问该 ZFile 服务(如家里服务器搭建，有内网，也有公网)都要配置到这里，不然可能会影响上传、下载、预览功能，后续增加其他地址访问时，记得更新这里。更详细的配置请参考存储源官方提供的文档。",-1)),c("li",null,[r[11]||(r[11]=v("当前环境推荐配置: ")),c("span",rl,P(e(Z)),1)])])])]),_:1}),s(L,{label:"允许方法",prop:"allowedMethods"},{default:n(()=>[s(g,{modelValue:l.value.allowedMethods,"onUpdate:modelValue":r[2]||(r[2]=u=>l.value.allowedMethods=u)},{default:n(()=>[(i(),b(U,null,H(re,u=>s(ne,{key:u,value:u},{default:n(()=>[v(P(u),1)]),_:2},1032,["value"])),64))]),_:1},8,["modelValue"]),r[14]||(r[14]=c("div",{class:"el-form-item-tips"}," ZFile 需要用 GET 和 PUT 方法，其他方法请根据需求添加。 ",-1))]),_:1,__:[14]}),s(L,{label:"允许 Headers",prop:"allowedHeadersStr"},{default:n(()=>[s(O,{modelValue:l.value.allowedHeadersStr,"onUpdate:modelValue":r[3]||(r[3]=u=>l.value.allowedHeadersStr=u),type:"textarea",placeholder:"请输入允许Headers",autosize:{minRows:3,maxRows:6}},null,8,["modelValue"]),r[15]||(r[15]=c("div",{class:"el-form-item-tips"},[v(" 允许 Headers 可以设置多个，每行一个，每行最多能有一个通配符 *。 "),c("br"),v(" ZFile 当前版本需要用 "),c("span",{class:"select-all"},"content-type"),v("，其他的根据需求添加。 ")],-1))]),_:1,__:[15]}),s(L,{label:"暴露 Headers",prop:"exposeHeadersStr"},{default:n(()=>[s(O,{modelValue:l.value.exposeHeadersStr,"onUpdate:modelValue":r[4]||(r[4]=u=>l.value.exposeHeadersStr=u),type:"textarea",placeholder:"请输入暴露Headers",autosize:{minRows:3,maxRows:6}},null,8,["modelValue"]),r[16]||(r[16]=c("div",{class:"el-form-item-tips"}," 暴露 Headers 可以设置多个，每行一个，不允许出现通配符 *，一般 ZFile 中使用不需要设置。 ",-1))]),_:1,__:[16]}),s(L,{label:"缓存时间（秒）",prop:"maxAgeSeconds"},{default:n(()=>[s(t,{modelValue:l.value.maxAgeSeconds,"onUpdate:modelValue":r[5]||(r[5]=u=>l.value.maxAgeSeconds=u),min:0,label:"缓存时间（秒）",step:1,"step-strictly":""},null,8,["modelValue"]),r[17]||(r[17]=c("div",{class:"el-form-item-tips"}," 指定在 S3 针对特定资源的预检 OPTIONS 请求作出响应后，浏览器缓存该响应的时间（以秒为单位）。通过缓存响应，在需要重复原始请求时，浏览器无需向 S3 发送预检请求。 ",-1))]),_:1,__:[17]}),s(L,{"label-width":e(R).adminForm.labelWidth,class:"admin-from-footer"},{default:n(()=>[s(x,{type:"primary",icon:e(ke),onClick:G},{default:n(()=>r[18]||(r[18]=[v("保存设置")])),_:1,__:[18]},8,["icon"]),s(x,{onClick:r[6]||(r[6]=u=>z.value=!1)},{default:n(()=>r[19]||(r[19]=[v("取消")])),_:1,__:[19]})]),_:1},8,["label-width"])]),_:1},8,["model","label-width","label-position","size"])]),_:1},8,["modelValue","size"])])}}},nl=C=>Y({url:"/sharepoint/getSites",method:"post",data:C}),il=C=>Y({url:"/sharepoint/getSiteLists",method:"post",data:C}),dl=C=>Y({url:"/s3/getBuckets",method:"post",data:C,config:{showDefaultMsg:!1}}),ul=C=>Y({url:"/s3/getCorsConfig",method:"post",data:C,config:{showDefaultMsg:!1}}),ml=C=>Y({url:"/gd/drives",method:"post",data:C,config:{showDefaultMsg:!1}});const pl={class:"el-form-item-tips"},cl={style:{float:"left"}},fl={style:{float:"right",color:"#8492a6","font-size":"13px"}},gl={style:{float:"left"}},yl={style:{float:"left"}},_l={class:"float-right"},vl={class:"float-left"},Sl={class:"float-left"},kl={class:"float-right"},wl={key:5,class:"w-full"},bl=["innerHTML"],hl={key:10},Pl={class:"el-form-item-tips"},Vl={key:0},Al={key:0,class:"flex items-center"},xl=["innerHTML"],El={key:2,class:"font-bold"},Cl={class:"text-red-500"},Ul={key:3},Tl={key:4},Il={key:5},be={__name:"index",setup(C){let E=fe(),R=Ae(),J=xe(),Q=null,q=V();const A=()=>{q.value.validate(g=>{if(g)D.value=!0,Ke(l.value).then(t=>{let k="保存成功, 是否前往用户管理配置权限（不配置将无法访问该存储源）？";W.value=!0,Qe.confirm(k,"提示",{confirmButtonText:"前往用户管理设置",cancelButtonText:"返回存储源列表",closeOnClickModal:!1,closeOnPressEscape:!1,showClose:!1,type:"success",callback:_=>{_==="confirm"?R.push("/admin/user-list"):R.push("/admin/storage-list")}})}).finally(()=>{D.value=!1});else return me.warning("表单验证失败, 请检查表单数据是否填写正确"),!1})};let z=()=>{let g=V({orderNum:null,name:"",type:"",remark:"",alias:"",defaultSwitchToImgMode:!1,enable:!0,enableFileOperator:!0,enableFileAnnoOperator:!1,enableCache:!1,autoRefreshCache:!1,storageSourceAllParam:{endPoint:"",pathStyle:"",isPrivate:!1,accessKey:null,secretKey:null,bucketName:null,host:null,port:null,filePath:null,accessToken:null,refreshToken:null,secretId:null,username:null,password:null,privateKey:null,passphrase:null,basePath:"",domain:"",listId:"",redirectUri:"",siteId:"",proxyDomain:"",downloadLinkType:"",clientId:"",clientSecret:"",region:"",autoConfigCors:!1,driveId:""}});const t=p=>{je(p).then(d=>{d.data.type=d.data.type.key,g.value=d.data,Q=d.data.key})};let k=V(!1),_=V([]);Ce(()=>{Ge().then(d=>{_.value=d.data});let p=J.params.storageId;p&&(k.value=!0,t(p))});let u=V(!1),m=V({name:[{required:!0,message:"请输入存储源名称"}],key:[{validator:(p,d,f)=>{if(d==null||d===""){f();return}if(oe.systemNames.includes(d)){f(new Error("不可占用系统级名称，请修改。"));return}if(!/^[\w\-]+$/.test(d)){f(new Error("只允许使用字母、数字、下划线、横杠。"));return}if(Q===d){f();return}We({storageKey:d}).then(h=>{h.data?f(new Error("该存储源别名已存在，请修改。")):f()})}}],type:[{required:!0,message:"存储策略不能为空"}],"storageSourceAllParam.url":[{type:"url",message:"请输入正确的地址，需以 http:// 或 https:// 开头"}],"storageSourceAllParam.domain":[{type:"url",message:"请输入正确的域名，需以 http:// 或 https:// 开头"},{validator:(p,d,f)=>{if(d==null||d===""){f();return}if(window.location.protocol==="https:"&&d.indexOf("http://")===0){f(new Error("检测到当前 ZFile 站点是 https 协议, 受浏览器限制, 此处也必须是 https 协议, 否则可能无法正常使用."));return}f()}}],"storageSourceAllParam.endPointScheme":[{validator:(p,d,f)=>{if(d==null||d===""){f();return}if(window.location.protocol==="https:"&&d==="http"){f(new Error("检测到当前 ZFile 站点是 https 协议, 受浏览器限制, 此处也必须是 https 协议, 否则可能无法正常使用."));return}f()}}],"storageSourceAllParam.filePath":[{validator:(p,d,f)=>{if(d==null||d===""){f(new Error("本地存储路径不能为空"));return}let S=/^\/.*/.test(d),h=/^[a-zA-Z]+:.*/.test(d);if(console.log(S,h),!S&&!h){f(new Error("本地存储路径必须是绝对路径，Linux 以 / 开头，Windows 以盘符开头"));return}f()}}],"storageSourceAllParam.bucketName":[{required:!0,message:"请选择存储器列表"}]});return{storageItem:g,supportStorageType:_,loading:u,rules:m,isEditMode:k}},{storageItem:l,supportStorageType:re,loading:D,rules:G,isEditMode:W}=z(),X=()=>{let g=V([]),t=V(""),k=j(()=>({accessKey:l.value.storageSourceAllParam.accessKey||l.value.storageSourceAllParam.secretId,secretKey:l.value.storageSourceAllParam.secretKey,endPoint:l.value.storageSourceAllParam.endPoint,region:l.value.storageSourceAllParam.region,bucketName:l.value.storageSourceAllParam.bucketName}));$(()=>k.value,m=>{oe.storageType.s3Type.includes(l.value.type)&&m.accessKey&&m.secretKey&&m.endPoint&&(_(m),m.bucketName&&u(m))});const _=m=>{dl(m).then(p=>{g.value=p.data}).catch(p=>{g.value=[]})},u=m=>{ul(m).then(p=>{l.value.storageSourceAllParam.corsConfigList=p.data,t.value="以上是自动获取到的跨域配置，如未正确配置跨域，可能会导致在线预览和上传失败。"}).catch(p=>{t.value="自动获取跨域配置失败，可能是存储源不支持/无需跨域配置，或者没有权限获取跨域配置或其他原因。<br>报错信息："+p.response.data.msg})};return{bucketList:g,corsTips:t}},{bucketList:ee,corsTips:Z}=X(),le=()=>{let g=V([]),t=j(()=>({accessToken:l.value.storageSourceAllParam.accessToken}));$(()=>t.value,_=>{l.value.type==="google-drive"&&k(_)});const k=_=>{ml(_).then(u=>{g.value=u.data}).catch(u=>{g.value=[]})};return{drivesList:g}},{drivesList:te}=le(),y=()=>{let g=V([]),t=V([]);const k=p=>p.indexOf("sharepoint")!==-1,_=p=>p==="sharepoint"?"Standard":"China";$(()=>l.value.storageSourceAllParam.accessToken,p=>{p&&u()});const u=()=>{let p=l.value.type;if(k(p)){let d={type:_(p),accessToken:l.value.storageSourceAllParam.accessToken};nl(d).then(f=>{g.value=f.data})}};$(()=>l.value.storageSourceAllParam.siteId,p=>{p&&m()});const m=()=>{let p=l.value.type;if(k(p)){let d={type:_(p),accessToken:l.value.storageSourceAllParam.accessToken,siteId:l.value.storageSourceAllParam.siteId};il(d).then(f=>{t.value=f.data})}};return{sharepointSites:g,sharepointSiteLists:t,isSharePoint:k}},{sharepointSites:r,sharepointSiteLists:x,isSharePoint:B}=y(),M=()=>{$(()=>l.value.type,_=>{k(_)});let g=V([]),t=V({});const k=_=>{_&&Ze({storageType:_}).then(u=>{g.value=u.data;for(let m of g.value)!W.value&&m.defaultValue?(m.defaultValue=pe(m.defaultValue),l.value.storageSourceAllParam[m.key]=m.defaultValue):m.key==="redirectUri"&&!l.value.storageSourceAllParam[m.key]&&(l.value.storageSourceAllParam[m.key]=m.defaultValue),m.condition===""?t.value[m.key]=!0:t.value[m.key]=j(()=>{const p=(S,h,K)=>{let T=S.endsWith("?");return T&&(S=S.replace("?","")),!T&&t.value[S]===!1?!1:(h=pe(h),K==="=="?l.value.storageSourceAllParam[S]===h:K==="!="?l.value.storageSourceAllParam[S]!==h:!0)},d=S=>{let h;S.indexOf("==")!==-1?h="==":S.indexOf("!=")!==-1?h="!=":alert("不支持的表达式 ".concat(S));let[K,T]=S.split(h);return p(K,T,h)};let f=m.condition;return f.indexOf("||")!==-1?f.split("||").some(S=>d(S)):f.indexOf("&&")!==-1?f.split("&&").every(S=>d(S)):d(f)})})};return{storageSourceParamList:g,fieldShowMap:t}},{storageSourceParamList:ae,fieldShowMap:se}=M();$(()=>ae.value,g=>{g&&(G.value={...G.value,...g.reduce((t,k)=>(k.required&&(t["storageSourceAllParam.".concat(k.key)]=[{required:!0,message:"".concat(k.name,"不能为空")}]),t),{})})});let O=g=>{Ye(g).then(()=>{me.success("复制成功")})};const L=j(()=>window.location.protocol==="https:"&&l.value.storageSourceAllParam.domain.indexOf("http://")===0),ne=["endPoint","accessKey","secretKey","accessToken","refreshToken","secretId","clientId","clientSecret"];return(g,t)=>{const k=Be,_=we,u=ve,m=qe,p=De,d=$e,f=Xe,S=Fe,h=el,K=sl,T=Ue,he=_e,Pe=Se;return i(),w(Pe,{model:e(l),"label-width":e(E).adminForm.labelWidth,"label-position":e(E).adminForm.labelPosition,size:e(E).adminForm.size,"scroll-to-error":"","status-icon":"",class:"zfile-storage-edit z-admin-form",rules:e(G),ref_key:"storageEditForm",ref:q},{default:n(()=>[s(k,{title:"存储源信息",to:"/admin/storage-list"},{default:n(()=>t[15]||(t[15]=[v(" 请维护您的存储源信息，可参考 "),c("a",{class:"link",target:"_blank",href:"https://docs.zfile.vip/category/%E5%AD%98%E5%82%A8%E6%BA%90%E7%A4%BA%E4%BE%8B%E9%85%8D%E7%BD%AE"},"ZFile 存储源配置文档",-1)])),_:1,__:[15]}),s(u,{label:"存储源名称",prop:"name"},{default:n(()=>[s(_,{modelValue:e(l).name,"onUpdate:modelValue":t[0]||(t[0]=a=>e(l).name=a)},null,8,["modelValue"])]),_:1}),s(u,{label:"存储源别名",prop:"key"},{default:n(()=>[s(_,{modelValue:e(l).key,"onUpdate:modelValue":t[1]||(t[1]=a=>e(l).key=a)},null,8,["modelValue"]),c("div",pl," 存储源别名，用于 URL 中展示, 如 "+P(e(F)(e(E).serverAddress,e(l).key||"{存储源别名}")),1)]),_:1}),s(u,{label:"存储源备注"},{default:n(()=>[s(_,{type:"textarea",rows:3,placeholder:"请输入存储源备注",modelValue:e(l).remark,"onUpdate:modelValue":t[2]||(t[2]=a=>e(l).remark=a)},null,8,["modelValue"]),t[16]||(t[16]=c("div",{class:"el-form-item-tips"}," 存储源备注信息, 用于辅助管理员区分不同的存储源, 此字段仅管理员可见 ",-1))]),_:1,__:[16]}),s(u,{label:"存储策略",prop:"type"},{default:n(()=>[s(p,{disabled:e(W),filterable:e(N),modelValue:e(l).type,"onUpdate:modelValue":t[3]||(t[3]=a=>e(l).type=a),placeholder:"请选择存储策略"},{default:n(()=>[(i(!0),b(U,null,H(e(re),a=>(i(),w(m,{key:a.key,label:a.description,value:a.key},null,8,["label","value"]))),128))]),_:1},8,["disabled","filterable","modelValue"])]),_:1}),s(u,{label:"是否启用"},{default:n(()=>[s(d,{modelValue:e(l).enable,"onUpdate:modelValue":t[4]||(t[4]=a=>e(l).enable=a)},null,8,["modelValue"]),t[17]||(t[17]=c("div",{class:"el-form-item-tips"}," 如不启用，则在前台不显示，且不可访问. ",-1))]),_:1,__:[17]}),s(u,{label:"是否默认打开画廊模式"},{default:n(()=>[s(d,{modelValue:e(l).defaultSwitchToImgMode,"onUpdate:modelValue":t[5]||(t[5]=a=>e(l).defaultSwitchToImgMode=a)},null,8,["modelValue"]),t[18]||(t[18]=c("div",{class:"el-form-item-tips"}," 启用后，每次切换到此存储源，将自动打开画廊模式（适用于纯图片的存储源） ",-1))]),_:1,__:[18]}),(i(!0),b(U,null,H(e(ae),a=>(i(),b("div",{key:a.key},[e(se)[a.key]?(i(),w(u,{key:0,label:a.name,required:a.required,prop:"storageSourceAllParam."+a.key},Ee({default:n(()=>{var de,ue;return[a.key==="endPoint"&&("constant"in g?g.constant:e(oe)).region.hasOwnProperty(e(l).type)?(i(),w(p,{key:0,filterable:e(N),"allow-create":"","default-first-option":"",style:{width:"100%"},modelValue:e(l).storageSourceAllParam.endPoint,"onUpdate:modelValue":t[6]||(t[6]=o=>e(l).storageSourceAllParam.endPoint=o)},{default:n(()=>[(i(!0),b(U,null,H(("constant"in g?g.constant:e(oe)).region[e(l).type],o=>(i(),w(m,{label:o.name,value:o.val,key:o.name},{default:n(()=>[c("span",cl,P(o.name),1),c("span",fl,P(o.val),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["filterable","modelValue"])):a.key==="siteId"&&e(B)(e(l).type)?(i(),w(p,{key:1,filterable:e(N),placeholder:"请选择站点列表",modelValue:e(l).storageSourceAllParam.siteId,"onUpdate:modelValue":t[7]||(t[7]=o=>e(l).storageSourceAllParam.siteId=o),class:"input-with-select"},{default:n(()=>[(i(!0),b(U,null,H(e(r),o=>(i(),w(m,{key:o.id,label:o.displayName,value:o.id},{default:n(()=>[c("span",gl,[v(P(o.displayName)+" ",1),o.displayName==="Communication site"?(i(),w(f,{key:0,type:"success"},{default:n(()=>t[20]||(t[20]=[v("默认网站")])),_:1,__:[20]})):I("",!0)]),s(h,{placement:"right",width:"400",trigger:"hover",content:o.webUrl},{reference:n(()=>[s(S,{target:"_blank",icon:e(ie),href:o.webUrl,underline:!1,class:"float-right",type:"primary"},{default:n(()=>t[21]||(t[21]=[v("查看网站")])),_:2,__:[21]},1032,["icon","href"])]),_:2},1032,["content"])]),_:2},1032,["label","value"]))),128))]),_:1},8,["filterable","modelValue"])):a.key==="listId"&&e(B)(e(l).type)?(i(),w(p,{key:2,filterable:e(N),placeholder:"请选择网站子目录",modelValue:e(l).storageSourceAllParam.listId,"onUpdate:modelValue":t[8]||(t[8]=o=>e(l).storageSourceAllParam.listId=o),class:"input-with-select"},{default:n(()=>[(i(!0),b(U,null,H(e(x),o=>(i(),w(m,{key:o.id,label:o.displayName,value:o.id},{default:n(()=>[c("span",yl,[v(P(o.displayName)+" ",1),o.displayName==="Communication site"?(i(),w(f,{key:0,type:"success"},{default:n(()=>t[22]||(t[22]=[v("默认网站")])),_:1,__:[22]})):I("",!0)]),s(h,{placement:"right",width:"400",trigger:"hover",content:o.webUrl},{reference:n(()=>[s(S,{target:"_blank",icon:g.Link,href:o.webUrl,underline:!1,class:"float-right",type:"primary"},{default:n(()=>t[23]||(t[23]=[v("查看网站")])),_:2,__:[23]},1032,["icon","href"])]),_:2},1032,["content"])]),_:2},1032,["label","value"]))),128))]),_:1},8,["filterable","modelValue"])):a.key==="driveId"&&((de=e(te))==null?void 0:de.length)>0?(i(),w(p,{key:3,filterable:e(N),placeholder:"请选择驱动器列表",modelValue:e(l).storageSourceAllParam.driveId,"onUpdate:modelValue":t[9]||(t[9]=o=>e(l).storageSourceAllParam.driveId=o),class:"input-with-select"},{default:n(()=>[s(m,{value:"",label:"默认空间"},{default:n(()=>[t[25]||(t[25]=c("span",{class:"float-left"}," 默认空间 ",-1)),c("span",_l,[s(f,{type:"primary",class:"float-right"},{default:n(()=>t[24]||(t[24]=[v(" 个人盘 ")])),_:1,__:[24]})])]),_:1,__:[25]}),(i(!0),b(U,null,H(e(te),o=>(i(),w(m,{key:o.id,label:o.name,value:o.id},{default:n(()=>[c("span",vl,P(o.name),1),s(h,{placement:"left",width:"400",trigger:"hover",content:o.id},{reference:n(()=>[s(f,{type:"success",class:"float-right"},{default:n(()=>t[26]||(t[26]=[v(" 团队盘 ")])),_:1,__:[26]})]),_:2},1032,["content"])]),_:2},1032,["label","value"]))),128))]),_:1},8,["filterable","modelValue"])):a.key==="bucketName"&&((ue=e(ee))==null?void 0:ue.length)>0?(i(),w(p,{key:4,"allow-create":"",filterable:e(N),placeholder:"请选择存储器列表",modelValue:e(l).storageSourceAllParam.bucketName,"onUpdate:modelValue":t[10]||(t[10]=o=>e(l).storageSourceAllParam.bucketName=o),class:"input-with-select"},{default:n(()=>[(i(!0),b(U,null,H(e(ee),o=>(i(),w(m,{key:o.name,label:o.name,value:o.name},{default:n(()=>[c("span",Sl,P(o.name),1),c("span",kl,P(o.date),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["filterable","modelValue"])):a.key==="corsConfigList"?(i(),b("div",wl,[s(K,{modelValue:e(l).storageSourceAllParam.corsConfigList,"onUpdate:modelValue":t[11]||(t[11]=o=>e(l).storageSourceAllParam.corsConfigList=o)},null,8,["modelValue"]),c("div",{class:"text-sm text-gray-400",innerHTML:e(Z)},null,8,bl)])):a.type==="select"?(i(),w(p,{key:6,"allow-create":a.optionAllowCreate,filterable:e(N),"default-first-option":"",modelValue:e(l).storageSourceAllParam[a.key],"onUpdate:modelValue":o=>e(l).storageSourceAllParam[a.key]=o},{default:n(()=>[(i(!0),b(U,null,H(a.options,o=>(i(),w(m,{label:o.label,value:o.value},null,8,["label","value"]))),256))]),_:2},1032,["allow-create","filterable","modelValue","onUpdate:modelValue"])):a.type==="switch"?(i(),w(d,{key:7,modelValue:e(l).storageSourceAllParam[a.key],"onUpdate:modelValue":o=>e(l).storageSourceAllParam[a.key]=o},null,8,["modelValue","onUpdate:modelValue"])):a.type==="input"?(i(),b(U,{key:8},[ne.includes(a.key)?(i(),w(_,{key:0,modelValue:e(l).storageSourceAllParam[a.key],"onUpdate:modelValue":o=>e(l).storageSourceAllParam[a.key]=o,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])):(i(),w(_,{key:1,modelValue:e(l).storageSourceAllParam[a.key],"onUpdate:modelValue":o=>e(l).storageSourceAllParam[a.key]=o},null,8,["modelValue","onUpdate:modelValue"]))],64)):a.type==="textarea"?(i(),w(_,{key:9,type:"textarea",modelValue:e(l).storageSourceAllParam[a.key],"onUpdate:modelValue":o=>e(l).storageSourceAllParam[a.key]=o},null,8,["modelValue","onUpdate:modelValue"])):(i(),b("div",hl," 服务端配置错误, 字段 "+P(a.key)+" 类型为 "+P(a.type)+", 不支持此类型的渲染. ",1)),c("div",Pl,[a.link?(i(),b("div",Vl,[a.key==="accessToken"?(i(),b("span",Al,[s(S,{target:"_blank",icon:e(ie),type:"info",href:a.link+"?clientId="+encodeURIComponent(e(l).storageSourceAllParam.clientId)+"&clientSecret="+encodeURIComponent(e(l).storageSourceAllParam.clientSecret)+"&redirectUri="+encodeURIComponent(e(l).storageSourceAllParam.redirectUri)},{default:n(()=>[v(P(a.linkName),1)]),_:2},1032,["icon","href"]),s(T,{onClick:o=>e(O)(a.link+"?clientId="+encodeURIComponent(e(l).storageSourceAllParam.clientId)+"&clientSecret="+encodeURIComponent(e(l).storageSourceAllParam.clientSecret)+"&redirectUri="+encodeURIComponent(e(l).storageSourceAllParam.redirectUri)),class:"inline cursor-pointer ml-2 w-4 text-lg relative"},null,8,["onClick"])])):(i(),w(S,{key:1,target:"_blank",icon:e(ie),href:a.link},{default:n(()=>[v(P(a.linkName),1)]),_:2},1032,["icon","href"]))])):I("",!0),a.description?(i(),b("div",{key:1,innerHTML:a.description},null,8,xl)):I("",!0),a.key==="domain"&&e(l).storageSourceAllParam.domain?(i(),b("div",El,[t[28]||(t[28]=v(" 注意: ")),c("ul",null,[ge(c("li",Cl,"如果你的 zfile 是 https，则该存储源的下载域名也应是 https，否则可能会影响预览/下载!",512),[[ye,e(L)]]),t[27]||(t[27]=c("li",null,"需域名支持跨域访问，否则也可能会导致下载/预览失败.",-1))])])):I("",!0),a.key==="redirectUri"&&a.description&&["onedrive","sharepoint"].includes(e(l).type)?(i(),b("div",Ul,[v(" 如："+P(e(F)(e(E).serverAddress,"onedrive/callback"))+" ",1),s(T,{onClick:t[12]||(t[12]=o=>e(O)(e(F)(e(E).serverAddress,"onedrive/callback"))),class:"inline cursor-pointer ml-1"})])):I("",!0),a.key==="redirectUri"&&a.description&&["onedrive-china","sharepoint-china"].includes(e(l).type)?(i(),b("div",Tl,[v(" 如："+P(e(F)(e(E).serverAddress,"onedrive/china-callback"))+" ",1),s(T,{onClick:t[13]||(t[13]=o=>e(O)(e(F)(e(E).serverAddress,"onedrive/china-callback"))),class:"inline cursor-pointer ml-1"})])):I("",!0),a.key==="redirectUri"&&a.description&&e(l).type==="google-drive"?(i(),b("div",Il,[v(" 如："+P(e(F)(e(E).serverAddress,"gd/callback"))+" ",1),s(T,{onClick:t[14]||(t[14]=o=>e(O)(e(F)(e(E).serverAddress,"gd/callback"))),class:"inline cursor-pointer ml-1"})])):I("",!0)])]}),_:2},[a.pro?{name:"label",fn:n(()=>[v(P(a.name)+" ",1),t[19]||(t[19]=c("span",{class:"badge-blue"},"Pro",-1))]),key:"0"}:void 0]),1032,["label","required","prop"])):I("",!0)]))),128)),s(u,{"label-width":e(E).adminForm.labelWidth,class:"admin-from-footer"},{default:n(()=>[s(he,{class:"ml-auto",type:"primary",icon:e(ke),loading:e(D),onClick:A},{default:n(()=>t[29]||(t[29]=[v("保存设置")])),_:1,__:[29]},8,["icon","loading"])]),_:1},8,["label-width"])]),_:1},8,["model","label-width","label-position","size","rules"])}}};typeof ce=="function"&&ce(be);const Ct=Je(be,[["__scopeId","data-v-46fd4c99"]]);export{Ct as default};
