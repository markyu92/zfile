var ma=Object.defineProperty;var va=(t,e,n)=>e in t?ma(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var G=(t,e,n)=>(va(t,typeof e!="symbol"?e+"":e,n),n),tn=(t,e,n)=>{if(!e.has(t))throw TypeError("Cannot "+n)};var w=(t,e,n)=>(tn(t,e,"read from private field"),n?n.call(t):e.get(t)),te=(t,e,n)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},K=(t,e,n,o)=>(tn(t,e,"write to private field"),o?o.call(t,n):e.set(t,n),n);var Te=(t,e,n)=>(tn(t,e,"access private method"),n);import{E as j,f as Q,M as Ro,r as ya}from"./request-7014ab81.js";import{a8 as Le,b as F,g as R,x as k,r as E,c as oe,b8 as Ao,X as Bo,a5 as at,ae as Dn,a3 as Yt,B as nt,e as Ue,w as le,$ as wt,a1 as Ot,n as nn,i as Ve,l as pe,T as ba,b9 as Oo,d as Io,a4 as ot,o as No,aK as mn,ba as wa,bb as Sa,a2 as Ca,bc as xa,ad as vn,f as M,bd as ka,be as _a,bf as Da,Y as La,bg as Ta,bh as Fa,F as Xe,G as gt,y as Re,j as yn,k as ie,h as bn,Q as Ea,a0 as Wt,bi as Ln,bj as za,ah as $a,aj as Wo,ao as lt,bk as Vn,ay as Pa,aA as Ma,b6 as Ra,H as Aa}from"./index-008199ed.js";import{r as Qe,c as jt,a as Kn}from"./path-229a1735.js";import{E as jo}from"./dialog-9877e468.js";import"./overlay-64b24548.js";import{E as wn}from"./button-30635c71.js";/* empty css                     *//* empty css               *//* empty css                  */import{E as Ba,a as Oa,b as Ia}from"./dropdown-item-28606bba.js";import{_ as Tn}from"./_plugin-vue_export-helper-c27b6911.js";import{E as ze}from"./index-c0734d0a.js";import{E as St}from"./index-9e699d2b.js";import{E as qn}from"./index-4ea0a277.js";const Sn=t=>{if(t===0)return"-";if(t===-1)return"未知";const e=1024,n=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],o=Math.floor(Math.log(t)/Math.log(e));return(t/Math.pow(e,o)).toFixed(2)+" "+n[o]},Mr=(t,e,n)=>t.type==="BACK"?"":t.type==="FOLDER"&&!t.size?"-":n===0?"0 B":n===-1?"未知":Sn(n),Na=t=>{let e;if(t.type==="BACK"||t.type==="FOLDER"||t.type==="ROOT")return t.type.toLowerCase();{const n=Uo(t.name),o=Vo(t.name);Le.iconFileType.indexOf(n)!==-1?e=n:o?e=o:e="file"}return e},Uo=t=>{const e=t.lastIndexOf(".");return e===-1?"other":t.substring(e+1).toLowerCase()},Rr=t=>{const e=t.lastIndexOf("/");return e===-1?t:t.substring(e+1)},Ar=t=>{const e=t.lastIndexOf(".");return e===-1?"":t.substring(0,e)},Vo=t=>{let e;for(const n in Le.fileTypeMap){const o=Uo(t);if(Le.fileTypeMap[n].indexOf(o)!==-1){e=n;break}}return e};function Wa(t,e){return F(),R("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[k("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75h-4.5m4.5 0v4.5m0-4.5L15 9m5.25 11.25h-4.5m4.5 0v-4.5m0 4.5L15 15"})])}function Ft(t,e){return F(),R("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[k("path",{"fill-rule":"evenodd",d:"M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z","clip-rule":"evenodd"})])}const ke=E([]),He=E({clearSelection:null,toggleRowSelection:null,toggleAllSelection:null});function _t(){const t=(u,p,d)=>{He.value.clearSelection=u,He.value.toggleRowSelection=p,He.value.toggleAllSelection=d},e=()=>{He.value.clearSelection()},n=(u,p)=>{(u==null?void 0:u.type)!=="BACK"&&He.value.toggleRowSelection(u,p)},o=()=>{He.value.toggleAllSelection()},s=u=>u.type==="FILE"||u.type==="FOLDER",a=oe(()=>ke.value.length>0?ke.value[ke.value.length-1]:null),l=oe(()=>ke.value.filter(u=>u.type==="FILE")),i=oe(()=>ke.value.filter(u=>u.type==="FOLDER")),r=u=>{ke.value=u},f=({row:u,rowIndex:p})=>(u.index=p,ke.value.indexOf(u)!==-1?"select-row":""),c=oe(()=>{let u=ke.value.length,p=l.value.length,d=i.value.length,b=u===1,v=u>1;return{isSingleSelect:b,isMultiSelect:v,isAllFile:p===u,isAllFolder:d===u,isSingleSelectFile:b&&p===1,isSingleSelectFolder:b&&d===1}});return{initSelectFun:t,checkSelectable:s,tableRowClassName:f,selectRowsChange:r,selectRow:a,selectRows:ke,selectFiles:l,selectFolders:i,selectStatistics:c,clearSelection:e,toggleRowSelection:n,toggleAllSelection:o}}let{selectStatistics:Ge}=_t();const Ae=Ao("storageConfigStore",{state:()=>({globalConfig:{siteName:"",directLinkPrefix:"",infoEnable:!1,showLinkBtn:!1,recordDownloadLog:!1,showShortLink:!1,showPathLink:!1,tableSize:"small",rootShowStorage:!0,fileClickMode:"dbclick",mobileFileClickMode:"dbclick",showDocument:!1,debugMode:!1,icp:"",announcement:"",layout:"full",mobileLayout:"full",showAnnouncement:!1,searchEnable:!1,showLogin:!1,siteHomeName:"首页",siteHomeLogo:"",siteHomeLogoLink:"",siteHomeLogoTargetMode:"",maxShowSize:1e3,loadMoreSize:50,defaultSortField:"name",defaultSortOrder:"asc",linkExpireTimes:""},loginInfo:{isLogin:null,isAdmin:null,username:"",nickname:""},folderConfig:{readmeText:null,proxyUpload:!1,readmeDisplayMode:null,defaultSwitchToImgMode:!1,permission:{},metadata:{uploadType:null,supportRenameFolder:null,supportMoveFolder:null,supportCopyFolder:null,supportDeleteNotEmptyFolder:null,needCreateFolderBeforeUpload:null},rootPath:null},user:{rootPath:""}}),getters:{permission:t=>{let e=t.folderConfig.permission,n=t.globalConfig.showPathLink&&e.generateLink,o=t.globalConfig.showShortLink&&e.generateShortLink,s=e.download&&Ge.value.isAllFile;return{compression:!0,open:Ge.value.isSingleSelectFolder,preview:e.preview&&Ge.value.isSingleSelectFile,download:s,copyDownloadLink:s&&e.copyDownloadLink,rename:e.rename&&Ge.value.isSingleSelect,link:(n||o)&&Ge.value.isAllFile,pathLink:n,shortLink:o,bothLink:n&&o&&Ge.value.isAllFile,copy:e.copy,move:e.move,delete:e.delete,upload:e.upload,uploadFolder:e.upload&&e.newFolder,search:e.search,newFolder:e.newFolder,batchDownload:s&&e.batchDownload,packageDownload:s&&e.packageDownload}}},actions:{updateUserRootPath(t){this.user.rootPath=t},updateGlobalConfig(t){this.globalConfig=t},updateFolderConfig(t){this.folderConfig=t},updateLoginInfo(t){this.loginInfo=t}}}),Dt=Ao("fileDataStore",{state:()=>({currentClickRow:{},currentRightClickRow:{},currentStorageSource:{id:null,type:{description:"",key:""}},imgMode:!1,newImgMode:!1,oldStorageKey:null,searchParam:"",fileListSource:[],loadFileSize:-1,audioArray:[],audioIndex:0}),getters:{filterFileByType:t=>e=>t.fileListSource.filter(function(n){if(n.type==="BACK")return!1;let o=n.name,s=o.substr(o.lastIndexOf(".")+1).toLowerCase();return Le.fileTypeMap[e].indexOf(s)!==-1}),fileList:t=>{var s;if(t.loadFileSize===-1)return[];let n=((s=t.fileListSource[0])==null?void 0:s.type)==="BACK"?t.loadFileSize+1:t.loadFileSize;n=n>t.fileListSource.length?t.fileListSource.length:n;let o=t.fileListSource.slice(0,n);return o.forEach(a=>{if(a.icon||(a.icon=Na(a)),a.preview!==null){let l=Vo(a.name);l?(a.fileType=l,a.preview=Le.previewFileType.indexOf(l)!==-1):a.preview=!1}}),o},getFileUrlByName:t=>e=>{let n=t.fileListSource.find(o=>o.name===e);return n?n.url:""}},actions:{updateCurrentStorageSource(t){this.currentStorageSource=t},updateAudioIndex(t){this.audioIndex=t},updateAudioList(t){this.audioArray=t},updateCurrentClickRow(t){this.currentClickRow=t},updateCurrentRightClickRow(t){this.currentRightClickRow=t},updateFileList(t){this.fileListSource=t,this.loadFileSize=Ae().globalConfig.maxShowSize},updateOldStorageKey(t){this.oldStorageKey=t},updateLoadFileSize(t){this.loadFileSize=t}}});var ja=Ko;function Ko(t,e,n){t instanceof RegExp&&(t=Hn(t,n)),e instanceof RegExp&&(e=Hn(e,n));var o=qo(t,e,n);return o&&{start:o[0],end:o[1],pre:n.slice(0,o[0]),body:n.slice(o[0]+t.length,o[1]),post:n.slice(o[1]+e.length)}}function Hn(t,e){var n=e.match(t);return n?n[0]:null}Ko.range=qo;function qo(t,e,n){var o,s,a,l,i,r=n.indexOf(t),f=n.indexOf(e,r+1),c=r;if(r>=0&&f>0){if(t===e)return[r,f];for(o=[],a=n.length;c>=0&&!i;)c==r?(o.push(c),r=n.indexOf(t,c+1)):o.length==1?i=[o.pop(),f]:(s=o.pop(),s<a&&(a=s,l=f),f=n.indexOf(e,c+1)),c=r<f&&r>=0?r:f;o.length&&(i=[a,l])}return i}var Ho=ja,Ua=qa,Go="\0SLASH"+Math.random()+"\0",Zo="\0OPEN"+Math.random()+"\0",Fn="\0CLOSE"+Math.random()+"\0",Yo="\0COMMA"+Math.random()+"\0",Jo="\0PERIOD"+Math.random()+"\0";function on(t){return parseInt(t,10)==t?parseInt(t,10):t.charCodeAt(0)}function Va(t){return t.split("\\\\").join(Go).split("\\{").join(Zo).split("\\}").join(Fn).split("\\,").join(Yo).split("\\.").join(Jo)}function Ka(t){return t.split(Go).join("\\").split(Zo).join("{").split(Fn).join("}").split(Yo).join(",").split(Jo).join(".")}function Xo(t){if(!t)return[""];var e=[],n=Ho("{","}",t);if(!n)return t.split(",");var o=n.pre,s=n.body,a=n.post,l=o.split(",");l[l.length-1]+="{"+s+"}";var i=Xo(a);return a.length&&(l[l.length-1]+=i.shift(),l.push.apply(l,i)),e.push.apply(e,l),e}function qa(t){return t?(t.substr(0,2)==="{}"&&(t="\\{\\}"+t.substr(2)),mt(Va(t),!0).map(Ka)):[]}function Ha(t){return"{"+t+"}"}function Ga(t){return/^-?0\d/.test(t)}function Za(t,e){return t<=e}function Ya(t,e){return t>=e}function mt(t,e){var n=[],o=Ho("{","}",t);if(!o)return[t];var s=o.pre,a=o.post.length?mt(o.post,!1):[""];if(/\$$/.test(o.pre))for(var l=0;l<a.length;l++){var i=s+"{"+o.body+"}"+a[l];n.push(i)}else{var r=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(o.body),f=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(o.body),c=r||f,u=o.body.indexOf(",")>=0;if(!c&&!u)return o.post.match(/,.*\}/)?(t=o.pre+"{"+o.body+Fn+o.post,mt(t)):[t];var p;if(c)p=o.body.split(/\.\./);else if(p=Xo(o.body),p.length===1&&(p=mt(p[0],!1).map(Ha),p.length===1))return a.map(function(x){return o.pre+p[0]+x});var d;if(c){var b=on(p[0]),v=on(p[1]),_=Math.max(p[0].length,p[1].length),D=p.length==3?Math.abs(on(p[2])):1,S=Za,y=v<b;y&&(D*=-1,S=Ya);var C=p.some(Ga);d=[];for(var z=b;S(z,v);z+=D){var $;if(f)$=String.fromCharCode(z),$==="\\"&&($="");else if($=String(z),C){var h=_-$.length;if(h>0){var m=new Array(h+1).join("0");z<0?$="-"+m+$.slice(1):$=m+$}}d.push($)}}else{d=[];for(var g=0;g<p.length;g++)d.push.apply(d,mt(p[g],!1))}for(var g=0;g<d.length;g++)for(var l=0;l<a.length;l++){var i=s+d[g]+a[l];(!e||c||i)&&n.push(i)}}return n}const Ja=Bo(Ua),Xa=1024*64,Ut=t=>{if(typeof t!="string")throw new TypeError("invalid pattern");if(t.length>Xa)throw new TypeError("pattern is too long")},Qa={"[:alnum:]":["\\p{L}\\p{Nl}\\p{Nd}",!0],"[:alpha:]":["\\p{L}\\p{Nl}",!0],"[:ascii:]":["\\x00-\\x7f",!1],"[:blank:]":["\\p{Zs}\\t",!0],"[:cntrl:]":["\\p{Cc}",!0],"[:digit:]":["\\p{Nd}",!0],"[:graph:]":["\\p{Z}\\p{C}",!0,!0],"[:lower:]":["\\p{Ll}",!0],"[:print:]":["\\p{C}",!0],"[:punct:]":["\\p{P}",!0],"[:space:]":["\\p{Z}\\t\\r\\n\\v\\f",!0],"[:upper:]":["\\p{Lu}",!0],"[:word:]":["\\p{L}\\p{Nl}\\p{Nd}\\p{Pc}",!0],"[:xdigit:]":["A-Fa-f0-9",!1]},it=t=>t.replace(/[[\]\\-]/g,"\\$&"),es=t=>t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),Gn=t=>t.join(""),ts=(t,e)=>{const n=e;if(t.charAt(n)!=="[")throw new Error("not in a brace expression");const o=[],s=[];let a=n+1,l=!1,i=!1,r=!1,f=!1,c=n,u="";e:for(;a<t.length;){const v=t.charAt(a);if((v==="!"||v==="^")&&a===n+1){f=!0,a++;continue}if(v==="]"&&l&&!r){c=a+1;break}if(l=!0,v==="\\"&&!r){r=!0,a++;continue}if(v==="["&&!r){for(const[_,[D,S,y]]of Object.entries(Qa))if(t.startsWith(_,a)){if(u)return["$.",!1,t.length-n,!0];a+=_.length,y?s.push(D):o.push(D),i=i||S;continue e}}if(r=!1,u){v>u?o.push(it(u)+"-"+it(v)):v===u&&o.push(it(v)),u="",a++;continue}if(t.startsWith("-]",a+1)){o.push(it(v+"-")),a+=2;continue}if(t.startsWith("-",a+1)){u=v,a+=2;continue}o.push(it(v)),a++}if(c<a)return["",!1,0,!1];if(!o.length&&!s.length)return["$.",!1,t.length-n,!0];if(s.length===0&&o.length===1&&/^\\?.$/.test(o[0])&&!f){const v=o[0].length===2?o[0].slice(-1):o[0];return[es(v),!1,c-n,!1]}const p="["+(f?"^":"")+Gn(o)+"]",d="["+(f?"":"^")+Gn(s)+"]";return[o.length&&s.length?"("+p+"|"+d+")":o.length?p:d,i,c-n,!0]},vt=(t,{windowsPathsNoEscape:e=!1}={})=>e?t.replace(/\[([^\/\\])\]/g,"$1"):t.replace(/((?!\\).|^)\[([^\/\\])\]/g,"$1$2").replace(/\\([^\/])/g,"$1"),ns=new Set(["!","?","+","*","@"]),Zn=t=>ns.has(t),os="(?!(?:^|/)\\.\\.?(?:$|/))",Et="(?!\\.)",as=new Set(["[","."]),ss=new Set(["..","."]),ls=new Set("().*{}+?[]^$\\!"),is=t=>t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),En="[^/]",Yn=En+"*?",Jn=En+"+?";var Z,X,De,W,q,Pe,Ke,Me,we,qe,xt,Gt,Qo,tt,It,kt,Cn,Zt,ea;const ne=class ne{constructor(e,n,o={}){te(this,Gt);te(this,kt);G(this,"type");te(this,Z,void 0);te(this,X,void 0);te(this,De,!1);te(this,W,[]);te(this,q,void 0);te(this,Pe,void 0);te(this,Ke,void 0);te(this,Me,!1);te(this,we,void 0);te(this,qe,void 0);te(this,xt,!1);this.type=e,e&&K(this,X,!0),K(this,q,n),K(this,Z,w(this,q)?w(w(this,q),Z):this),K(this,we,w(this,Z)===this?o:w(w(this,Z),we)),K(this,Ke,w(this,Z)===this?[]:w(w(this,Z),Ke)),e==="!"&&!w(w(this,Z),Me)&&w(this,Ke).push(this),K(this,Pe,w(this,q)?w(w(this,q),W).length:0)}get hasMagic(){if(w(this,X)!==void 0)return w(this,X);for(const e of w(this,W))if(typeof e!="string"&&(e.type||e.hasMagic))return K(this,X,!0);return w(this,X)}toString(){return w(this,qe)!==void 0?w(this,qe):this.type?K(this,qe,this.type+"("+w(this,W).map(e=>String(e)).join("|")+")"):K(this,qe,w(this,W).map(e=>String(e)).join(""))}push(...e){for(const n of e)if(n!==""){if(typeof n!="string"&&!(n instanceof ne&&w(n,q)===this))throw new Error("invalid part: "+n);w(this,W).push(n)}}toJSON(){var n;const e=this.type===null?w(this,W).slice().map(o=>typeof o=="string"?o:o.toJSON()):[this.type,...w(this,W).map(o=>o.toJSON())];return this.isStart()&&!this.type&&e.unshift([]),this.isEnd()&&(this===w(this,Z)||w(w(this,Z),Me)&&((n=w(this,q))==null?void 0:n.type)==="!")&&e.push({}),e}isStart(){var n;if(w(this,Z)===this)return!0;if(!((n=w(this,q))!=null&&n.isStart()))return!1;if(w(this,Pe)===0)return!0;const e=w(this,q);for(let o=0;o<w(this,Pe);o++){const s=w(e,W)[o];if(!(s instanceof ne&&s.type==="!"))return!1}return!0}isEnd(){var n,o,s;if(w(this,Z)===this||((n=w(this,q))==null?void 0:n.type)==="!")return!0;if(!((o=w(this,q))!=null&&o.isEnd()))return!1;if(!this.type)return(s=w(this,q))==null?void 0:s.isEnd();const e=w(this,q)?w(w(this,q),W).length:0;return w(this,Pe)===e-1}copyIn(e){typeof e=="string"?this.push(e):this.push(e.clone(this))}clone(e){const n=new ne(this.type,e);for(const o of w(this,W))n.copyIn(o);return n}static fromGlob(e,n={}){var s;const o=new ne(null,void 0,n);return Te(s=ne,tt,It).call(s,e,o,0,n),o}toMMPattern(){if(this!==w(this,Z))return w(this,Z).toMMPattern();const e=this.toString(),[n,o,s,a]=this.toRegExpSource();if(!(s||w(this,X)||w(this,we).nocase&&!w(this,we).nocaseMagicOnly&&e.toUpperCase()!==e.toLowerCase()))return o;const i=(w(this,we).nocase?"i":"")+(a?"u":"");return Object.assign(new RegExp("^".concat(n,"$"),i),{_src:n,_glob:e})}get options(){return w(this,we)}toRegExpSource(e){var r;const n=e!=null?e:!!w(this,we).dot;if(w(this,Z)===this&&Te(this,Gt,Qo).call(this),!this.type){const f=this.isStart()&&this.isEnd(),c=w(this,W).map(b=>{var y;const[v,_,D,S]=typeof b=="string"?Te(y=ne,Zt,ea).call(y,b,w(this,X),f):b.toRegExpSource(e);return K(this,X,w(this,X)||D),K(this,De,w(this,De)||S),v}).join("");let u="";if(this.isStart()&&typeof w(this,W)[0]=="string"&&!(w(this,W).length===1&&ss.has(w(this,W)[0]))){const v=as,_=n&&v.has(c.charAt(0))||c.startsWith("\\.")&&v.has(c.charAt(2))||c.startsWith("\\.\\.")&&v.has(c.charAt(4)),D=!n&&!e&&v.has(c.charAt(0));u=_?os:D?Et:""}let p="";return this.isEnd()&&w(w(this,Z),Me)&&((r=w(this,q))==null?void 0:r.type)==="!"&&(p="(?:$|\\/)"),[u+c+p,vt(c),K(this,X,!!w(this,X)),w(this,De)]}const o=this.type==="*"||this.type==="+",s=this.type==="!"?"(?:(?!(?:":"(?:";let a=Te(this,kt,Cn).call(this,n);if(this.isStart()&&this.isEnd()&&!a&&this.type!=="!"){const f=this.toString();return K(this,W,[f]),this.type=null,K(this,X,void 0),[f,vt(this.toString()),!1,!1]}let l=!o||e||n||!Et?"":Te(this,kt,Cn).call(this,!0);l===a&&(l=""),l&&(a="(?:".concat(a,")(?:").concat(l,")*?"));let i="";if(this.type==="!"&&w(this,xt))i=(this.isStart()&&!n?Et:"")+Jn;else{const f=this.type==="!"?"))"+(this.isStart()&&!n&&!e?Et:"")+Yn+")":this.type==="@"?")":this.type==="?"?")?":this.type==="+"&&l?")":this.type==="*"&&l?")?":")".concat(this.type);i=s+a+f}return[i,vt(a),K(this,X,!!w(this,X)),w(this,De)]}};Z=new WeakMap,X=new WeakMap,De=new WeakMap,W=new WeakMap,q=new WeakMap,Pe=new WeakMap,Ke=new WeakMap,Me=new WeakMap,we=new WeakMap,qe=new WeakMap,xt=new WeakMap,Gt=new WeakSet,Qo=function(){if(this!==w(this,Z))throw new Error("should only call on root");if(w(this,Me))return this;this.toString(),K(this,Me,!0);let e;for(;e=w(this,Ke).pop();){if(e.type!=="!")continue;let n=e,o=w(n,q);for(;o;){for(let s=w(n,Pe)+1;!o.type&&s<w(o,W).length;s++)for(const a of w(e,W)){if(typeof a=="string")throw new Error("string part in extglob AST??");a.copyIn(w(o,W)[s])}n=o,o=w(n,q)}}return this},tt=new WeakSet,It=function(e,n,o,s){var d,b;let a=!1,l=!1,i=-1,r=!1;if(n.type===null){let v=o,_="";for(;v<e.length;){const D=e.charAt(v++);if(a||D==="\\"){a=!a,_+=D;continue}if(l){v===i+1?(D==="^"||D==="!")&&(r=!0):D==="]"&&!(v===i+2&&r)&&(l=!1),_+=D;continue}else if(D==="["){l=!0,i=v,r=!1,_+=D;continue}if(!s.noext&&Zn(D)&&e.charAt(v)==="("){n.push(_),_="";const S=new ne(D,n);v=Te(d=ne,tt,It).call(d,e,S,v,s),n.push(S);continue}_+=D}return n.push(_),v}let f=o+1,c=new ne(null,n);const u=[];let p="";for(;f<e.length;){const v=e.charAt(f++);if(a||v==="\\"){a=!a,p+=v;continue}if(l){f===i+1?(v==="^"||v==="!")&&(r=!0):v==="]"&&!(f===i+2&&r)&&(l=!1),p+=v;continue}else if(v==="["){l=!0,i=f,r=!1,p+=v;continue}if(Zn(v)&&e.charAt(f)==="("){c.push(p),p="";const _=new ne(v,c);c.push(_),f=Te(b=ne,tt,It).call(b,e,_,f,s);continue}if(v==="|"){c.push(p),p="",u.push(c),c=new ne(null,n);continue}if(v===")")return p===""&&w(n,W).length===0&&K(n,xt,!0),c.push(p),p="",n.push(...u,c),f;p+=v}return n.type=null,K(n,X,void 0),K(n,W,[e.substring(o-1)]),f},kt=new WeakSet,Cn=function(e){return w(this,W).map(n=>{if(typeof n=="string")throw new Error("string type in extglob ast??");const[o,s,a,l]=n.toRegExpSource(e);return K(this,De,w(this,De)||l),o}).filter(n=>!(this.isStart()&&this.isEnd())||!!n).join("|")},Zt=new WeakSet,ea=function(e,n,o=!1){let s=!1,a="",l=!1;for(let i=0;i<e.length;i++){const r=e.charAt(i);if(s){s=!1,a+=(ls.has(r)?"\\":"")+r;continue}if(r==="\\"){i===e.length-1?a+="\\\\":s=!0;continue}if(r==="["){const[f,c,u,p]=ts(e,i);if(u){a+=f,l=l||c,i+=u-1,n=n||p;continue}}if(r==="*"){o&&e==="*"?a+=Jn:a+=Yn,n=!0;continue}if(r==="?"){a+=En,n=!0;continue}a+=is(r)}return[a,vt(e),!!n,l]},te(ne,tt),te(ne,Zt);let Vt=ne;const rs=(t,{windowsPathsNoEscape:e=!1}={})=>e?t.replace(/[?*()[\]]/g,"[$&]"):t.replace(/[?*()[\]\\]/g,"\\$&"),ae=(t,e,n={})=>(Ut(e),!n.nocomment&&e.charAt(0)==="#"?!1:new Jt(e,n).match(t)),cs=/^\*+([^+@!?\*\[\(]*)$/,us=t=>e=>!e.startsWith(".")&&e.endsWith(t),ds=t=>e=>e.endsWith(t),fs=t=>(t=t.toLowerCase(),e=>!e.startsWith(".")&&e.toLowerCase().endsWith(t)),hs=t=>(t=t.toLowerCase(),e=>e.toLowerCase().endsWith(t)),ps=/^\*+\.\*+$/,gs=t=>!t.startsWith(".")&&t.includes("."),ms=t=>t!=="."&&t!==".."&&t.includes("."),vs=/^\.\*+$/,ys=t=>t!=="."&&t!==".."&&t.startsWith("."),bs=/^\*+$/,ws=t=>t.length!==0&&!t.startsWith("."),Ss=t=>t.length!==0&&t!=="."&&t!=="..",Cs=/^\?+([^+@!?\*\[\(]*)?$/,xs=([t,e=""])=>{const n=ta([t]);return e?(e=e.toLowerCase(),o=>n(o)&&o.toLowerCase().endsWith(e)):n},ks=([t,e=""])=>{const n=na([t]);return e?(e=e.toLowerCase(),o=>n(o)&&o.toLowerCase().endsWith(e)):n},_s=([t,e=""])=>{const n=na([t]);return e?o=>n(o)&&o.endsWith(e):n},Ds=([t,e=""])=>{const n=ta([t]);return e?o=>n(o)&&o.endsWith(e):n},ta=([t])=>{const e=t.length;return n=>n.length===e&&!n.startsWith(".")},na=([t])=>{const e=t.length;return n=>n.length===e&&n!=="."&&n!==".."},oa=typeof process=="object"&&process?typeof{}=="object"&&{}&&{}.__MINIMATCH_TESTING_PLATFORM__||process.platform:"posix",Xn={win32:{sep:"\\"},posix:{sep:"/"}},Ls=oa==="win32"?Xn.win32.sep:Xn.posix.sep;ae.sep=Ls;const he=Symbol("globstar **");ae.GLOBSTAR=he;const Ts="[^/]",Fs=Ts+"*?",Es="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",zs="(?:(?!(?:\\/|^)\\.).)*?",$s=(t,e={})=>n=>ae(n,t,e);ae.filter=$s;const fe=(t,e={})=>Object.assign({},t,e),Ps=t=>{if(!t||typeof t!="object"||!Object.keys(t).length)return ae;const e=ae;return Object.assign((o,s,a={})=>e(o,s,fe(t,a)),{Minimatch:class extends e.Minimatch{constructor(s,a={}){super(s,fe(t,a))}static defaults(s){return e.defaults(fe(t,s)).Minimatch}},AST:class extends e.AST{constructor(s,a,l={}){super(s,a,fe(t,l))}static fromGlob(s,a={}){return e.AST.fromGlob(s,fe(t,a))}},unescape:(o,s={})=>e.unescape(o,fe(t,s)),escape:(o,s={})=>e.escape(o,fe(t,s)),filter:(o,s={})=>e.filter(o,fe(t,s)),defaults:o=>e.defaults(fe(t,o)),makeRe:(o,s={})=>e.makeRe(o,fe(t,s)),braceExpand:(o,s={})=>e.braceExpand(o,fe(t,s)),match:(o,s,a={})=>e.match(o,s,fe(t,a)),sep:e.sep,GLOBSTAR:he})};ae.defaults=Ps;const aa=(t,e={})=>(Ut(t),e.nobrace||!/\{(?:(?!\{).)*\}/.test(t)?[t]:Ja(t));ae.braceExpand=aa;const Ms=(t,e={})=>new Jt(t,e).makeRe();ae.makeRe=Ms;const Rs=(t,e,n={})=>{const o=new Jt(e,n);return t=t.filter(s=>o.match(s)),o.options.nonull&&!t.length&&t.push(e),t};ae.match=Rs;const Qn=/[?*]|[+@!]\(.*?\)|\[|\]/,As=t=>t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");class Jt{constructor(e,n={}){G(this,"options");G(this,"set");G(this,"pattern");G(this,"windowsPathsNoEscape");G(this,"nonegate");G(this,"negate");G(this,"comment");G(this,"empty");G(this,"preserveMultipleSlashes");G(this,"partial");G(this,"globSet");G(this,"globParts");G(this,"nocase");G(this,"isWindows");G(this,"platform");G(this,"windowsNoMagicRoot");G(this,"regexp");Ut(e),n=n||{},this.options=n,this.pattern=e,this.platform=n.platform||oa,this.isWindows=this.platform==="win32",this.windowsPathsNoEscape=!!n.windowsPathsNoEscape||n.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.preserveMultipleSlashes=!!n.preserveMultipleSlashes,this.regexp=null,this.negate=!1,this.nonegate=!!n.nonegate,this.comment=!1,this.empty=!1,this.partial=!!n.partial,this.nocase=!!this.options.nocase,this.windowsNoMagicRoot=n.windowsNoMagicRoot!==void 0?n.windowsNoMagicRoot:!!(this.isWindows&&this.nocase),this.globSet=[],this.globParts=[],this.set=[],this.make()}hasMagic(){if(this.options.magicalBraces&&this.set.length>1)return!0;for(const e of this.set)for(const n of e)if(typeof n!="string")return!0;return!1}debug(...e){}make(){const e=this.pattern,n=this.options;if(!n.nocomment&&e.charAt(0)==="#"){this.comment=!0;return}if(!e){this.empty=!0;return}this.parseNegate(),this.globSet=[...new Set(this.braceExpand())],n.debug&&(this.debug=(...a)=>console.error(...a)),this.debug(this.pattern,this.globSet);const o=this.globSet.map(a=>this.slashSplit(a));this.globParts=this.preprocess(o),this.debug(this.pattern,this.globParts);let s=this.globParts.map((a,l,i)=>{if(this.isWindows&&this.windowsNoMagicRoot){const r=a[0]===""&&a[1]===""&&(a[2]==="?"||!Qn.test(a[2]))&&!Qn.test(a[3]),f=/^[a-z]:/i.test(a[0]);if(r)return[...a.slice(0,4),...a.slice(4).map(c=>this.parse(c))];if(f)return[a[0],...a.slice(1).map(c=>this.parse(c))]}return a.map(r=>this.parse(r))});if(this.debug(this.pattern,s),this.set=s.filter(a=>a.indexOf(!1)===-1),this.isWindows)for(let a=0;a<this.set.length;a++){const l=this.set[a];l[0]===""&&l[1]===""&&this.globParts[a][2]==="?"&&typeof l[3]=="string"&&/^[a-z]:$/i.test(l[3])&&(l[2]="?")}this.debug(this.pattern,this.set)}preprocess(e){if(this.options.noglobstar)for(let o=0;o<e.length;o++)for(let s=0;s<e[o].length;s++)e[o][s]==="**"&&(e[o][s]="*");const{optimizationLevel:n=1}=this.options;return n>=2?(e=this.firstPhasePreProcess(e),e=this.secondPhasePreProcess(e)):n>=1?e=this.levelOneOptimize(e):e=this.adjascentGlobstarOptimize(e),e}adjascentGlobstarOptimize(e){return e.map(n=>{let o=-1;for(;(o=n.indexOf("**",o+1))!==-1;){let s=o;for(;n[s+1]==="**";)s++;s!==o&&n.splice(o,s-o)}return n})}levelOneOptimize(e){return e.map(n=>(n=n.reduce((o,s)=>{const a=o[o.length-1];return s==="**"&&a==="**"?o:s===".."&&a&&a!==".."&&a!=="."&&a!=="**"?(o.pop(),o):(o.push(s),o)},[]),n.length===0?[""]:n))}levelTwoFileOptimize(e){Array.isArray(e)||(e=this.slashSplit(e));let n=!1;do{if(n=!1,!this.preserveMultipleSlashes){for(let s=1;s<e.length-1;s++){const a=e[s];s===1&&a===""&&e[0]===""||(a==="."||a==="")&&(n=!0,e.splice(s,1),s--)}e[0]==="."&&e.length===2&&(e[1]==="."||e[1]==="")&&(n=!0,e.pop())}let o=0;for(;(o=e.indexOf("..",o+1))!==-1;){const s=e[o-1];s&&s!=="."&&s!==".."&&s!=="**"&&(n=!0,e.splice(o-1,2),o-=2)}}while(n);return e.length===0?[""]:e}firstPhasePreProcess(e){let n=!1;do{n=!1;for(let o of e){let s=-1;for(;(s=o.indexOf("**",s+1))!==-1;){let l=s;for(;o[l+1]==="**";)l++;l>s&&o.splice(s+1,l-s);let i=o[s+1];const r=o[s+2],f=o[s+3];if(i!==".."||!r||r==="."||r===".."||!f||f==="."||f==="..")continue;n=!0,o.splice(s,1);const c=o.slice(0);c[s]="**",e.push(c),s--}if(!this.preserveMultipleSlashes){for(let l=1;l<o.length-1;l++){const i=o[l];l===1&&i===""&&o[0]===""||(i==="."||i==="")&&(n=!0,o.splice(l,1),l--)}o[0]==="."&&o.length===2&&(o[1]==="."||o[1]==="")&&(n=!0,o.pop())}let a=0;for(;(a=o.indexOf("..",a+1))!==-1;){const l=o[a-1];if(l&&l!=="."&&l!==".."&&l!=="**"){n=!0;const r=a===1&&o[a+1]==="**"?["."]:[];o.splice(a-1,2,...r),o.length===0&&o.push(""),a-=2}}}}while(n);return e}secondPhasePreProcess(e){for(let n=0;n<e.length-1;n++)for(let o=n+1;o<e.length;o++){const s=this.partsMatch(e[n],e[o],!this.preserveMultipleSlashes);if(s){e[n]=[],e[o]=s;break}}return e.filter(n=>n.length)}partsMatch(e,n,o=!1){let s=0,a=0,l=[],i="";for(;s<e.length&&a<n.length;)if(e[s]===n[a])l.push(i==="b"?n[a]:e[s]),s++,a++;else if(o&&e[s]==="**"&&n[a]===e[s+1])l.push(e[s]),s++;else if(o&&n[a]==="**"&&e[s]===n[a+1])l.push(n[a]),a++;else if(e[s]==="*"&&n[a]&&(this.options.dot||!n[a].startsWith("."))&&n[a]!=="**"){if(i==="b")return!1;i="a",l.push(e[s]),s++,a++}else if(n[a]==="*"&&e[s]&&(this.options.dot||!e[s].startsWith("."))&&e[s]!=="**"){if(i==="a")return!1;i="b",l.push(n[a]),s++,a++}else return!1;return e.length===n.length&&l}parseNegate(){if(this.nonegate)return;const e=this.pattern;let n=!1,o=0;for(let s=0;s<e.length&&e.charAt(s)==="!";s++)n=!n,o++;o&&(this.pattern=e.slice(o)),this.negate=n}matchOne(e,n,o=!1){const s=this.options;if(this.isWindows){const v=typeof e[0]=="string"&&/^[a-z]:$/i.test(e[0]),_=!v&&e[0]===""&&e[1]===""&&e[2]==="?"&&/^[a-z]:$/i.test(e[3]),D=typeof n[0]=="string"&&/^[a-z]:$/i.test(n[0]),S=!D&&n[0]===""&&n[1]===""&&n[2]==="?"&&typeof n[3]=="string"&&/^[a-z]:$/i.test(n[3]),y=_?3:v?0:void 0,C=S?3:D?0:void 0;if(typeof y=="number"&&typeof C=="number"){const[z,$]=[e[y],n[C]];z.toLowerCase()===$.toLowerCase()&&(n[C]=z,C>y?n=n.slice(C):y>C&&(e=e.slice(y)))}}const{optimizationLevel:a=1}=this.options;a>=2&&(e=this.levelTwoFileOptimize(e)),this.debug("matchOne",this,{file:e,pattern:n}),this.debug("matchOne",e.length,n.length);for(var l=0,i=0,r=e.length,f=n.length;l<r&&i<f;l++,i++){this.debug("matchOne loop");var c=n[i],u=e[l];if(this.debug(n,c,u),c===!1)return!1;if(c===he){this.debug("GLOBSTAR",[n,c,u]);var p=l,d=i+1;if(d===f){for(this.debug("** at the end");l<r;l++)if(e[l]==="."||e[l]===".."||!s.dot&&e[l].charAt(0)===".")return!1;return!0}for(;p<r;){var b=e[p];if(this.debug("\nglobstar while",e,p,n,d,b),this.matchOne(e.slice(p),n.slice(d),o))return this.debug("globstar found match!",p,r,b),!0;if(b==="."||b===".."||!s.dot&&b.charAt(0)==="."){this.debug("dot detected!",e,p,n,d);break}this.debug("globstar swallow a segment, and continue"),p++}return!!(o&&(this.debug("\n>>> no match, partial?",e,p,n,d),p===r))}let v;if(typeof c=="string"?(v=u===c,this.debug("string match",c,u,v)):(v=c.test(u),this.debug("pattern match",c,u,v)),!v)return!1}if(l===r&&i===f)return!0;if(l===r)return o;if(i===f)return l===r-1&&e[l]==="";throw new Error("wtf?")}braceExpand(){return aa(this.pattern,this.options)}parse(e){Ut(e);const n=this.options;if(e==="**")return he;if(e==="")return"";let o,s=null;(o=e.match(bs))?s=n.dot?Ss:ws:(o=e.match(cs))?s=(n.nocase?n.dot?hs:fs:n.dot?ds:us)(o[1]):(o=e.match(Cs))?s=(n.nocase?n.dot?ks:xs:n.dot?_s:Ds)(o):(o=e.match(ps))?s=n.dot?ms:gs:(o=e.match(vs))&&(s=ys);const a=Vt.fromGlob(e,this.options).toMMPattern();return s&&typeof a=="object"&&Reflect.defineProperty(a,"test",{value:s}),a}makeRe(){if(this.regexp||this.regexp===!1)return this.regexp;const e=this.set;if(!e.length)return this.regexp=!1,this.regexp;const n=this.options,o=n.noglobstar?Fs:n.dot?Es:zs,s=new Set(n.nocase?["i"]:[]);let a=e.map(r=>{const f=r.map(c=>{if(c instanceof RegExp)for(const u of c.flags.split(""))s.add(u);return typeof c=="string"?As(c):c===he?he:c._src});return f.forEach((c,u)=>{const p=f[u+1],d=f[u-1];c!==he||d===he||(d===void 0?p!==void 0&&p!==he?f[u+1]="(?:\\/|"+o+"\\/)?"+p:f[u]=o:p===void 0?f[u-1]=d+"(?:\\/|"+o+")?":p!==he&&(f[u-1]=d+"(?:\\/|\\/"+o+"\\/)"+p,f[u+1]=he))}),f.filter(c=>c!==he).join("/")}).join("|");const[l,i]=e.length>1?["(?:",")"]:["",""];a="^"+l+a+i+"$",this.negate&&(a="^(?!"+a+").+$");try{this.regexp=new RegExp(a,[...s].join(""))}catch(r){this.regexp=!1}return this.regexp}slashSplit(e){return this.preserveMultipleSlashes?e.split("/"):this.isWindows&&/^\/\/[^\/]+/.test(e)?["",...e.split(/\/+/)]:e.split(/\/+/)}match(e,n=this.partial){if(this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return e==="";if(e==="/"&&n)return!0;const o=this.options;this.isWindows&&(e=e.split("\\").join("/"));const s=this.slashSplit(e);this.debug(this.pattern,"split",s);const a=this.set;this.debug(this.pattern,"set",a);let l=s[s.length-1];if(!l)for(let i=s.length-2;!l&&i>=0;i--)l=s[i];for(let i=0;i<a.length;i++){const r=a[i];let f=s;if(o.matchBase&&r.length===1&&(f=[l]),this.matchOne(f,r,n))return o.flipNegate?!0:!this.negate}return o.flipNegate?!1:this.negate}static defaults(e){return ae.defaults(e).Minimatch}}ae.AST=Vt;ae.Minimatch=Jt;ae.escape=rs;ae.unescape=vt;let{storageKey:Be,currentPath:Bs}=at();const Oe=Dn("zfile-pwd-cache",{}),Fe=Dn("zfile-pwd-full-cache",{},sessionStorage);let Os=Ae();function Xt(){return{putPathPwd:(o,s,a)=>{o&&(o=o.startsWith("/")?o:"/"+o,Oe.value[Be.value]||(Oe.value[Be.value]={}),Fe.value[Be.value]||(Fe.value[Be.value]={}),o.endsWith("**")&&!o.endsWith("/**")&&(o=Qe(o.substring(0,o.length-2)+"/**"),console.log("检测到密码文件夹通配符 ** 前未写 /，自动将其修正为为：",o)),a&&(Oe.value[Be.value][o]=s),Fe.value[Be.value][o]=s)},getPathPwd:(o,s)=>{let a=o||Bs.value,l=Os.user.rootPath;a=jt("/",l,a,"/"),Object.keys(Fe.value).length===0&&Object.keys(Oe.value).length!==0&&(Fe.value=JSON.parse(JSON.stringify(Oe.value)),console.log("检测到全量密码缓存为空，自动将其初始化为：",Fe.value));let i=s?Oe.value:Fe.value;for(let r of Object.keys(i))if(r===Be.value){for(let f of Object.keys(i[r]))if(f.endsWith("*")&&(a=a+"*"),ae(a,f))return i[r][f]}return""},clearPwdCache:()=>{Oe.value={},Fe.value={},j.success("操作成功")}}}let{getPathPwd:Qt}=Xt();const sa=t=>(t.password=Qt(t.path),Q({url:"/api/file/operator/mkdir",method:"post",data:t})),Is=t=>Q({url:"/api/file/operator/delete/batch",method:"post",data:t}),Ns=t=>(console.log(t),Q({url:"/api/file/operator/compression",method:"post",data:t})),Ws=t=>(t.password=Qt(t.path),Q({url:"/api/file/operator/rename/file",method:"post",data:t})),js=t=>(t.password=Qt(t.path),Q({url:"/api/file/operator/rename/folder",method:"post",data:t})),eo=t=>(t.password=Qt(t.path),Q({url:"/api/file/operator/upload/file",method:"post",data:t})),Us=t=>Q({url:"/api/file/operator/move/file",method:"post",data:t}),Vs=t=>Q({url:"/api/file/operator/move/folder",method:"post",data:t}),Ks=t=>Q({url:"/api/file/operator/copy/file",method:"post",data:t}),qs=t=>Q({url:"/api/file/operator/copy/folder",method:"post",data:t});const{selectRows:Hs,clearSelection:Gs,toggleRowSelection:Zs}=_t();let{storageKey:Ys}=at(),Js=Dt();const an=E(!1),sn=E(!1);let zt;function Xs(){return{initContextMenu:n=>{zt=n.value},showFileMenu:(n,o,s)=>{if(Ys.value){if(n instanceof Event){s=n;let a=document.querySelector(".zfile-index-body"),l=document.querySelector(".el-dialog");if(!a.contains(s.target)||l!=null&&l.contains(s.target))return;sn.value=!0}else{if(n.type==="BACK")return;Js.updateCurrentRightClickRow(n),Hs.value.includes(n)||(Gs(),Zs(n,!0)),an.value=!0}s.preventDefault(),s.stopPropagation(),zt.show({top:s.clientY,left:s.clientX}),window.onclick=()=>{zt.hide(),sn.value=!1,an.value=!1},zt.$el.hidden=!1}},contextMenuTargetFile:an,contextMenuTargetBlank:sn}}function me(t){if(typeof t!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(t))}function to(t,e){for(var n="",o=0,s=-1,a=0,l,i=0;i<=t.length;++i){if(i<t.length)l=t.charCodeAt(i);else{if(l===47)break;l=47}if(l===47){if(!(s===i-1||a===1))if(s!==i-1&&a===2){if(n.length<2||o!==2||n.charCodeAt(n.length-1)!==46||n.charCodeAt(n.length-2)!==46){if(n.length>2){var r=n.lastIndexOf("/");if(r!==n.length-1){r===-1?(n="",o=0):(n=n.slice(0,r),o=n.length-1-n.lastIndexOf("/")),s=i,a=0;continue}}else if(n.length===2||n.length===1){n="",o=0,s=i,a=0;continue}}e&&(n.length>0?n+="/..":n="..",o=2)}else n.length>0?n+="/"+t.slice(s+1,i):n=t.slice(s+1,i),o=i-s-1;s=i,a=0}else l===46&&a!==-1?++a:a=-1}return n}function Qs(t,e){var n=e.dir||e.root,o=e.base||(e.name||"")+(e.ext||"");return n?n===e.root?n+o:n+t+o:o}var et={resolve:function(){for(var e="",n=!1,o,s=arguments.length-1;s>=-1&&!n;s--){var a;s>=0?a=arguments[s]:(o===void 0&&(o=process.cwd()),a=o),me(a),a.length!==0&&(e=a+"/"+e,n=a.charCodeAt(0)===47)}return e=to(e,!n),n?e.length>0?"/"+e:"/":e.length>0?e:"."},normalize:function(e){if(me(e),e.length===0)return".";var n=e.charCodeAt(0)===47,o=e.charCodeAt(e.length-1)===47;return e=to(e,!n),e.length===0&&!n&&(e="."),e.length>0&&o&&(e+="/"),n?"/"+e:e},isAbsolute:function(e){return me(e),e.length>0&&e.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var e,n=0;n<arguments.length;++n){var o=arguments[n];me(o),o.length>0&&(e===void 0?e=o:e+="/"+o)}return e===void 0?".":et.normalize(e)},relative:function(e,n){if(me(e),me(n),e===n||(e=et.resolve(e),n=et.resolve(n),e===n))return"";for(var o=1;o<e.length&&e.charCodeAt(o)===47;++o);for(var s=e.length,a=s-o,l=1;l<n.length&&n.charCodeAt(l)===47;++l);for(var i=n.length,r=i-l,f=a<r?a:r,c=-1,u=0;u<=f;++u){if(u===f){if(r>f){if(n.charCodeAt(l+u)===47)return n.slice(l+u+1);if(u===0)return n.slice(l+u)}else a>f&&(e.charCodeAt(o+u)===47?c=u:u===0&&(c=0));break}var p=e.charCodeAt(o+u),d=n.charCodeAt(l+u);if(p!==d)break;p===47&&(c=u)}var b="";for(u=o+c+1;u<=s;++u)(u===s||e.charCodeAt(u)===47)&&(b.length===0?b+="..":b+="/..");return b.length>0?b+n.slice(l+c):(l+=c,n.charCodeAt(l)===47&&++l,n.slice(l))},_makeLong:function(e){return e},dirname:function(e){if(me(e),e.length===0)return".";for(var n=e.charCodeAt(0),o=n===47,s=-1,a=!0,l=e.length-1;l>=1;--l)if(n=e.charCodeAt(l),n===47){if(!a){s=l;break}}else a=!1;return s===-1?o?"/":".":o&&s===1?"//":e.slice(0,s)},basename:function(e,n){if(n!==void 0&&typeof n!="string")throw new TypeError('"ext" argument must be a string');me(e);var o=0,s=-1,a=!0,l;if(n!==void 0&&n.length>0&&n.length<=e.length){if(n.length===e.length&&n===e)return"";var i=n.length-1,r=-1;for(l=e.length-1;l>=0;--l){var f=e.charCodeAt(l);if(f===47){if(!a){o=l+1;break}}else r===-1&&(a=!1,r=l+1),i>=0&&(f===n.charCodeAt(i)?--i===-1&&(s=l):(i=-1,s=r))}return o===s?s=r:s===-1&&(s=e.length),e.slice(o,s)}else{for(l=e.length-1;l>=0;--l)if(e.charCodeAt(l)===47){if(!a){o=l+1;break}}else s===-1&&(a=!1,s=l+1);return s===-1?"":e.slice(o,s)}},extname:function(e){me(e);for(var n=-1,o=0,s=-1,a=!0,l=0,i=e.length-1;i>=0;--i){var r=e.charCodeAt(i);if(r===47){if(!a){o=i+1;break}continue}s===-1&&(a=!1,s=i+1),r===46?n===-1?n=i:l!==1&&(l=1):n!==-1&&(l=-1)}return n===-1||s===-1||l===0||l===1&&n===s-1&&n===o+1?"":e.slice(n,s)},format:function(e){if(e===null||typeof e!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return Qs("/",e)},parse:function(e){me(e);var n={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return n;var o=e.charCodeAt(0),s=o===47,a;s?(n.root="/",a=1):a=0;for(var l=-1,i=0,r=-1,f=!0,c=e.length-1,u=0;c>=a;--c){if(o=e.charCodeAt(c),o===47){if(!f){i=c+1;break}continue}r===-1&&(f=!1,r=c+1),o===46?l===-1?l=c:u!==1&&(u=1):l!==-1&&(u=-1)}return l===-1||r===-1||u===0||u===1&&l===r-1&&l===i+1?r!==-1&&(i===0&&s?n.base=n.name=e.slice(1,r):n.base=n.name=e.slice(i,r)):(i===0&&s?(n.name=e.slice(1,l),n.base=e.slice(1,r)):(n.name=e.slice(i,l),n.base=e.slice(i,r)),n.ext=e.slice(l,r)),i>0?n.dir=e.slice(0,i-1):s&&(n.dir="/"),n},sep:"/",delimiter:":",win32:null,posix:null};et.posix=et;var el=et;const $t=Bo(el),Ir=()=>Q({url:"/api/site/config/global",method:"get"}),tl=t=>Q({url:"/api/site/config/storage",method:"post",data:t}),Nr=t=>Q({url:"/api/site/config/userRootPath/".concat(t),method:"get"}),nl=t=>Q({url:"/api/storage/list",method:"get",data:t}),la=t=>Q({url:"/api/storage/files",method:"post",data:t,config:{showDefaultMsg:!1}}),Wr=t=>Q({url:"/api/storage/file/item",method:"post",data:t,config:{responseIntercept:!1,showDefaultMsg:!1}}),jr=t=>Q({url:"/api/short-link/batch/generate",method:"post",data:t}),Kt=E(!1),ia=E(!1);let no=Yt(),ra=oe(()=>{let t=no.zfileConfig.skeleton.enable,e=no.zfileConfig.skeleton.show;return t?e==="always"?Kt.value:ia.value?!1:Kt.value:!1}),ol=oe(()=>ra.value?!1:Kt.value);function zn(){return{loading:Kt,firstLoading:ia,skeletonLoading:ra,basicLoading:ol}}const{loading:al}=zn();let oo=Dt(),Ie=Ae(),{routerRef:ln,fullpath:sl,storageKey:Pt}=at(),Ee=E([]),rt=E(),ao=!1;function ll(){let t=Ie.globalConfig.rootShowStorage,e=()=>new Promise(i=>{nl().then(r=>{if(Ee.value=r.data,Ee.value.length===0){let f=Ie.loginInfo.isLogin&&!Ie.loginInfo.isAdmin,c=Ie.loginInfo.isLogin&&Ie.loginInfo.isAdmin;f?j.warning("您当前没有可用存储源，请联系管理员为当前用户添加存储源权限"):c&&Ro.confirm("当前无可用存储源，是否前往后台添加存储源？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then(()=>{ln.value.push("/login")});return}n(t),i(r)})});const n=i=>{Pt.value?l(Pt.value)?rt.value=Pt.value:a():i?(oo.updateFileList(o.value),document.title=Ie.globalConfig.siteName+" | 首页",al.value=!1):a(),s()},o=oe(()=>{let i=[];return Ee.value.forEach(r=>{i.push({name:r.name,path:r.key,size:0,time:"-",type:"ROOT"})}),i}),s=()=>{Ee.value.some(i=>{i.key===rt.value&&oo.updateCurrentStorageSource(i)})};ao||(nt(()=>rt.value,(i,r)=>{(i&&!sl.value||r!==void 0)&&(Ie.folderConfig.readmeText="",ln.value.push("/"+i),s())}),nt(()=>Pt.value,i=>{n(!0)}),ao=!0);const a=()=>{if(Ee.value.length>0){let i=Ee.value[0].key;rt.value=i,ln.value.push("/"+i)}},l=i=>Ee.value.find(r=>{if(r.key==i)return r});return{loadStorageSourceList:e,storageList:Ee,findStorageByKey:l,currentStorageKey:rt,storageListAsFileList:o}}var so;const $n=typeof window<"u",rn=()=>{};function il(t,e=200,n={}){return function(o,s){return function(...a){o(()=>s.apply(this,a),{fn:s,thisArg:this,args:a})}}(function(o,s={}){let a,l;return i=>{const r=M(o),f=M(s.maxWait);if(a&&clearTimeout(a),r<=0||f!==void 0&&f<=0)return l&&(clearTimeout(l),l=null),i();f&&!l&&(l=setTimeout(()=>{a&&clearTimeout(a),l=null,i()},f)),a=setTimeout(()=>{l&&clearTimeout(l),l=null,i()},r)}}(e,n),t)}$n&&((so=window==null?void 0:window.navigator)!=null&&so.userAgent)&&/iP(ad|hone|od)/.test(window.navigator.userAgent);var rl=Object.defineProperty,cl=Object.defineProperties,ul=Object.getOwnPropertyDescriptors,lo=Object.getOwnPropertySymbols,dl=Object.prototype.hasOwnProperty,fl=Object.prototype.propertyIsEnumerable,io=(t,e,n)=>e in t?rl(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,hl=(t,e)=>{for(var n in e||(e={}))dl.call(e,n)&&io(t,n,e[n]);if(lo)for(var n of lo(e))fl.call(e,n)&&io(t,n,e[n]);return t};const Pn=$n?window:void 0;function Ct(...t){let e,n,o,s;if(typeof t[0]=="string"?([n,o,s]=t,e=Pn):[e,n,o,s]=t,!e)return rn;let a=rn;const l=nt(()=>function(f){var c;const u=M(f);return(c=u==null?void 0:u.$el)!=null?c:u}(e),f=>{a(),f&&(f.addEventListener(n,o,s),a=()=>{f.removeEventListener(n,o,s),a=rn})},{immediate:!0,flush:"post"}),i=()=>{l(),a()};var r;return r=i,ka()&&_a(r),i}function pl(t,e,n={}){const{target:o=Pn,eventName:s="keydown",passive:a=!1}=n,l=typeof(i=t)=="function"?i:typeof i=="string"?r=>r.key===i:Array.isArray(i)?r=>i.includes(r.key):i?()=>!0:()=>!1;var i;return Ct(o,s,r=>{l(r)&&e(r)},a)}const ro=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},co="__vueuse_ssr_handlers__";ro[co]=ro[co]||{};var uo,ct,gl=Object.defineProperty,ml=Object.defineProperties,vl=Object.getOwnPropertyDescriptors,fo=Object.getOwnPropertySymbols,yl=Object.prototype.hasOwnProperty,bl=Object.prototype.propertyIsEnumerable,ho=(t,e,n)=>e in t?gl(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;function wl(t,e={}){var n,o;const s=(n=e.draggingElement)!=null?n:Pn,a=E((o=e.initialValue)!=null?o:{x:0,y:0}),l=E(),i=d=>!e.pointerTypes||e.pointerTypes.includes(d.pointerType),r=d=>{M(e.preventDefault)&&d.preventDefault(),M(e.stopPropagation)&&d.stopPropagation()},f=d=>{var b;i(d)&&l.value&&(a.value={x:d.pageX-l.value.x,y:d.pageY-l.value.y},(b=e.onMove)==null||b.call(e,a.value,d),r(d))},c=d=>{var b;i(d)&&l.value&&(l.value=void 0,(b=e.onEnd)==null||b.call(e,a.value,d),r(d))};return $n&&(Ct(t,"pointerdown",d=>{var b;if(!i(d)||M(e.exact)&&d.target!==M(t))return;const v=M(t).getBoundingClientRect(),_={x:d.pageX-v.left,y:d.pageY-v.top};((b=e.onStart)==null?void 0:b.call(e,_,d))!==!1&&(l.value=_,r(d))},!0),Ct(s,"pointermove",f,!0),Ct(s,"pointerup",c,!0)),u=((d,b)=>{for(var v in b||(b={}))yl.call(b,v)&&ho(d,v,b[v]);if(fo)for(var v of fo(b))bl.call(b,v)&&ho(d,v,b[v]);return d})({},function(d){if(!Ca(d))return mn(d);const b=Array.isArray(d.value)?new Array(d.value.length):{};for(const v in d.value)b[v]=xa(()=>({get:()=>d.value[v],set(_){if(Array.isArray(d.value)){const S=[...d.value];S[v]=_,d.value=S}else{const S=(D=hl({},d.value),cl(D,ul({[v]:_})));Object.setPrototypeOf(S,d.value),d.value=S}var D}}));return b}(a)),p={position:a,isDragging:oe(()=>!!l.value),style:oe(()=>"left:".concat(a.value.x,"px;top:").concat(a.value.y,"px;"))},ml(u,vl(p));var u,p}(ct=uo||(uo={})).UP="UP",ct.RIGHT="RIGHT",ct.DOWN="DOWN",ct.LEFT="LEFT",ct.NONE="NONE";const Sl=["a","s","d","w","q","e","A","S","D","W","Q","E","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Escape"," "];var qt=Io({name:"V3ImgPreview",props:{showToolbar:{type:Boolean,default:!0},showArrowBtn:{type:Boolean,default:!0},keyboard:{type:Boolean,default:!0},url:{type:String,default:void 0},escClose:{type:Boolean,default:!0},images:{type:Array,default:()=>[]},showCloseBtn:{type:Boolean,default:!0},index:{type:Number,default:0},on_unmount_v3_ima_preview_app:{type:Function}},setup(t,e){let{emit:n}=e;const o=E(null),s=E(null),{style:a}=wl(s),l=ot({visible:!0,imgState:"loading",src:"",imgIndex:t.index}),i=oe(()=>{var y;return((y=t.images)===null||y===void 0?void 0:y.length)>1&&t.showArrowBtn}),r=ot({imgScale:1,imgRotate:0}),f=oe(()=>{var y;return((y=t.images)===null||y===void 0?void 0:y.length)>1}),c=il(y=>{if(!t.keyboard)return!1;y.preventDefault();const{key:C}=y;return["s","S","ArrowDown"].includes(C)?d(-.1,!1):["w","W","ArrowUp"].includes(C)?d(.1,!1):C===" "?u():C==="Escape"&&t.escClose?D():["E","e"].includes(C)?p(!0):["Q","q"].includes(C)?p(!1):["a","A","ArrowLeft"].includes(C)?S(!1):["d","D","ArrowRight"].includes(C)?S(!0):void 0},200);pl(Sl,c);const u=()=>{r.imgScale=1,r.imgRotate=0,s.value.style.top="0",s.value.style.left="0"};function p(y){r.imgRotate+=90*(y?1:-1)}function d(y){let C=arguments.length>1&&arguments[1]!==void 0&&arguments[1];r.imgScale<=.2&&y<0||(C?r.imgScale=y:r.imgScale+=y)}function b(y){y.preventDefault(),d(y.deltaY<0?.05:-.05)}function v(y){l.imgState="loading",(C=>{const z=new Image;return z.src=C,new Promise(($,h)=>{z.onload=()=>{$(C)},z.onerror=()=>{h(C)}})})(y).then(()=>{l.imgState="success",l.src=y,u()}).catch(()=>{l.imgState="error"})}function _(){vn(()=>{Ct(o.value,"mousewheel",b,!1),u(),vn(()=>t.url!==void 0?v(t.url):Array.isArray(t.images)&&t.images.length>0?v(t.images[l.imgIndex]):console.error("images is not Array or Array length is 0"))})}function D(){var y;l.visible=!1,n("close"),(y=t.on_unmount_v3_ima_preview_app)===null||y===void 0||y.call(t)}function S(y){f.value&&(y?(l.imgIndex++,l.imgIndex>t.images.length-1&&(l.imgIndex=0)):(l.imgIndex--,l.imgIndex<0&&(l.imgIndex=t.images.length-1)),v(t.images[l.imgIndex]))}return No(()=>{window.__V3__IMG__PREVIEW__LOAD__ICON__SVG__||function(y){y.__V3__IMG__PREVIEW__LOAD__ICON__SVG__=!0;var C,z,$,h,m,g='<svg><symbol id="v3-img-close" viewBox="0 0 1045 1024"><path d="M282.517333 213.376l-45.354666 45.162667L489.472 512 237.162667 765.461333l45.354666 45.162667L534.613333 557.354667l252.096 253.269333 45.354667-45.162667-252.288-253.44 252.288-253.482666-45.354667-45.162667L534.613333 466.624l-252.096-253.226667z"  ></path></symbol><symbol id="v3-img-img-error" viewBox="0 0 1024 1024"><path d="M704 328a72 72 0 1 0 144 0 72 72 0 1 0-144 0z"  ></path><path d="M999.904 116.608a32 32 0 0 0-21.952-10.912L521.76 73.792a31.552 31.552 0 0 0-27.2 11.904l-92.192 114.848a32 32 0 0 0 0.672 40.896l146.144 169.952-147.456 194.656 36.48-173.376a32 32 0 0 0-11.136-31.424L235.616 245.504l79.616-125.696a32 32 0 0 0-29.28-49.024L45.76 87.552a32 32 0 0 0-29.696 34.176l55.808 798.016a32.064 32.064 0 0 0 34.304 29.696l176.512-13.184c17.632-1.312 30.848-16.672 29.504-34.272s-16.576-31.04-34.304-29.536L133.44 883.232l-6.432-92.512 125.312-12.576a32 32 0 0 0 28.672-35.04 32.16 32.16 0 0 0-35.04-28.672L122.56 726.848 82.144 149.184l145.152-10.144-60.96 96.224a32 32 0 0 0 6.848 41.952l198.4 161.344-58.752 279.296a30.912 30.912 0 0 0 0.736 14.752 31.68 31.68 0 0 0 1.408 11.04l51.52 154.56a31.968 31.968 0 0 0 27.456 21.76l523.104 47.552a32.064 32.064 0 0 0 34.848-29.632l55.776-798.048a32.064 32.064 0 0 0-7.776-23.232z m-98.912 630.848l-412.576-39.648a31.52 31.52 0 0 0-34.912 28.768 32 32 0 0 0 28.8 34.912l414.24 39.808-6.272 89.536-469.728-42.72-39.584-118.72 234.816-310.016a31.936 31.936 0 0 0-1.248-40.192L468.896 219.84l65.088-81.056 407.584 28.48-40.576 580.192z"  ></path></symbol><symbol id="v3-img-loading" viewBox="0 0 1024 1024"><path d="M834.7648 736.3584a5.632 5.632 0 1 0 11.264 0 5.632 5.632 0 0 0-11.264 0z m-124.16 128.1024a11.1616 11.1616 0 1 0 22.3744 0 11.1616 11.1616 0 0 0-22.3744 0z m-167.3216 65.8944a16.7936 16.7936 0 1 0 33.6384 0 16.7936 16.7936 0 0 0-33.6384 0zM363.1616 921.6a22.3744 22.3744 0 1 0 44.7488 0 22.3744 22.3744 0 0 0-44.7488 0z m-159.744-82.0224a28.0064 28.0064 0 1 0 55.9616 0 28.0064 28.0064 0 0 0-56.0128 0zM92.672 700.16a33.6384 33.6384 0 1 0 67.2256 0 33.6384 33.6384 0 0 0-67.2256 0zM51.2 528.9984a39.168 39.168 0 1 0 78.336 0 39.168 39.168 0 0 0-78.336 0z m34.1504-170.0864a44.8 44.8 0 1 0 89.6 0 44.8 44.8 0 0 0-89.6 0zM187.904 221.7984a50.432 50.432 0 1 0 100.864 0 50.432 50.432 0 0 0-100.864 0zM338.432 143.36a55.9616 55.9616 0 1 0 111.9232 0 55.9616 55.9616 0 0 0-111.9744 0z m169.0112-4.9152a61.5936 61.5936 0 1 0 123.2384 0 61.5936 61.5936 0 0 0-123.2384 0z m154.7776 69.632a67.1744 67.1744 0 1 0 134.3488 0 67.1744 67.1744 0 0 0-134.3488 0z m110.0288 130.816a72.8064 72.8064 0 1 0 145.5616 0 72.8064 72.8064 0 0 0-145.5616 0z m43.7248 169.472a78.3872 78.3872 0 1 0 156.8256 0 78.3872 78.3872 0 0 0-156.8256 0z" fill="" ></path></symbol><symbol id="v3-img-right" viewBox="0 0 1024 1024"><path d="M884.808356 96.170317c0-17.780969-16.723893-32.209586-37.309744-32.209586-20.586874 0-37.310767 14.428617-37.310767 32.209586V927.20035c0 17.780969 16.723893 32.209586 37.310767 32.209586 20.585851 0 37.309744-14.428617 37.309744-32.209586V96.170317zM263.249101 159.859871c-27.619034-21.278629-50.027393-11.659551-50.027393 22.116717v659.490146c0 33.44881 22.481014 43.322691 50.027393 22.116716l407.352615-313.385476c27.65485-21.242813 27.618011-55.784514 0-76.989465L263.249101 159.859871z m449.327612 260.298398c60.265572 48.751331 60.301388 134.302799 0 183.090968L297.061185 939.297876c-70.976518 57.422827-158.459988-25.322735-158.459989-116.158556V200.267163c0-91.12644 87.445608-173.6172 158.459989-116.158557l415.515528 336.049663zM297.061185 84.10963"  ></path></symbol><symbol id="v3-img-left" viewBox="0 0 1024 1024"><path d="M138.60222 96.170317V927.20035c0 17.780969 16.723893 32.209586 37.309744 32.209586 20.586874 0 37.310767-14.428617 37.310767-32.209586V96.170317c0-17.780969-16.723893-32.209586-37.310767-32.209586-20.585851 0-37.309744 14.428617-37.309744 32.209586z m621.560278 63.689554L352.80886 473.208509c-27.618011 21.205974-27.65485 55.747675 0 76.989465l407.353638 313.385476c27.54638 21.205974 50.027393 11.33107 50.027393-22.116716v-659.490146c-0.001023-33.776268-22.408359-43.395346-50.027393-22.116717z m-33.812084-75.750241c71.013357-57.459666 158.458965 25.032116 158.458965 116.157533v622.872157c0 90.835821-87.482447 173.581384-158.459988 116.158556L310.834886 603.249237c-60.301388-48.78817-60.265572-134.339638 0-183.090968L726.350414 84.10963z m0 0"  ></path></symbol><symbol id="v3-img-zoom-out" viewBox="0 0 1024 1024"><path d="M919.264 905.984l-138.912-138.912C851.808 692.32 896 591.328 896 480c0-229.376-186.624-416-416-416S64 250.624 64 480s186.624 416 416 416c95.008 0 182.432-32.384 252.544-86.208l141.44 141.44a31.904 31.904 0 0 0 45.248 0 32 32 0 0 0 0.032-45.248zM128 480C128 285.92 285.92 128 480 128s352 157.92 352 352-157.92 352-352 352S128 674.08 128 480z"  ></path><path d="M625.792 448H336a32 32 0 0 0 0 64h289.792a32 32 0 1 0 0-64z"  ></path></symbol><symbol id="v3-img-zoom-big" viewBox="0 0 1024 1024"><path d="M919.264 905.984l-138.912-138.912C851.808 692.32 896 591.328 896 480c0-229.376-186.624-416-416-416S64 250.624 64 480s186.624 416 416 416c95.008 0 182.432-32.384 252.544-86.208l141.44 141.44a31.904 31.904 0 0 0 45.248 0 32 32 0 0 0 0.032-45.248zM128 480C128 285.92 285.92 128 480 128s352 157.92 352 352-157.92 352-352 352S128 674.08 128 480z"  ></path><path d="M625.792 448H512v-112a32 32 0 0 0-64 0V448h-112a32 32 0 0 0 0 64H448v112a32 32 0 1 0 64 0V512h113.792a32 32 0 1 0 0-64z"  ></path></symbol><symbol id="v3-img-rotate-left" viewBox="0 0 1024 1024"><path d="M884.565333 431.914667c-3.114667 36.266667-22.784 55.893333-59.008 59.008-35.2-3.114667-54.357333-22.741333-57.472-59.008 3.114667-35.157333 22.272-54.314667 57.472-57.429334 36.224 3.114667 55.893333 22.272 59.008 57.429334z m-97.834666 0c3.114667 24.874667 16.042667 38.826667 38.826666 41.941333 22.741333-2.048 35.712-16.042667 38.826667-41.941333-3.114667-24.832-16.085333-38.272-38.826667-40.362667-22.784 3.114667-35.712 16.597333-38.826666 40.362667z m-59.008 82.346666c-1.024 103.466667-34.688 156.245333-100.906667 158.293334-69.376-1.024-104.021333-53.76-104.021333-158.293334 0.981333-104.576 35.157333-158.421333 102.442666-161.536 67.285333 2.133333 101.461333 55.893333 102.485334 161.493334z m-169.216 0c0 89.002667 22.229333 132.992 66.730666 131.925334 44.501333 1.066667 66.773333-42.922667 66.773334-131.968 0-90.026667-22.784-134.528-68.309334-133.546667-42.453333 3.114667-64.213333 47.658667-65.194666 133.546667z m-184.746667 49.664c-58.026667-5.205333-89.6-39.338667-94.72-102.485333 4.096-67.285333 37.76-103.509333 100.906667-108.714667 72.448-0.981333 108.16 50.218667 107.093333 153.728 0 109.738667-37.76 165.12-113.322667 166.144-45.568-2.090667-74.538667-24.32-86.954666-66.773333l32.597333-10.88c7.253333 36.266667 26.453333 53.845333 57.472 52.821333 48.64-2.090667 73.472-45.056 74.538667-128.853333-15.530667 29.994667-41.429333 45.013333-77.653334 45.013333z m3.072-181.674666c-39.338667 3.114667-60.586667 28.458667-63.658667 76.074666 2.048 47.616 23.296 72.96 63.658667 76.074667 40.362667 0 65.194667-18.645333 74.538667-55.893333 0-65.194667-24.874667-97.28-74.538667-96.256z m135.594667 641.578666C230.186667 1023.829333 0.597333 794.24 0.597333 512v-0.981333h53.973334v0.981333c0 252.501333 205.354667 457.898667 457.813333 457.898667 252.501333 0 457.898667-205.397333 457.898667-457.898667 0-252.458667-205.397333-457.813333-457.856-457.813333A457.088 457.088 0 0 0 159.530667 220.586667l120.533333-0.938667h8.106667l-47.061334 47.786667-167.936 1.365333-1.109333-167.936 47.189333-47.872v131.626667A510.933333 510.933333 0 0 1 512.426667 0.128C794.624 0.128 1024.256 229.76 1024.256 512c0 282.282667-229.632 511.872-511.829333 511.872z"  ></path></symbol><symbol id="v3-img-antetype" viewBox="0 0 1024 1024"><path d="M316 672h60c4.4 0 8-3.6 8-8V360c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v304c0 4.4 3.6 8 8 8zM512 622c22.1 0 40-17.9 40-39 0-23.1-17.9-41-40-41s-40 17.9-40 41c0 21.1 17.9 39 40 39zM512 482c22.1 0 40-17.9 40-39 0-23.1-17.9-41-40-41s-40 17.9-40 41c0 21.1 17.9 39 40 39z"  ></path><path d="M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32z m-40 728H184V184h656v656z"  ></path><path d="M648 672h60c4.4 0 8-3.6 8-8V360c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v304c0 4.4 3.6 8 8 8z"  ></path></symbol><symbol id="v3-img-rotate-right" viewBox="0 0 1024 1024"><path d="M375.381 562.517c-57.898-5.162-89.472-39.296-94.634-102.4 4.138-67.2 37.76-103.381 100.864-108.586 72.362-1.024 108.032 50.176 107.008 153.6 0 109.61-37.76 164.906-113.238 165.973-45.525-2.133-74.453-24.32-86.869-66.73l32.597-10.838c7.211 36.181 26.368 53.76 57.387 52.736 48.597-2.048 73.387-44.97 74.453-128.768-15.488 29.995-41.386 45.013-77.568 45.013z m3.115-181.504c-39.296 3.072-60.501 28.459-63.573 75.99 2.048 47.573 23.253 72.96 63.573 76.032 40.32 0 65.152-18.603 74.453-55.851 0-65.152-24.832-97.195-74.453-96.17z m145.835 131.84c0.981-104.448 35.114-158.208 102.4-161.322 67.157 2.09 101.29 55.85 102.357 161.322-1.067 103.424-34.688 156.16-100.821 158.251-69.334-1.067-103.936-53.76-103.936-158.25z m169.088 0c0-89.984-22.784-134.4-68.267-133.418-42.41 3.114-64.128 47.616-65.152 133.418 0 88.96 22.187 132.907 66.688 131.84 44.459 1.067 66.73-42.88 66.73-131.84z m75.989-82.218c3.115-35.158 22.23-54.272 57.387-57.387 36.181 3.115 55.893 22.23 58.965 57.387-3.115 36.224-22.784 55.893-58.965 58.965-35.158-3.115-54.272-22.741-57.387-58.965z m96.17 0c-3.071-24.832-16.042-38.23-38.783-40.32-22.742 3.114-35.67 16.554-38.784 40.32 3.114 24.832 16.042 38.826 38.826 41.898 22.699-2.048 35.67-16.042 38.742-41.898z m-354.175 592.64c-281.984 0-511.36-229.376-511.36-511.403C0 229.973 229.419 0.512 511.403 0.512c157.696 0 298.922 71.765 392.789 184.32V54.613l47.147 47.872-1.11 167.766-167.765-1.366-47.061-47.744h8.106l121.558 0.982a456.704 456.704 0 0 0-353.664-167.68c-252.246 0-457.43 205.226-457.43 457.429 0 252.288 205.184 457.515 457.43 457.515S968.875 764.16 968.875 511.872v-0.981h53.888v0.981c0 282.027-229.376 511.403-511.36 511.403z"  ></path></symbol></svg>',x=(x=document.getElementsByTagName("script"))[x.length-1].getAttribute("data-injectcss");if(x&&!y.__iconfont__svg__cssinject__){y.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(O){console&&console.log(O)}}function P(){m||(m=!0,$())}C=function(){var O,T=document.createElement("div");T.innerHTML=g,g=null,(T=T.getElementsByTagName("svg")[0])&&(T.setAttribute("aria-hidden","true"),T.style.position="absolute",T.style.width=0,T.style.height=0,T.style.overflow="hidden",(O=document.body).firstChild?function(B,A){A.parentNode.insertBefore(B,A)}(T,O.firstChild):O.appendChild(T))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(C,0):(z=function(){document.removeEventListener("DOMContentLoaded",z,!1),C()},document.addEventListener("DOMContentLoaded",z,!1)):document.attachEvent&&($=C,h=y.document,m=!1,function O(){try{h.documentElement.doScroll("left")}catch(T){return void setTimeout(O,50)}P()}(),h.onreadystatechange=function(){h.readyState=="complete"&&(h.onreadystatechange=null,P())})}(typeof window<"u"?window:global),_()}),Object.assign(Object.assign(Object.assign({vImagesWrap:o,imgContainer:s},mn(l)),mn(r)),{handleClose:D,toggleImg:S,initImgSize:u,dragStyle:a,handleScale:d,handleRotate:p,visibleArrowBtn:i,isMultiple:f,handleClickMaskClose:function(y){y.target.classList.contains("img-container")&&D()}})}});const Se=t=>(wa("data-v-50804152"),t=t(),Sa(),t),Cl={class:"icon img-loading rotate-animation","aria-hidden":"true"},xl=[Se(()=>k("use",{"xlink:href":"#v3-img-loading"},null,-1))],kl=["src"],_l=[Se(()=>k("use",{"xlink:href":"#v3-img-img-error"},null,-1))],Dl=[Se(()=>k("use",{"xlink:href":"#v3-img-close"},null,-1))],Ll=[Se(()=>k("svg",{class:"icon","aria-hidden":"true"},[k("use",{"xlink:href":"#v3-img-left"})],-1))],Tl=[Se(()=>k("svg",{class:"icon","aria-hidden":"true"},[k("use",{"xlink:href":"#v3-img-right"})],-1))],Fl={key:3,class:"v3-img-preview-toolbar"},El=[Se(()=>k("use",{"xlink:href":"#v3-img-zoom-out"},null,-1))],zl=[Se(()=>k("use",{"xlink:href":"#v3-img-zoom-big"},null,-1))],$l=[Se(()=>k("use",{"xlink:href":"#v3-img-antetype"},null,-1))],Pl=[Se(()=>k("use",{"xlink:href":"#v3-img-rotate-left"},null,-1))],Ml=[Se(()=>k("use",{"xlink:href":"#v3-img-rotate-right"},null,-1))];(function(t,e){e===void 0&&(e={});var n=e.insertAt;if(t&&typeof document<"u"){var o=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css",n==="top"&&o.firstChild?o.insertBefore(s,o.firstChild):o.appendChild(s),s.styleSheet?s.styleSheet.cssText=t:s.appendChild(document.createTextNode(t))}})(".icon[data-v-50804152] {\n  width: 1em;\n  height: 1em;\n  vertical-align: -0.15em;\n  fill: currentColor;\n  overflow: hidden;\n}\n.v-images-wrap[data-v-50804152] {\n  z-index: 200;\n  user-select: none;\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100vw;\n  height: 100vh;\n  overflow: hidden;\n  background: rgba(0, 0, 0, 0.3);\n  backdrop-filter: blur(3px);\n  color: #fff;\n}\n.v-images-wrap[data-v-50804152] .img-loading[data-v-50804152],\n.v-images-wrap[data-v-50804152] .img-content[data-v-50804152] {\n  font-size: 50px;\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  margin: auto;\n  transition: all 0.2s;\n  cursor: move;\n}\n.v-images-wrap[data-v-50804152] .img-container[data-v-50804152] {\n  z-index: 201;\n  position: absolute;\n  height: 100vh;\n  width: 100vw;\n  top: 0;\n  left: 0;\n  text-align: center;\n}\n.v-images-wrap[data-v-50804152] .img-container[data-v-50804152] .img-content[data-v-50804152] {\n  max-width: 100%;\n  max-height: 100%;\n}\n.v-images-wrap[data-v-50804152] .img-container[data-v-50804152] .img-error[data-v-50804152] {\n  font-size: 300px;\n  color: #d8d8d8;\n}\n.v-images-wrap[data-v-50804152] .rotate-animation[data-v-50804152] {\n  animation: rotate-50804152 1.5s linear infinite;\n}\n.v-images-wrap[data-v-50804152] .arrow[data-v-50804152] {\n  width: 42px;\n  height: 42px;\n  text-align: center;\n  line-height: 42px;\n  position: absolute;\n  top: 50%;\n  border-radius: 50%;\n  transform: translateY(-50%);\n  -ms-transform: translateY(-50%);\n  font-size: 24px;\n  cursor: pointer;\n  transition: all 0.2s;\n  z-index: 280;\n  background: rgba(0, 0, 0, 0.3);\n}\n.v-images-wrap[data-v-50804152] .arrow[data-v-50804152][data-v-50804152]:hover {\n  opacity: 0.8;\n  transform: translateY(-50%) scale(1.2);\n}\n.v-images-wrap[data-v-50804152] .arrow-left[data-v-50804152] {\n  left: 50px;\n}\n.v-images-wrap[data-v-50804152] .arrow-right[data-v-50804152] {\n  right: 50px;\n}\n.v-images-wrap[data-v-50804152] .close-btn[data-v-50804152] {\n  z-index: 205;\n  position: absolute;\n  right: 50px;\n  top: 50px;\n  width: 36px;\n  height: 36px;\n  font-size: 22px;\n  line-height: 36px;\n  text-align: center;\n  border-radius: 50%;\n  cursor: pointer;\n  transition: all 0.2s;\n  color: #e7e5e5;\n  background: rgba(0, 0, 0, 0.3);\n}\n.v-images-wrap[data-v-50804152] .close-btn[data-v-50804152][data-v-50804152]:hover {\n  opacity: 0.8;\n  transform: scale(1.2);\n}\n.v-images-wrap[data-v-50804152] .v3-img-preview-toolbar[data-v-50804152] {\n  z-index: 205;\n  position: absolute;\n  bottom: 10%;\n  font-size: 26px;\n  width: 100%;\n  display: flex;\n  justify-content: center;\n  cursor: pointer;\n}\n.v-images-wrap[data-v-50804152] .v3-img-preview-toolbar[data-v-50804152] section[data-v-50804152] {\n  height: 44px;\n  bottom: 10%;\n  padding: 0 22px;\n  display: flex;\n  align-items: center;\n  border-radius: 22px;\n  background: rgba(0, 0, 0, 0.3);\n  color: #c3c3c3;\n}\n.v-images-wrap[data-v-50804152] .v3-img-preview-toolbar[data-v-50804152] section[data-v-50804152] svg[data-v-50804152] {\n  box-sizing: content-box;\n  padding: 0 10px;\n  transition: all 0.2s;\n}\n.v-images-wrap[data-v-50804152] .v3-img-preview-toolbar[data-v-50804152] section[data-v-50804152] svg[data-v-50804152][data-v-50804152]:hover {\n  transform: scale(1.2);\n}\n@keyframes rotate-50804152 {\n  from {\n    transform: rotate(0deg);\n  }\n  to {\n    transform: rotate(360deg);\n  }\n}\n"),qt.render=function(t,e,n,o,s,a){return F(),Ue(ba,{name:"fade"},{default:le(()=>[t.visible?(F(),R("div",{key:0,class:"v-images-wrap",onClick:e[10]||(e[10]=function(){return t.handleClickMaskClose&&t.handleClickMaskClose(...arguments)}),ref:"vImagesWrap"},[wt((F(),R("svg",Cl,xl,512)),[[Ot,t.imgState==="loading"]]),k("div",{ref:"imgContainer",style:nn(t.dragStyle),class:"img-container"},[wt(k("img",{class:"img-content",onDragstart:e[0]||(e[0]=Ve(()=>{},["prevent"])),src:t.src,style:nn("transform: scale(".concat(t.imgScale,") rotate(").concat(t.imgRotate,"deg);")),alt:""},null,44,kl),[[Ot,t.imgState==="success"]]),wt((F(),R("svg",{class:"icon img-content img-error",onDragstart:e[1]||(e[1]=Ve(()=>{},["prevent"])),"aria-hidden":"true",style:nn("transform: scale(".concat(t.imgScale,") rotate(").concat(t.imgRotate,"deg);"))},_l,36)),[[Ot,t.imgState==="error"]])],4),t.showCloseBtn?(F(),R("svg",{key:0,class:"icon close-btn","aria-hidden":"true",onClick:e[2]||(e[2]=Ve(function(){return t.handleClose&&t.handleClose(...arguments)},["stop"]))},Dl)):pe("",!0),t.visibleArrowBtn?(F(),R("div",{key:1,class:"arrow arrow-left",onClick:e[3]||(e[3]=l=>t.toggleImg(!1))},Ll)):pe("",!0),t.visibleArrowBtn?(F(),R("div",{key:2,class:"arrow arrow-right",onClick:e[4]||(e[4]=l=>t.toggleImg(!0))},Tl)):pe("",!0),t.showToolbar?(F(),R("div",Fl,[k("section",null,[(F(),R("svg",{class:"icon","aria-hidden":"true",onClick:e[5]||(e[5]=l=>t.handleScale(-.1,!1))},El)),(F(),R("svg",{class:"icon","aria-hidden":"true",onClick:e[6]||(e[6]=l=>t.handleScale(.1,!1))},zl)),(F(),R("svg",{class:"icon","aria-hidden":"true",onClick:e[7]||(e[7]=function(){return t.initImgSize&&t.initImgSize(...arguments)})},$l)),(F(),R("svg",{class:"icon","aria-hidden":"true",onClick:e[8]||(e[8]=l=>t.handleRotate(!1))},Pl)),(F(),R("svg",{class:"icon","aria-hidden":"true",onClick:e[9]||(e[9]=l=>t.handleRotate(!0))},Ml))])])):pe("",!0)],512)):pe("",!0)]),_:1})},qt.__scopeId="data-v-50804152";let ca={};const po="v3-img-preview-container-id";let ut={};function ua(t){if(ut._instance)return!1;Array.isArray(t)&&(t={images:t}),typeof t=="string"&&(t={url:t}),t=Object.assign(Object.assign({},ca),t);let e=document.getElementById(po);return e||(e=document.createElement("div"),e.id=po,document.body.appendChild(e)),ut=Oo(qt,Object.assign(Object.assign({},t),{on_unmount_v3_ima_preview_app:()=>ut.unmount()})),ut.mount(e),ut}(()=>{const t=qt;return t.install=(e,n)=>{ca=n,e.config.globalProperties.$v3ImgPreviewFn=ua},t})();function Lt(){const t=E(!1),e=E(!1);return{visible:t,loading:e,openDialog:()=>t.value=!0,closeDialog:()=>t.value=!1,openLoading:()=>e.value=!0,closeLoading:()=>e.value=!1}}const{visible:Rl,openDialog:Al}=Lt(),go=E(""),mo=E("");function Bl(){return{openDialogWithData:(e,n)=>{go.value=e,mo.value=n,Al()},visible:Rl,name:go,url:mo}}const{visible:Ol,openDialog:Il}=Lt(),vo=E(""),yo=E("");function Nl(){return{openDialogWithData:(e,n)=>{vo.value=e,yo.value=n,Il()},visible:Ol,name:vo,url:yo}}const{visible:Wl,openDialog:jl}=Lt(),bo=E("");function Ul(){return{openDialogWithData:e=>{bo.value=e,jl()},visible:Wl,name:bo}}const{visible:Vl,openDialog:Kl}=Lt(),wo=E("");function ql(){return{openDialogWithData:e=>{wo.value=e,Kl()},visible:Vl,name:wo}}const{visible:Hl,openDialog:Gl}=Lt(),So=E(""),Co=E("");function Zl(){return{openDialogWithData:(e,n)=>{So.value=e,Co.value=n,Gl()},visible:Hl,name:So,url:Co}}let Yl=Yt(),ge=Dt();const{openDialogWithData:Jl}=Bl(),{openDialogWithData:Xl}=Nl(),{openDialogWithData:Ql}=Ul(),{openDialogWithData:ei}=ql(),{openDialogWithData:ti}=Zl();function ni(){return{openVideo:()=>{Ql(ge.currentClickRow.name)},openText:()=>{Jl(ge.currentClickRow.name,ge.currentClickRow.url)},openOffice:()=>{ei(ge.currentClickRow.name)},openImage:i=>{let r=[],f=0;Yl.zfileConfig.imagePreview.mode==="only"?r.push(i.url):ge.filterFileByType("image").forEach((u,p)=>{i.name===u.name&&(f=p),r.push(u.url)}),ua({images:r,index:f})},openAudio:()=>{ge.updateAudioList(ge.filterFileByType("audio"))},openPdf:()=>{Xl(ge.currentClickRow.name,ge.currentClickRow.url)},open3d:()=>{ti(ge.currentClickRow.name,ge.currentClickRow.url)}}}const{contextMenuTargetFile:oi,contextMenuTargetBlank:ai}=Xs();let{routerRef:dt,fullpath:cn,storageKey:ve,currentPath:Mt}=at(),{getPathPwd:xo,putPathPwd:si}=Xt();const{storageListAsFileList:li}=ll(),{loading:Rt,firstLoading:ii,basicLoading:ri,skeletonLoading:ci}=zn();let ft=Dt(),ue=Ae();const un=Da(ue.globalConfig.siteName);let ui=Yt();const{openAudio:di,openImage:fi,openOffice:hi,openPdf:pi,openText:gi,openVideo:mi,open3d:vi}=ni();let xn=ot([]);if(xn.length===0)for(let t=0;t<ui.zfileConfig.skeleton.size;t++)xn.push({});let ye=ot({path:"",password:"",orderBy:"",orderDirection:""}),{selectRows:yi,clearSelection:bi}=_t();function Mn(){const t=({prop:a,order:l})=>{ye.orderBy=a,ye.orderDirection=l==="descending"?"desc":"asc",e()},e=a=>{if(!ve.value)return;Rt.value=!0,ye.path=Mt.value;let l=a||{};l.storageKey=ve.value,l.path=Mt.value,l.password=l.password||xo(null,l.init),l.orderBy=ye.orderBy||ue.globalConfig.defaultSortField,l.orderDirection=ye.orderDirection||ue.globalConfig.defaultSortOrder;let i=ve.value;la(l).then(r=>{let f=r.data.passwordPattern;if(si(f,l.password,a==null?void 0:a.rememberPassword),i!==ve.value)return;let c=r.data.files,u=ye.path;if(u!==""&&u!=="/"){let p=$t.basename($t.resolve(Mt.value,"../"));c.unshift({name:p||"/",path:$t.resolve(u,"../"),type:"BACK"})}ft.updateFileList(c),Rt.value=!1,ii.value=!0,yi.value=[],cn.value?un.value=ue.globalConfig.siteName+" | "+cn.value[cn.value.length-1]:un.value=ue.globalConfig.siteName+" | 首页",n(l)}).catch(r=>{const f=(p,d)=>{e({password:p,rememberPassword:d})},c=()=>{if((ye.path==="/"||ye.path==="")&&ue.globalConfig.rootShowStorage===!0)ft.updateFileList(li.value),dt.value.push("/"),un.value=ue.globalConfig.siteName+" | 首页",Rt.value=!1;else{let p=$t.resolve(ye.path,"../");dt.value.push("/"+ve.value+p)}};let u=r.response.data;u.code===Le.responseCode.INVALID_PASSWORD?(j.warning("密码错误，请重新输入！"),s(f,c)):u.code===Le.responseCode.REQUIRED_PASSWORD?s(f,c):j.error(u.msg)})},n=a=>{let l={storageKey:ve.value,path:Mt.value,password:a.password};tl(l).then(i=>{ue.updateFolderConfig(i.data),ve.value!==ft.oldStorageKey&&ft.updateOldStorageKey(ve.value)})},o=(a,l)=>{if(a.name&&!(!l&&(oi.value===!0||ai.value===!0)))if(ft.updateCurrentClickRow(a),a.type==="FILE"){const{batchDownloadFile:i}=Rn();let r=a.fileType;if(ue.folderConfig.permission.preview)switch(r){case"video":mi();break;case"image":fi(a);break;case"text":gi();break;case"audio":di(a);break;case"office":hi(a);break;case"pdf":pi(a);break;case"three3d":vi(a);break;default:i(a)}else i(a);bi()}else if(a.type==="ROOT")dt.value.push(a.path),ue.folderConfig.readmeText="";else if(a.type==="BACK"){let i=Kn("/",ve.value,a.path);dt.value.push(i),ue.folderConfig.readmeText=""}else{let i=Kn("/",ve.value,a.path,a.name);dt.value.push(i),ue.folderConfig.readmeText=""}};let s=(a,l)=>{Ro.prompt("此文件夹已加密，请输入密码：","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputType:"password",checkbox:!0,defaultChecked:ue.globalConfig.defaultSavePwd,inputDefault:xo(null,!0),checkboxLabel:"记住密码",inputValidator(i){return!!i},inputErrorMessage:"密码不能为空."}).then(({value:i,checkbox:r})=>{a&&a(i,r)}).catch(()=>{l&&l()})};return{loadFile:e,openRow:o,searchParam:ye,sortChangeMethod:t,skeletonLoading:ci,skeletonData:xn,basicLoading:ri,loading:Rt,loadFileConfig:n,popPassword:s}}const ko=E(!1),_o=E([]);function wi(){return{open:e=>{e&&e.length>0&&(_o.value=e,ko.value=!0)},visible:ko,operatorResultList:_o}}const Si={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Ci(t,e){return F(),R("svg",Si,e[0]||(e[0]=[k("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 10v6m-3-3h6m5 7a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"},null,-1)]))}const xi={name:"lucide-folder-plus",render:Ci},ki={t:"1643422445077",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"7143",width:"200",height:"200"};function _i(t,e){return F(),R("svg",ki,e[0]||(e[0]=[k("path",{d:"M918.673 883H104.327C82.578 883 65 867.368 65 848.027V276.973C65 257.632 82.578 242 104.327 242h814.346C940.422 242 958 257.632 958 276.973v571.054C958 867.28 940.323 883 918.673 883z",fill:"#FFE9B4","p-id":"7144"},null,-1),k("path",{d:"M512 411H65V210.37C65 188.597 82.598 171 104.371 171h305.92c17.4 0 32.71 11.334 37.681 28.036L512 411z",fill:"#FFB02C","p-id":"7145"},null,-1),k("path",{d:"M918.673 883H104.327C82.578 883 65 865.42 65 843.668V335.332C65 313.58 82.578 296 104.327 296h814.346C940.422 296 958 313.58 958 335.332v508.336C958 865.32 940.323 883 918.673 883z",fill:"#FFCA28","p-id":"7146"},null,-1)]))}const Di={name:"custom-file-type-folder",render:_i};const Li={class:"z-breadcrumbs__item"},Ti=["onClick","href"],Fi={key:0},Ei={class:"z-breadcrumbs__item"},zi={class:"ml-3 text-[13px]"},$i={key:0,class:"z-breadcrumbs__fold"},Pi={class:"z-breadcrumbs__item"},Mi=["href"],Ri=["onClick","href"],Ai=["aaa"],Bi={class:"z-breadcrumbs__item"},Oi=["onClick","href"],Ii={__name:"Breadcrumb",props:{items:{type:Array,default:[]},keepShowHeadSize:{type:Number,default:1}},setup(t,{emit:e}){let n=La();console.log(n);let o=t;nt(()=>o.items,()=>{o.items.forEach((S,y)=>{S.index=y})});const s=e,a=S=>{s("breadcrumb-click",S)},l=E(null),i=E(null),r=E(null),f=E(null),c=E([]),u=E(0),p=E(0);Ta(l,S=>{d(S)}),Fa(r,S=>{d(S)},{childList:!0});const d=S=>{const y=S[0].target;let C;if(y.className.includes("z-breadcrumbs-root"))C=y.children[1].children,p.value=_(y);else if(y.className.includes("z-breadcrumbs"))C=y.children,p.value=_(y.parentElement);else return;if(C.length!==0){u.value=0;for(let z=0;z<C.length;z++){let $=C[z];c.value[z]=_($),u.value+=c.value[z]}v()}},b=E({head:[],fold:[],show:[]}),v=()=>{console.log("[z-breadcrumb] 开始计算面包屑折叠数据");let S=o.items.slice(0),y=[],C=[],z=S.slice(0);o.keepShowHeadSize>0&&(y=S.slice(0,o.keepShowHeadSize),S=S.slice(o.keepShowHeadSize),z=S.slice(0));let $=0,h=u.value>p.value;if(h){let g=_(f.value);$+=g,console.log("[z-breadcrumb] 所有面包屑元素宽度和大于父元素宽度，增加基础宽度：".concat(g,", 总基础宽度：").concat($))}if(o.keepShowHeadSize>0){for(let g=0;g<o.keepShowHeadSize;g++)$+=c.value[g],console.log("[z-breadcrumb] 需要保留第 ".concat(g+1," 个面包屑，增加基础宽度: ").concat(c.value[g],", 总基础宽度 ").concat($));h&&($+=12+20,console.log("[z-breadcrumb] 所有面包屑元素宽度和大于父元素宽度，增加与前 ".concat(o.keepShowHeadSize," 个保留的面包屑之间的基础宽度：").concat(12+20,", 总基础宽度：").concat($)))}let m=$;for(let g=S.length-1;g>=0;g--){let x=S[g],P=c.value[g+y.length];if(m+=P,m>p.value){m-=P,z=S.slice(g+1),C=S.slice(0,g+1),console.log("[z-breadcrumb] 当前面包屑 ".concat(x.name," 元素宽度：").concat(P,", 显示总宽度 ").concat(m+P," 已超出父元素宽度：").concat(p.value,", 将折叠面包屑：").concat(C.map(O=>O.name+"("+P+")"),", 折叠后总宽度为:  ").concat(m));break}else console.log("[z-breadcrumb] 当前面包屑 ".concat(x.name," 元素宽度：").concat(P,", 父元素宽度：").concat(p.value,", 显示总宽度: ").concat(m,", 无需折叠"))}b.value={head:y,fold:C,show:z}},_=S=>S.getBoundingClientRect().width+parseFloat(getComputedStyle(S).marginLeft)+parseFloat(getComputedStyle(S).marginRight),D=()=>{console.log("foldBreadcrumb",b.value)};return(S,y)=>{var h;const C=Ba,z=Oa,$=Ia;return F(),R("nav",{class:"flex w-full relative z-breadcrumbs-root",ref_key:"parentEl",ref:l},[k("ol",{role:"list",ref_key:"breadcrumbEl",ref:i,class:"z-breadcrumbs"},[(F(!0),R(Xe,null,gt(M(b).head,(m,g)=>(F(),R("li",{key:m.index},[k("div",Li,[g!==0?(F(),Ue(M(Ft),{key:0,class:"z-breadcrumbs__icon"})):pe("",!0),k("a",{onClick:Ve(x=>a(m),["prevent","stop"]),href:m.href,class:"z-breadcrumbs__text"},Re(m.name),9,Ti)])]))),128)),S.$slots["breadcrumb-item"]?(F(),R("li",Fi,[k("div",Ei,[k("a",zi,[yn(S.$slots,"breadcrumb-item",{},void 0,!0)])])])):(F(),R(Xe,{key:1},[((h=M(b).fold)==null?void 0:h.length)>0?(F(),R("li",$i,[k("div",Pi,[M(b).head.length>0?(F(),Ue(M(Ft),{key:0,class:"z-breadcrumbs__icon"})):pe("",!0),ie($,{"popper-class":"z-breadcrumbs__popper",trigger:"click",placement:"bottom-start"},{dropdown:le(()=>[ie(z,{class:"w-48 sm:w-72"},{default:le(()=>[(F(!0),R(Xe,null,gt(M(b).fold,(m,g)=>(F(),Ue(C,{key:m.index,onClick:Ve(x=>a(m),["prevent","stop"])},{default:le(()=>[k("a",{href:m==null?void 0:m.href,class:bn([m===M(o).items[M(o).items.length-1]?"cursor-not-allowed text-gray-300":"text-gray-600 hover:text-gray-700 font-semibold","  max-w-md overflow-ellipsis overflow-hidden whitespace-nowrap"])},Re(m==null?void 0:m.name),11,Mi)]),_:2},1032,["onClick"]))),128))]),_:1})]),default:le(()=>[y[0]||(y[0]=k("span",{class:"el-dropdown-link"},[k("a",{class:"z-breadcrumbs__ellipsis"}," ··· ")],-1))]),_:1,__:[0]})])])):pe("",!0),(F(!0),R(Xe,null,gt(M(b).show,(m,g)=>(F(),R("li",{key:m.name},[k("div",{class:"z-breadcrumbs__item",onClick:D},[m!==M(o).items[0]?(F(),Ue(M(Ft),{key:0,class:"z-breadcrumbs__icon"})):pe("",!0),k("a",{onClick:Ve(x=>a(m),["prevent","stop"]),href:m.href,class:bn([g===M(b).show.length-1?"disable":"","z-breadcrumbs__text"])},Re(m.name),11,Ri)])]))),128))],64))],512),k("ol",{role:"list",ref_key:"hideBreadcrumbEl",ref:r,class:"z-breadcrumbs invisible absolute",aaa:JSON.stringify(M(o).items)},[(F(!0),R(Xe,null,gt(M(o).items,m=>(F(),R("li",{key:m.index},[k("div",Bi,[m!==M(o).items[0]?(F(),Ue(M(Ft),{key:0,class:"z-breadcrumbs__icon"})):pe("",!0),k("a",{onClick:Ve(g=>a(m),["prevent","stop"]),href:m.href,class:"z-breadcrumbs__text"},Re(m.name),9,Oi)])]))),128))],8,Ai),k("a",{class:"z-breadcrumbs__ellipsis invisible absolute",ref_key:"hideBreadcrumbEllipsisEl",ref:f}," ··· ",512)],512)}}},Ni=Tn(Ii,[["__scopeId","data-v-eb5def09"]]);const Wi={class:"zfile-select-folder-body"},ji={class:"zfile-select-folder-breadcrumb h-12"},Ui={class:"zfile-select-folder-body"},Vi={class:"space-y-1","aria-label":"Sidebar"},Ki=["onClick","href"],qi={class:"truncate select-none"},Hi={key:0},Gi={class:"zfile-select-folder-footer"},Zi={__name:"SelectFolder",props:{show:{type:Boolean,default:!1},title:{type:String,default:"选择文件夹"},storageKey:{type:String,required:!0},basePath:{type:String,default:"/"},onClose:{type:Function,default:()=>{}}},emits:["update:show"],setup(t,{emit:e}){let n=Ae(),{getPathPwd:o,putPathPwd:s}=Xt();const{newFolder:a}=Rn();let{popPassword:l}=Mn();const i=()=>{a(c.value).then(()=>{d()})},r=t,f=Ea("loading"),c=E(""),u=E([]),p=oe(()=>{let S=[{name:"根目录",href:"/",disable:!1}],y=c.value.split("/");return y&&(y=y.filter(C=>!!C),y.forEach((C,z,$)=>{let h={name:C,href:jt("/",$.slice(0,z+1).join("/")),disable:z===$.length-1};S.push(h)})),S});No(()=>{c.value=r.basePath,d()});const d=async(S,y)=>{const C={storageKey:r.storageKey,path:c.value,password:S||o(c.value,!0)};la(C).then(z=>{z.data.files=z.data.files.filter(h=>h.type==="FOLDER");let $=z.data.passwordPattern;s($,C.password,y),u.value=z.data.files}).catch(z=>{const $=(m,g)=>{d(m,g)};let h=z.response.data;h.code===Le.responseCode.INVALID_PASSWORD?(j.warning("密码错误，请重新输入！"),l($)):h.code===Le.responseCode.REQUIRED_PASSWORD?l($):j.error(h.msg)})},b=S=>{c.value=jt(S.path+"/"+S.name),d()},v=S=>{S.href&&(c.value=decodeURI(S.href),d())},_=e,D=S=>{const y={value:c.value,type:S};S==="confirm"&&(f.value=!0),_("update:show",!1),r.onClose(y)};return(S,y)=>{const C=Ni,z=Di,$=xi,h=wn,m=jo;return F(),R("div",Wi,[ie(m,{width:"400px",modelValue:r.show,"onUpdate:modelValue":y[2]||(y[2]=g=>r.show=g),title:t.title,onClose:y[3]||(y[3]=g=>D("cancel"))},{default:le(()=>[k("div",ji,[ie(C,{class:"h-12",items:M(p),onBreadcrumbClick:v},null,8,["items"])]),k("div",Ui,[k("nav",Vi,[(F(!0),R(Xe,null,gt(M(u),g=>(F(),R("a",{onClick:x=>b(g),key:g.name,href:g.href,class:bn(["text-gray-600 hover:bg-gray-50 hover:text-gray-900","group flex items-center rounded-md px-3 py-2 text-sm font-medium select-none"])},[ie(z,{name:"file-type-folder",class:"text-2xl mr-3 h-6 w-6 flex-shrink-0"}),k("span",qi,Re(g.name),1)],8,Ki))),128)),M(u).length===0?(F(),R("div",Hi,y[4]||(y[4]=[k("div",{class:"flex items-center justify-center h-20"},[k("span",{class:"text-gray-500"},"无文件夹")],-1)]))):pe("",!0)])]),k("div",Gi,[k("div",null,[wt(ie($,{class:"h-6 w-6 cursor-pointer text-blue-400",onClick:i},null,512),[[Ot,M(n).permission.newFolder]])]),k("div",null,[ie(h,{type:"info",onClick:y[0]||(y[0]=g=>D("cancel"))},{default:le(()=>y[5]||(y[5]=[Wt("取消")])),_:1,__:[5]}),ie(h,{type:"primary",loading:M(f),onClick:y[1]||(y[1]=g=>D("confirm"))},{default:le(()=>y[6]||(y[6]=[Wt("确认")])),_:1,__:[6]},8,["loading"])])])]),_:1},8,["modelValue","title"])])}}},Yi=Tn(Zi,[["__scopeId","data-v-5d8b995e"]]),Ji=(t,e,n,o)=>{const s=document.createElement("div"),a=Oo(Yi,{show:!0,title:t,storageKey:e,basePath:n,onClose:i=>{const r=()=>{l.value=!1},f=()=>{a.unmount(),document.body.removeChild(s)};i.type==="confirm"?o({...i,callback:{stopLoading:r,closeDialog:f}}):f()}}),l=E(!1);a.provide("loading",l),document.body.appendChild(s),a.mount(s)};let Ze=Ae(),{storageKey:Ye,currentPath:ht}=at(),{selectRows:re,selectRow:dn,selectFolders:Je,selectFiles:fn}=_t(),{getPathPwd:hn}=Xt(),{open:Do}=wi();function Rn(){const{loadFile:t}=Mn(),e=c=>{if(!re.value&&re.value.length!=1){j.warning("请选择一个目录压缩");return}console.log(re);let u=re.value[0],p={path:u.path,name:u.name,storageKey:Ye.value};Ns(p).then(d=>{d.data?j.info("压缩任务提交成功，请稍后刷新页面"):j.error("当前存储库不支持压缩功能")})},n=c=>{if(Ze.folderConfig.permission.download===!1)return;if(!re.value&&re.value.length===0){j.warning("请至少选择一个文件");return}let u;c!=null&&c.name?u='是否确认下载文件 <span class="text-blue-500">'.concat(c.name,"</span> ？"):re.value.length===1&&(u='是否确认下载文件 <span class="text-blue-500">'.concat(re.value[0].name,"</span> ？"),c=re.value[0]),ze.confirm(u,"提示",{dangerouslyUseHTMLString:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"info",callback:p=>{let d="";p instanceof Object?d=p.action:typeof p=="string"&&(d=p),d==="confirm"&&c!=null&&c.name&&(console.log("进行指定文件下载, 文件:",c),o(c.url))}})},o=c=>{window.open(c)},s=c=>new Promise((u,p)=>{(c===null||typeof c!="string")&&(c=ht.value),ze.prompt("在 <b>".concat(c,"</b> 下创建文件夹，请输入要创建的文件夹名称"),"提示",{dangerouslyUseHTMLString:!0,confirmButtonText:"确定",cancelButtonText:"取消",draggable:!0,inputValidator(d){return d?d.includes("/")?"文件夹名称不能包含 / (不支持多级创建)":!0:"文件夹名称不能为空"}}).then(({value:d})=>{let b={storageKey:Ye.value,path:c,name:d};sa(b).then(()=>{j.success("创建成功"),u()}).catch(()=>{p()}).finally(()=>{t()})}).catch(()=>{p()})}),a=()=>{let c=dn.value;if(c===null){j.warning("请先选中一个文件或文件夹！");return}if(c.type==="FOLDER"&&!Ze.folderConfig.metadata.supportRenameFolder){j.warning("当前存储源不支持重命名文件夹！");return}ze.prompt("将 <b>".concat(c.name,"</b> 修改为："),"提示",{dangerouslyUseHTMLString:!0,confirmButtonText:"确定",cancelButtonText:"取消",inputValue:c.name,inputValidator(u){return!!u},inputErrorMessage:"模板名称不能为空."}).then(({value:u})=>{let p={storageKey:Ye.value,path:c.path,name:c.name,newName:u},d;c.type==="FILE"?d=Ws:c.type==="FOLDER"&&(d=js);const b=St.service({fullscreen:!0,text:"重命名中...",background:"rgba(255, 255, 255, 0.6)"});d(p).then(()=>{j.success("重命名成功")}).finally(()=>{b.close(),t()})})},l=()=>{var c;if(Je.value.length>0&&!Ze.folderConfig.metadata.supportCopyFolder){j.warning("当前存储源不支持复制文件夹！");return}r("复制",((c=dn.value)==null?void 0:c.type)==="FILE"?Ks:qs)},i=()=>{var c;if(Je.value.length>0&&!Ze.folderConfig.metadata.supportMoveFolder){j.warning("当前存储源不支持移动文件夹！");return}r("移动",((c=dn.value)==null?void 0:c.type)==="FILE"?Us:Vs)},r=(c,u)=>{const p=re.value.map(d=>d.name);Ji(c,Ye.value,ht.value,({value:d,callback:b})=>{if(d===ht.value){j.warning("你选择的目标文件夹与源文件夹相同！"),b.stopLoading();return}let v={storageKey:Ye.value,path:ht.value,nameList:p,targetPath:d,targetNameList:p,srcPathPassword:hn(ht.value),targetPathPassword:hn(d)};u(v).then(_=>{let D=_.data,S=!1;for(let y of D)y.success===!1&&(S=!0);S?ze.confirm("部分文件".concat(c,"失败，是否查看详情？"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",closeOnClickModal:!1,closeOnPressEscape:!1,type:"warning"}).then(()=>{Do(D)}):j.success("".concat(c,"成功"))}).finally(()=>{b.stopLoading(),b.closeDialog(),t()})})};return{batchDownloadFile:n,rename:a,newFolder:s,moveTo:i,copyTo:l,batchDelete:()=>{if(!Ze.permission.delete)return;if(re.value.length===0){j.warning("请先至少选中一个文件或文件夹！");return}let c=re.value.length===1?"是否确认删除 ":"是否确认批量删除 ";Je.value.length>0&&(c+=" "+Je.value.length+" 个文件夹"),Je.value.length>0&&fn.value.length>0&&(c+="，"),fn.value.length>0&&(c+=fn.value.length+" 个文件"),Je.value.length>0&&!Ze.folderConfig.metadata.supportDeleteNotEmptyFolder&&(c+='<span class="font-bold text-red-400">(不支持删除非空文件夹)</span>'),c+="?",ze.confirm(c,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",draggable:!0,dangerouslyUseHTMLString:!0,callback:u=>{if(u==="confirm"){let p={storageKey:Ye.value,deleteItems:[]};re.value.forEach(b=>{p.deleteItems.push({path:b.path,name:b.name,type:b.type,password:hn(b.path)})});const d=St.service({text:"删除中...",background:"rgba(0, 0, 0, .3)"});Is(p).then(b=>{let v=b.data,_=!1;for(let D of v)D.success===!1&&(_=!0);_?ze.confirm("部分文件删除失败，是否查看详情？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",closeOnClickModal:!1,closeOnPressEscape:!1,type:"warning"}).then(()=>{Do(v)}):j.success("删除成功")}).finally(()=>{d.close(),t()})}}})},compression:e}}let Lo=Ae(),$e=Dt();const Xi=Ln("Meta"),Qi=Ln("Control"),er=Ln("Shift");let tr=oe(()=>Xi.value||Qi.value),{batchDelete:To}=Rn();const{openRow:pn}=Mn(),{skeletonLoading:Fo}=zn(),{selectRows:Nt,selectRow:Eo,clearSelection:kn,toggleRowSelection:At,toggleAllSelection:nr}=_t();window.addEventListener("keydown",function(t){var e;t.key==="Escape"&&Bt()?kn():t.key==="a"&&(t.metaKey||t.ctrlKey)&&Bt()?(t.preventDefault(),nr()):t.key==="Delete"&&Bt()?To&&((e=Nt==null?void 0:Nt.value)==null?void 0:e.length)>0&&(t.preventDefault(),To()):t.key==="Backspace"&&Bt()&&$e.fileList.length>0&&$e.fileList[0].type==="BACK"&&_n($e.fileList[0])},!1);const Bt=()=>or()&&da()===!1,or=()=>document.querySelector(".zfile-index-body:hover"),da=()=>!!document.querySelector(".el-popup-parent--hidden"),ar=()=>document.querySelector(".is-message-box .el-input__inner")===document.activeElement,sr=()=>document.querySelector(".zfile-search-input .el-input__inner")===document.activeElement,yt=E(-1),bt=E(-1),{pressed:lr}=za();nt(()=>lr.value,(t,e)=>{t===!1&&e===!0&&(yt.value=-1,bt.value=-1)});let _n;function Ur(){return _n=(o,s)=>{var i;if(s===void 0){pn(o);return}let a=s.type==="selection";if(!a&&($a.value&&Lo.globalConfig.fileClickMode==="click"||Wo.value&&Lo.globalConfig.mobileFileClickMode==="click")){pn(o);return}if(Fo.value)return;let l=Nt.value.length===1&&((i=Eo.value)==null?void 0:i.name)===o.name;if(er.value){let r=$e.fileList.findIndex(f=>f.name===Eo.value.name);if(r!==null){let f=$e.fileList.findIndex(p=>p.name===o.name),c=Math.min(f,r),u=Math.max(f,r);for(let p=c+1;p<u;p++){let d=$e.fileList[p];At(d,!0)}}}else!tr.value&&!l&&!a&&kn();At(o)},{tableClickRow:_n,tableDbClickRow:o=>{Fo.value||pn(o)},tableHoverRow:(o,s,a,l)=>{if(l.buttons===1&&yt.value!==-1){if(bt.value===-1){kn();let u=$e.fileList[yt.value];At(u,!0)}let i=o.index,r=bt.value>=0?bt.value:i-1,f=Math.min(r,i),c=Math.max(r,i);for(let u=f;u<=c;u++){let p=$e.fileList[u];At(p,!0)}bt.value=i}},tableLeaveRow:(o,s,a,l)=>{l.buttons===1&&yt.value===-1&&(yt.value=o.index)}}}let se=Ae(),pt=E(!1),zo=!1;const Ne=E(!1),gn=E(""),ce=ot([]),We=ot([]),_e=new Map,je=new Map;let $o=0;const Po={error:1,uploading:2,waiting:3,finished:4};function Vr(){let{storageKey:t,currentPath:e}=at();const n=se.globalConfig.maxFileUploads,o=h=>{h=document.querySelector("body");const m=L=>{var U,V,An,Bn,On,In,Nn,Wn,jn;let I=((V=(U=L.clipboardData)==null?void 0:U.items)==null?void 0:V.length)>0,H=((Bn=(An=L.dataTransfer)==null?void 0:An.files)==null?void 0:Bn.length)>0;if(O(),pt.value=!1,sr()&&I||da()&&H||ar()||I&&((In=(On=L.clipboardData)==null?void 0:On.types)==null?void 0:In.length)===1&&((Nn=L.clipboardData)==null?void 0:Nn.types[0])==="text/plain"||!t.value||!se.permission.upload)return;L.stopPropagation(),L.preventDefault();const ee=St.service({text:"文件读取中...",background:"rgba(0, 0, 0, .3)"}),N=((Wn=L.clipboardData)==null?void 0:Wn.items)||((jn=L.dataTransfer)==null?void 0:jn.items);x(N).then(async Ce=>{if(ee.close(),se.permission.newFolder||(Ce=Ce.filter(J=>J.dropUploadPath?Qe(J.dropUploadPath).split("/").length<=2:J.webkitRelativePath?Qe(J.webkitRelativePath).split("/").length<=2:J.path?Qe(J.path).split("/").length<=2:!1)),Ce.length===0||Ce.length>100&&await ze.confirm("文件数量为 ".concat(Ce.length," 个，是否确认上传？"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"success"})!=="confirm")return;const Un=St.service({text:"创建文件夹中...",background:"rgba(0, 0, 0, .3)"});let Tt=new Set;Ce=Ce.filter(J=>{if(J.webkitRelativePath||J.dropUploadPath){let xe=J.webkitRelativePath||J.dropUploadPath;xe.startsWith("/")||(xe="/"+xe),xe=xe.substring(0,xe.lastIndexOf("/"));let de="";for(let st of xe.split("/"))st&&(de?de=de+"/"+st:de="/"+st,Tt.add(de))}else if(J.isEmptyDirectory)return Tt.add(J.path),!1;return!0}),console.log("[upload] 要提前创建的文件夹:",Tt);async function pa(J){let xe=e.value;for(let de of J){let st=de.substring(0,de.lastIndexOf("/")),ga=de.substring(de.lastIndexOf("/")+1),en={storageKey:t.value,path:jt(xe,st),name:ga};console.log("[upload] 创建文件夹: path:",en.path,", name:",en.name);try{await sa(en),console.log("[upload] 创建文件夹成功:",de)}catch(yr){console.log("[upload] 创建文件夹失败:",de)}}}if(se.folderConfig.metadata.needCreateFolderBeforeUpload===!0?await pa(Tt).finally(()=>{Un.close()}):Un.close(),Ce.length===0){console.log("[upload] 去除所有空文件夹下没有文件, 则直接返回，无需上传文件");return}Ne.value=!0,Ce.forEach(J=>{l({file:J})})})};let g=null;h.addEventListener("dragenter",L=>{t.value&&(Ne.value||se.permission.upload&&(g=L.target,P(),L.stopPropagation(),L.preventDefault(),pt.value=!0))},!1),h.addEventListener("dragover",function(L){t.value&&(Ne.value||se.permission.upload&&(L.stopPropagation(),L.preventDefault(),pt.value=!0))},!1),h.addEventListener("dragleave",function(L){t.value&&(Ne.value||se.permission.upload&&(g===L.target&&(O(),pt.value=!1),L.stopPropagation(),L.preventDefault()))},!1),h.addEventListener("drop",m,!1),h.addEventListener("paste",m,!1);const x=async L=>{let I=[],H=[];if(L){let ee=new Array(...L);for(let N=0;N<ee.length;N++){let U=ee[N],V=null;if(U.webkitGetAsEntry){if(V=U.webkitGetAsEntry(),!V&&(V=U.getAsFile(),V)){I.push(V);continue}}else if(U.getAsEntry)V=U.getAsEntry();else{j.warning("浏览器不支持拖拽上传");return}V&&H.push(V)}if(H.length>0)for(let N=0;N<H.length;N++){let U=H[N];if(U){let V=await Y(U);Array.isArray(V)?A(V,I):I.push(V)}}}return I},P=()=>{h.classList.add("dragging-over")},O=()=>{h.classList.remove("dragging-over")};function T(L){return new Promise((I,H)=>{L.file(ee=>{I(ee)})})}function B(L){return new Promise((I,H)=>{L.readEntries(ee=>{I(ee)})})}function A(L,I){for(let H=0;H<L.length;H++)Array.isArray(L[H])?A(L[H],I):I.push(L[H])}async function Y(L){let I=L.fullPath||"",H=[];if(L.isFile){let ee=await T(L);return ee.dropUploadPath=I,ee}else if(L.isDirectory){let ee=L.createReader(),N=await B(ee);if(N.length===0)return{path:I,isEmptyDirectory:!0};for(let U=0;U<N.length;U++){let V=await Y(N[U]);H.push(V)}return H}}},s=()=>{Ne.value=!0,gn.value="file"},a=()=>{Ne.value=!0,gn.value="folder",vn(()=>{document.getElementsByClassName("el-upload__input")[0].webkitdirectory=!0})},l=h=>{i(h.file,h.uploadBasePath)},i=async(h,m)=>{const g=$o++;m=m||e.value;let x=m;if(h.webkitRelativePath||h.dropUploadPath){let T=h.webkitRelativePath||h.dropUploadPath;T.startsWith("/")||(T="/"+T);let B=T.split("/");B.forEach((A,Y)=>{let L=Y===0,I=B.length-1===Y;L||I||A&&(x+="/"+A)})}let P={storageKey:t.value,path:Qe(x),name:h.name,size:h.size};if(console.log("[upload] 当前上传信息:",P,", 当前同时上传文件数:",S.value.totalUploading,"限制同时上传文件数:",n),S.value.totalUploading>=n){console.log("[upload] 上传文件数超出 ".concat(n,", 等待上传")),We.push({index:g,file:h,uploadBasePath:m});return}let O={name:h.name,size:h.size,speed:"-",progress:0,loaded:0,status:"uploading",startTime:Date.now(),file:h,index:g};ce.push(O),_e.set(g,lt.CancelToken.source()),je.set(g,ce[ce.length-1]),eo(P).then(T=>{const{on:B}=Vn("cancel-upload-".concat(g));B(()=>{let A=_e.get(g);A&&(A.cancel(),ce.find((Y,L)=>{let I=Y.name===h.name;return I&&ce.splice(L,1),I}))}),se.folderConfig.metadata.uploadType==="PROXY"?f(h,T.data,g):se.folderConfig.metadata.uploadType==="S3"?c(h,T.data,g):se.folderConfig.metadata.uploadType==="MICROSOFT"?u(h,T.data,g):se.folderConfig.metadata.uploadType==="UPYUN"&&p(h,T.data,g)}).catch(T=>{b(g,T)})},r=h=>{let m=e.value,g={storageKey:t.value,path:Qe(m),name:h.name,size:h.size};eo(g).then(x=>{const P=$o++,O=St.service({text:"上传中...",background:"rgba(0, 0, 0, .3)"}),T=()=>{j.success("保存成功"),O.close()},B=A=>{j.error("保存失败: "+d(A)),O.close()};se.folderConfig.metadata.uploadType==="PROXY"?f(h,x.data,P,!0,T,B):se.folderConfig.metadata.uploadType==="S3"?c(h,x.data,P,!0,T,B):se.folderConfig.metadata.uploadType==="MICROSOFT"?u(h,x.data,P,!0,T,B):se.folderConfig.metadata.uploadType==="UPYUN"&&p(h,x.data,P,!0,T,B)})},f=(h,m,g,x=!1,P,O)=>{var B;let T=new FormData;T.append("file",h),Q({method:"PUT",url:m,data:T,config:{headers:{"Content-Type":"multipart/form-data"},cancelToken:(B=_e.get(g))==null?void 0:B.token,onUploadProgress:x?null:A=>{_(A,g,!0)},containToken:!0}}).then(()=>{P?P():v(g)}).catch(A=>{O?O(A):b(g,A)})},c=(h,m,g,x=!1,P,O)=>{var B;let T="";if(m.includes("Content-Type=")){let A=new URL(m);T=A.searchParams.get("Content-Type"),A.searchParams.delete("Content-Type"),m=A.toString()}lt.put(m,h,{withCredentials:!1,headers:{"Content-Type":T},cancelToken:(B=_e.get(g))==null?void 0:B.token,onUploadProgress:x?null:A=>{_(A,g)}}).then(()=>{P?P():v(g)}).catch(A=>{O?O(A):b(g,A)})},u=(h,m,g,x=!1,P,O)=>{let T=1,B=0,A=0,Y=h.size;const L=104857599;if(Y===0){b(g,"当前存储类型不支持上传空文件");return}const I=()=>{var ee;B+L>=Y?A=Y:A=B+L,T>1&&_e.set(g,lt.CancelToken.source());let H=h.slice(B,A);lt.put("".concat(m),H,{cancelToken:(ee=_e.get(g))==null?void 0:ee.token,timeout:1e7,headers:{"Content-Type":"application/octet-stream","Content-Range":"bytes ".concat(B,"-").concat(A-1,"/").concat(h.size)},type:"sync",withCredentials:!1,onUploadProgress:x?null:N=>{if(N.lengthComputable||N.loaded){let U=je.get(g);const V=N.loaded+B;U.size=Y,U.loaded=V,U.progress=Math.round(V/Y*100),U.speed=Sn(Math.round(V/(Date.now()-U.startTime)*1e3))}}}).then(N=>{N.status===202?(B+=L,T+=1,I()):(N.status===201||N.status===200)&&(P?P():v(g))}).catch(N=>{O?O(N):b(g,N)})};I()},p=(h,m,g,x=!1,P,O)=>{var A;let T=JSON.parse(m),B=new FormData;B.append("name",h.name),B.append("authorization",T.signature),B.append("policy",T.policy),B.append("file",h),lt.post(T.url,B,{withCredentials:!1,cancelToken:(A=_e.get(g))==null?void 0:A.token,onUploadProgress:x?null:Y=>{_(Y,g)}}).then(()=>{P?P():v(g)}).catch(Y=>{O?O(Y):b(g,Y)})},d=h=>{var g,x,P;let m="";return(g=h==null?void 0:h.response)!=null&&g.data?(x=h.response.data)!=null&&x.code&&((P=h.response.data)!=null&&P.msg)?m="上传失败 ".concat(h.response.data.code,": ").concat(h.response.data.msg):m=h.response.data:(h==null?void 0:h.name)==="AxiosError"?m="上传失败: 网络错误或目标服务未允许跨域请求":m=h,m},b=(h,m)=>{let g=je.get(h);g.status="error",g.endTime=Date.now(),g.msg=d(m)},v=h=>{let m=je.get(h);m.progress=100,m.status="finished",m.endTime=Date.now(),m.msg="上传成功"},_=(h,m,g)=>{let x=je.get(m);x.size=h.total,x.loaded=h.loaded,x.progress=Math.round(h.loaded/h.total*100),x.speed=Sn(Math.round(h.loaded/(Date.now()-x.startTime)*1e3)),console.log("[upload] uploadFileInfo",x,g),g&&x.progress===100&&(x.msg="上传完成, 服务器中转中...")},D=h=>{ze.confirm('是否确定取消文件 <span class="text-blue-400">'.concat(h.name,"</span> 上传？"),"提示",{confirmButtonText:"确定",cancelButtonText:"返回",type:"warning",dangerouslyUseHTMLString:!0,callback:m=>{m==="confirm"&&Vn("cancel-upload-".concat(h.index)).emit()}})},S=oe(()=>{let h=ce.length,m=0,g=0;ce.forEach(P=>{P.status==="uploading"?m++:P.status==="finished"&&g++});let x=m+We.length;return{totalSize:h,totalUploading:m,totalFinish:g,totalUploadingAndWaiting:x}}),y=oe(()=>{let h=[];return h.push(...ce),We.forEach(m=>{h.push({name:m.file.name,size:m.file.size,status:"waiting",msg:"排队中...",index:m.index})}),h.sort((m,g)=>{let x=m.status,P=g.status;return x!==P?Po[x]-Po[P]:m.startTime!==g.startTime?m.startTime-g.startTime:m.endTime-g.endTime}),console.log("[upload] uploadProgressInfoSorted",h),h});zo||(nt(()=>S.value.totalUploading,h=>{if(h<n)if(console.log("[upload] 检测到上传中的文件个数小于最大上传限制."),We.length===0)console.log("[upload] 等待上传的文件数为 0, 无需继续上传.");else{let g=We.splice(0,1)[0];l({file:g.file,uploadBasePath:g.uploadBasePath}),console.log("[upload] 开始从等待队列中获取上传文件: ",g.file.name)}}),zo=!0);const C=h=>{if(h==null)return;let m=ce.findIndex((g,x)=>{if(g.index===h)return ce.splice(x,1),!0});m===-1&&(m=We.findIndex((g,x)=>{if(g.index===h)return We.splice(x,1),!0})),m!==-1&&(je.delete(h),_e.delete(h))};return{visible:Ne,uploadMode:gn,openUploadDialog:s,openUploadFolderDialog:a,cancelUpload:D,dropState:pt,listenDropFile:o,beforeUpload:l,uploadFile:i,uploadProgressInfoSorted:y,uploadProgressInfoStatistics:S,clearALlFinishedUploadFile:()=>{let h=0;for(let m=ce.length-1;m>=0;m--){let g=ce[m];g.status==="finished"&&(h++,ce.splice(m,1),je.delete(g.index),_e.delete(g.index))}return h},removeUploadFileByIndex:C,retryUpload:h=>{console.log("[upload] 重新上传文件",h),C(h.index),i(h.file)},silentUploadFile:r}}const ir={class:"z-dialog-wrapper"},rr={class:"z-dialog-title"},cr={class:"z-dialog-title-btns"},ur={class:"z-dialog-content"},dr={key:0,class:"z-dialog-footer"},fr=Io({__name:"ZDialog",props:{title:{default:""},isDraggable:{type:Boolean,default:!1},modelValue:{type:Boolean,default:!1},hiddenFullBtn:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},confirmText:{default:"确认"},cancelText:{default:"关闭"},destroyOnClose:{type:Boolean,default:!1},draggable:{type:Boolean,default:!1},autoFullScreen:{type:Boolean,default:!1},onClose:{type:[Function,null],default:null},showFooter:{type:Boolean,default:!0}},emits:["update:modelValue","confirm","close"],setup(t,{expose:e,emit:n}){const o=Pa(),s=Ma(),a=t,l=n,i=E(a.autoFullScreen?window.innerWidth<768:!1),r=oe(()=>o!=null&&o.fullscreen?!1:!a.hiddenFullBtn),f=()=>{o!=null&&o.fullscreen||(i.value=!i.value)},c=()=>{u("close")},u=d=>{Reflect.has(o,"before-close")&&typeof o["before-close"]=="function"&&o["before-close"](),a.onClose?l("close",d):l("update:modelValue")},p=()=>{l("confirm")};return e({isVisible:a.modelValue}),(d,b)=>{var _,D;const v=Ra("loading");return F(),R("div",ir,[ie(M(jo),Aa(M(o),{"model-value":d.modelValue,draggable:d.draggable,"show-close":!1,fullscreen:(D=(_=M(o))==null?void 0:_.fullscreen)!=null?D:i.value,"before-close":c}),{header:le(()=>[k("div",rr,Re(d.title),1),k("div",cr,[r.value?(F(),Ue(M(qn),{key:0,onClick:f},{default:le(()=>[ie(M(Wa))]),_:1})):pe("",!0),ie(M(qn),{size:"20",onClick:b[0]||(b[0]=S=>u("close"))},{default:le(()=>[ie(M(ya))]),_:1})])]),footer:le(()=>[!M(s).footer&&d.showFooter?(F(),R("span",dr,[ie(M(wn),{type:"primary",onClick:p},{default:le(()=>[Wt(Re(d.confirmText),1)]),_:1}),ie(M(wn),{onClick:b[1]||(b[1]=S=>u("cancel"))},{default:le(()=>[Wt(Re(d.cancelText),1)]),_:1})])):yn(d.$slots,"footer",{key:1},void 0,!0)]),default:le(()=>[wt((F(),R("div",ur,[yn(d.$slots,"default",{},void 0,!0)])),[[v,d.loading]])]),_:3},16,["model-value","draggable","fullscreen"])])}}});const Kr=Tn(fr,[["__scopeId","data-v-78c1e6aa"]]),hr={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function pr(t,e){return F(),R("svg",hr,e[0]||(e[0]=[k("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 16v-6m0 0l-3 2m3-2l3 2M3 6v10.8c0 1.12 0 1.68.218 2.108a2 2 0 0 0 .874.874c.427.218.987.218 2.105.218h11.606c1.118 0 1.677 0 2.104-.218c.377-.192.683-.498.875-.874C21 18.48 21 17.92 21 16.8V9.2c0-1.12 0-1.68-.218-2.108a2 2 0 0 0-.874-.874C19.48 6 18.92 6 17.8 6H12M3 6h9M3 6a2 2 0 0 1 2-2h3.675c.489 0 .734 0 .964.055q.308.075.578.24c.202.124.375.297.72.643L12 6"},null,-1)]))}const qr={name:"ci-folder-upload",render:pr},gr={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function mr(t,e){return F(),R("svg",gr,e[0]||(e[0]=[k("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 18v-6m0 0l-3 2m3-2l3 2M13 3H8.2c-1.12 0-1.68 0-2.108.218a2 2 0 0 0-.874.874C5 4.52 5 5.08 5 6.2v11.6c0 1.12 0 1.68.218 2.108a2 2 0 0 0 .874.874c.427.218.987.218 2.105.218h7.606c1.118 0 1.677 0 2.104-.218c.377-.192.683-.498.875-.874c.218-.428.218-.986.218-2.104V9m-6-6c.286.003.466.014.639.055q.308.075.578.24c.202.124.375.297.72.643l3.126 3.125c.346.346.518.518.642.72q.165.271.24.578c.04.173.051.354.054.639M13 3v2.8c0 1.12 0 1.68.218 2.108a2 2 0 0 0 .874.874c.427.218.987.218 2.105.218h2.802m0 0H19"},null,-1)]))}const Hr={name:"ci-file-upload",render:mr},Mo=E(!1);let vr=Yt(),be=vr.zfileConfig,fa={view:{size:2,type:"table"},gallery:{column:Wo.value?be.gallery.mobileColumn:be.gallery.column,columnSpacing:be.gallery.columnSpacing,rowSpacing:be.gallery.rowSpacing,showInfo:be.gallery.showInfo,showInfoMode:be.gallery.showInfoMode,roundedBorder:be.gallery.roundedBorder,showBackTop:be.gallery.showBackTop},imagePreview:{mode:be.imagePreview.mode,gallery:be.imagePreview.gallery}};const ha=(t,e)=>{e=e||globalThis;for(let n in t)e[n]===void 0?e[n]=t[n]:t[n]instanceof Object&&e[n]instanceof Object&&ha(t[n],e[n])},Ht=Dn("zfile-setting-cache",fa);Ht.value.view.type||(Ht.value.view.type="table");function Gr(){const t=()=>{Mo.value=!0};return ha(fa,Ht.value),{visible:Mo,zfileSettingCache:Ht,openSettingVisible:t}}export{Ir as A,ni as B,Uo as C,Ar as D,Wr as E,Rr as F,Kr as Z,xi as _,_t as a,Vr as b,Ae as c,jr as d,Zl as e,Sn as f,Na as g,ql as h,Ul as i,Nl as j,Bl as k,Mn as l,Rn as m,Xs as n,Hr as o,qr as p,wi as q,Ur as r,Mr as s,zn as t,Dt as u,Gr as v,Nr as w,ll as x,Xt as y,Ni as z};
