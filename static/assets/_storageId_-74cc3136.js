import{r as S,a3 as A,Y as F,_ as L,o as W,b as v,g as Y,k as r,w as d,x as s,a0 as i,f as e,$ as H,e as b,aj as $,l as h}from"./index-008199ed.js";/* empty css                */import{_ as J,a as K}from"./el-table-column-plus-be255135.js";import{E as O}from"./button-30635c71.js";import"./input-73d413ba.js";import{_ as Q}from"./Cancel-b93a9a48.js";import{E as X}from"./alert-f7baa744.js";import{n as Z,o as ee,j as te}from"./admin-storage-185041e5.js";import{S as oe}from"./sortable.esm-20789f58.js";import{i as V}from"./base-00eb0fe9.js";import{E as le,b as ae}from"./request-7014ab81.js";import{E as se}from"./index-c0734d0a.js";import{b as q}from"./route-block-83d24a4e.js";import{_ as re}from"./_plugin-vue_export-helper-c27b6911.js";import{r as C,a as ne,b as ie}from"./FolderIcon-e4e9f716.js";import{r as de}from"./KeyIcon-1b979890.js";import{r as pe,a as me}from"./ArrowUpIcon-0322479b.js";import{r as ue}from"./TrashIcon-6780b292.js";import{r as ce}from"./PlusIcon-76caf486.js";import{r as fe}from"./CheckBadgeIcon-af1628c6.js";import{v as _e}from"./directive-20abcd4b.js";import"./index-91840f01.js";import"./index-0da14aee.js";import"./index-4ea0a277.js";import"./index-60380bfa.js";import"./_initCloneObject-ffec0ace.js";import"./index-293710b7.js";import"./debounce-3f0c1a7c.js";import"./index-680901bf.js";import"./admin-form-header-819a5389.js";import"./arrow-left-6c74187b.js";import"./index-8286893b.js";import"./vnode-5e2fd68e.js";import"./scroll-374ad3fb.js";import"./validator-38288ad7.js";let a=S([]),E=S(!1);function ve(D,w){let m=w.params.storageId;const k=()=>{Z(m).then(l=>{a.value=l.data,a.value.length===0&&c(),y()})},y=()=>{const l=document.querySelectorAll(".el-table__body-wrapper table > tbody")[0];l&&oe.create(l,{filter:".el-button",onEnd:t=>{if(t.oldIndex===t.newIndex)return;const u=a.value.splice(t.oldIndex,1)[0];a.value.splice(t.newIndex,0,u)}})},x=()=>{if(!a.value.find(t=>{if(V(t.description)||V(t.expression)||V(t.password))return le.warning("请检查数据填写是否完整"),!0})){E.value=!0;for(let t=0;t<a.value.length;t++){let u=a.value[t];u.id=t+1}ee(m,a.value).then(()=>{se.confirm("保存成功, 是否返回存储源列表？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"success",callback:t=>{t==="confirm"&&D.push("/admin/storage-list")}})}).finally(()=>{E.value=!1})}},c=()=>{a.value.push({description:"表达式 - "+(a.value.length+1),expression:"",password:"",storageId:m})};return{loading:E,loadData:k,list:a,addItem:c,deleteItem:l=>{a.value.splice(l,1)},moveUp:l=>{if(l===0)return;const t=a.value[l];a.value.splice(l,1),a.value.splice(l-1,0,t)},moveDown:l=>{if(l===a.value.length-1)return;const t=a.value[l];a.value.splice(l,1),a.value.splice(l+1,0,t)},saveData:x}}const ge={class:"zfile-admin-password-body"},be={class:"rules-tips-link"},we={target:"_blank",class:"link",href:"http://www.ruanyifeng.com/blog/2018/09/bash-wildcards.html"},ke={target:"_blank",class:"link",href:"http://www.ruanyifeng.com/blog/2018/09/bash-wildcards.html"},ye={target:"_blank",class:"link",href:"https://github.com/whinc/blog/issues/18"},xe={class:"save-btn"},M={__name:"[storageId]",props:{storageId:{type:Number,required:!1}},setup(D){const w=A();let m=F(),k=L();const{loading:y,loadData:x,list:c,addItem:U,deleteItem:B,moveDown:z,moveUp:l,saveData:t}=ve(k,m);W(()=>{x(),N()});const u=S(),N=()=>{te(m.params.storageId).then(g=>{g.data.type=g.data.type.key,u.value=g.data})};return(g,o)=>{var R;const T=X,G=Q,f=J,I=ae,_=O,P=K,j=_e;return v(),Y("div",ge,[r(G,{to:"/admin/storage-list",title:"密码文件夹（"+((R=e(u))==null?void 0:R.name)+"）"},{default:d(()=>[r(T,{closable:!1,type:"info"},{default:d(()=>[o[3]||(o[3]=s("div",{class:"rules-tips"},"Glob 表达式规则：",-1)),o[4]||(o[4]=s("div",{class:"rules-tips"},[s("b",null,"单层根目录加密"),i(": 如 "),s("span",{class:"select-all code"},"/"),i(" 表示根路径下需要密码访问.")],-1)),o[5]||(o[5]=s("div",{class:"rules-tips"},[s("b",null,"单层子目录加密"),i(": 如 "),s("span",{class:"select-all code"},"/music/*"),i(" 表示根目录下的 music 文件夹需要密码访问, 子文件夹不加密.")],-1)),o[6]||(o[6]=s("div",{class:"rules-tips"},[s("b",null,"嵌套子目录加密"),i(": 如 "),s("span",{class:"select-all code"},"/music/**"),i(" 表示根目录下的 music 文件夹及其所有子文件夹都需要密码访问.")],-1)),o[7]||(o[7]=s("div",{class:"rules-tips"},"注：系统匹配到第一个符合的规则就会取密码进行校验，并返回结果，所以请调整好规则顺序，下方规则可进行拖拽排序。",-1)),s("div",be,[s("a",we,[r(e(C),{class:"inline mr-1"}),o[0]||(o[0]=s("span",null,"参考文章 (Wikipedia)",-1))]),s("a",ke,[r(e(C),{class:"inline mr-1"}),o[1]||(o[1]=i("参考文章 (阮一峰)"))]),s("a",ye,[r(e(C),{class:"inline mr-1"}),o[2]||(o[2]=i("参考文章 (Github)"))])])]),_:1,__:[3,4,5,6,7]})]),_:1},8,["title"]),H((v(),b(P,{size:e(w).adminTable.size,"row-key":"id",data:e(c)},{default:d(()=>[e($)?(v(),b(f,{key:0,label:"ID",prop:"id"})):h("",!0),r(f,{label:"描述",prop:"description"},{default:d(n=>[r(I,{"prefix-icon":e(ne),placeholder:"请输入表达式描述",modelValue:n.row.description,"onUpdate:modelValue":p=>n.row.description=p},null,8,["prefix-icon","modelValue","onUpdate:modelValue"])]),_:1}),r(f,{label:"表达式",prop:"expression"},{default:d(n=>[r(I,{"prefix-icon":e(ie),placeholder:"请输入表达式",modelValue:n.row.expression,"onUpdate:modelValue":p=>n.row.expression=p,modelModifiers:{trim:!0}},null,8,["prefix-icon","modelValue","onUpdate:modelValue"])]),_:1}),r(f,{label:"密码",width:"200",prop:"password"},{default:d(n=>[r(I,{"prefix-icon":e(de),placeholder:"请输入密码",type:"password","show-password":"",modelValue:n.row.password,"onUpdate:modelValue":p=>n.row.password=p},null,8,["prefix-icon","modelValue","onUpdate:modelValue"])]),_:1}),r(f,{align:"center",label:"操作",width:"60px"},{default:d(n=>[e($)&&n.$index!==0?(v(),b(_,{key:0,type:"primary",onClick:p=>e(l)(n.$index),icon:e(pe)},null,8,["onClick","icon"])):h("",!0),e($)&&n.$index!==e(c).length-1?(v(),b(_,{key:1,type:"primary",onClick:p=>e(z)(n.$index),icon:e(me)},null,8,["onClick","icon"])):h("",!0),r(_,{type:"danger",onClick:p=>e(B)(n.$index),icon:e(ue)},null,8,["onClick","icon"])]),_:1})]),_:1},8,["size","data"])),[[j,e(y)]]),r(_,{class:"add-more-btn",size:"default",icon:e(ce),onClick:e(U)},{default:d(()=>o[8]||(o[8]=[i("添加更多")])),_:1,__:[8]},8,["icon","onClick"]),s("div",xe,[r(_,{type:"primary",size:"default",icon:e(fe),onClick:e(t)},{default:d(()=>o[9]||(o[9]=[i("保存设置")])),_:1,__:[9]},8,["icon","onClick"])])])}}};typeof q=="function"&&q(M);const at=re(M,[["__scopeId","data-v-d3c0e0f4"]]);export{at as default};
