System.register(["./index-legacy-e574cec8.js","./loading-legacy-2688a411.js","./dialog-legacy-5ef05c71.js","./overlay-legacy-6ebb9437.js","./form-item-legacy-de8da7e8.js","./table-column-legacy-0040b455.js","./checkbox-legacy-80a8805e.js","./tooltip-legacy-518b8698.js","./popper-legacy-ef8fd66b.js","./scrollbar-legacy-0817fabf.js","./switch-legacy-a4b2d82c.js","./popover-legacy-fa927888.js","./tag-legacy-5e0686c8.js","./checkbox-group-legacy-8d8ae0d6.js","./button-group-legacy-2e59a83e.js","./button-legacy-f53896dd.js","./input-legacy-bc871eba.js","./Cancel-legacy-ab83e01a.js","./admin-user-legacy-034d5c87.js","./admin-storage-legacy-6381f83d.js","./request-legacy-61b983ae.js","./base-legacy-173045dc.js","./route-block-legacy-509c7347.js","./_plugin-vue_export-helper-legacy-8fcf0e06.js","./QuestionMarkCircleIcon-legacy-13cc9795.js","./CheckBadgeIcon-legacy-a01a5b9d.js","./index-legacy-69b9ad2b.js","./index-legacy-183af9d3.js","./index-legacy-1ae34dc2.js","./index-legacy-32709ede.js","./directive-legacy-64af483a.js","./index-legacy-b5baaeae.js","./vnode-legacy-bdad68af.js","./index-legacy-c317e588.js","./scroll-legacy-68db505b.js","./refs-legacy-1635e56d.js","./validator-legacy-a3ca6880.js","./_initCloneObject-legacy-b35b9836.js","./admin-form-header-legacy-5b0f136c.js","./arrow-left-legacy-eb9efd7f.js","./index-legacy-ea3d196e.js","./index-legacy-d493f4b0.js","./debounce-legacy-321ba92e.js","./dropdown-legacy-648534c2.js"],(function(e,n){"use strict";var l,t,u,r,a,o,i,s,c,d,f,m,p,g,v,y,h,_,b,w,j,k,x,S,P,V,L,z,C,U,E,F,I,D,M,N,O,R,B,H,T,W,q,Z,G,Q,Y,A,$;return{setters:[function(e){l=e.b,t=e.g,u=e.x,r=e.a3,a=e.Y,o=e._,i=e.r,s=e.o,c=e.c,d=e.f,f=e.$,m=e.e,p=e.w,g=e.k,v=e.a0,y=e.F,h=e.G,_=e.y,b=e.l,w=e.a2,j=e.a1,k=e.aj},null,function(e){x=e.E},null,null,null,null,null,null,null,function(e){S=e.E},null,null,null,null,function(e){P=e.E,V=e.d},function(e){L=e.E,z=e.a},function(e){C=e._},function(e){U=e.c,E=e.s,F=e.b},function(e){I=e.l},function(e){D=e.f,M=e.E,N=e.b,O=e.e,R=e.t},function(e){B=e.g},function(e){H=e.b},function(e){T=e._},function(e){W=e.r},function(e){q=e.r},function(e){Z=e.E,G=e.a},function(e){Q=e.E},function(e){Y=e.E},function(e){A=e.E},function(e){$=e.v},null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){var n=document.createElement("style");function J(e,n){return l(),t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[u("path",{"fill-rule":"evenodd",d:"M11.078 2.25c-.917 0-1.699.663-1.85 1.567L9.05 4.889c-.02.12-.115.26-.297.348a7.493 7.493 0 0 0-.986.57c-.166.115-.334.126-.45.083L6.3 5.508a1.875 1.875 0 0 0-2.282.819l-.922 1.597a1.875 1.875 0 0 0 .432 2.385l.84.692c.095.078.17.229.154.43a7.598 7.598 0 0 0 0 1.139c.015.2-.059.352-.153.43l-.841.692a1.875 1.875 0 0 0-.432 2.385l.922 1.597a1.875 1.875 0 0 0 2.282.818l1.019-.382c.115-.043.283-.031.45.082.312.214.641.405.985.57.182.088.277.228.297.35l.178 1.071c.151.904.933 1.567 1.85 1.567h1.844c.916 0 1.699-.663 1.85-1.567l.178-1.072c.02-.12.114-.26.297-.349.344-.165.673-.356.985-.57.167-.114.335-.125.45-.082l1.02.382a1.875 1.875 0 0 0 2.28-.819l.923-1.597a1.875 1.875 0 0 0-.432-2.385l-.84-.692c-.095-.078-.17-.229-.154-.43a7.614 7.614 0 0 0 0-1.139c-.016-.2.059-.352.153-.43l.84-.692c.708-.582.891-1.59.433-2.385l-.922-1.597a1.875 1.875 0 0 0-2.282-.818l-1.02.382c-.114.043-.282.031-.449-.083a7.49 7.49 0 0 0-.985-.57c-.183-.087-.277-.227-.297-.348l-.179-1.072a1.875 1.875 0 0 0-1.85-1.567h-1.843ZM12 15.75a3.75 3.75 0 1 0 0-7.5 3.75 3.75 0 0 0 0 7.5Z","clip-rule":"evenodd"})])}n.textContent=".el-form[data-v-12c37dd8] .el-input input{-webkit-box-shadow:0 0 0 1000px white inset;box-shadow:0 0 0 1000px #fff inset}.zfile-user-permission-checkbox-body[data-v-12c37dd8]{overflow-y:auto;height:65vh}.zfile-user-permission-checkbox-body[data-v-12c37dd8] .el-checkbox__label{vertical-align:top}\n",document.head.appendChild(n);var K={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},X={name:"mdi-shuffle-variant",render:function(e,n){return l(),t("svg",K,n[0]||(n[0]=[u("path",{fill:"currentColor",d:"m17 3l5.25 4.5L17 12l5.25 4.5L17 21v-3h-2.74l-2.82-2.82l2.12-2.12L15.5 15H17V9h-1.5l-9 9H2v-3h3.26l9-9H17zM2 6h4.5l2.82 2.82l-2.12 2.12L5.26 9H2z"},null,-1)]))}},ee={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},ne={name:"mdi-close-circle",render:function(e,n){return l(),t("svg",ee,n[0]||(n[0]=[u("path",{fill:"currentColor",d:"M12 2c5.53 0 10 4.47 10 10s-4.47 10-10 10S2 17.53 2 12S6.47 2 12 2m3.59 5L12 10.59L8.41 7L7 8.41L10.59 12L7 15.59L8.41 17L12 13.41L15.59 17L17 15.59L13.41 12L17 8.41z"},null,-1)]))}},le={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},te={name:"mdi-check-circle",render:function(e,n){return l(),t("svg",le,n[0]||(n[0]=[u("path",{fill:"currentColor",d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10s10-4.5 10-10S17.5 2 12 2m-2 15l-5-5l1.41-1.41L10 14.17l7.59-7.59L19 8z"},null,-1)]))}},ue={key:0},re={key:1},ae={key:2},oe={key:3},ie={class:"flex justify-between"},se={class:"flex space-x-2"},ce={class:"space-x-2"},de={class:"space-y-2"},fe={class:"mb-5"},me={class:"zfile-user-permission-checkbox-body"},pe={__name:"index",setup:function(e){var n=r(),H=a(),T=o(),K=H.params.userId,ee=i({id:null,username:"",nickname:"",enable:!0,createTime:"",defaultPermissions:[],userStorageSourceList:[],roleId:""});s((function(){pe(),ve()}));var le,pe=(le=function(){I().then((function(e){var n=e.data,l=ee.value.userStorageSourceList,t=n.map((function(e){return e.id})),u=l.map((function(e){return e.storageSourceId})),r=u.filter((function(e){return!t.includes(e)})),a=t.filter((function(e){return!u.includes(e)}));r.forEach((function(e){var n=l.findIndex((function(n){return n.storageSourceId===e}));console.log("检测到存储源被删除，删除掉：",l[n].storageSourceName),l.splice(n,1)})),a.forEach((function(e){var t=n.find((function(n){return n.id===e}));l.push({storageSourceId:t.id,storageSourceName:t.name,rootPath:"/",enable:!1,permissions:[],new:!0}),console.log("检测到存储源被添加，添加进去：",t.name)}))}))},{init:function(){K?F(K).then((function(e){e.data.defaultPermissions||(e.data.defaultPermissions=[]),e.data.userStorageSourceList&&e.data.userStorageSourceList.forEach((function(e){e.permissions&&e.permissions.includes("available")&&e.permissions.splice(e.permissions.indexOf("available"),1)})),ee.value=e.data,le()})):le()}}).init,ge=function(){var e=i(!1),n=i([]),l=i({}),t=i([]),u=i(null);return{loadPermissionList:function(){D({url:"/admin/permission/list",method:"get"}).then((function(e){n.value=e.data,l.value=e.data.reduce((function(e,n){return e[n.value]=n,e}),{})}))},permissionList:n,getPermissionName:function(e){var n=l.value[e];return n?n.name:e},showSetPermissionDialog:e,openSetPermissionDialog:function(n){e.value=!0,u.value=n,t.value=n?n.permissions:[]},currentOpenPermissions:t,enterSetPermissionDialog:function(){u.value?u.value.permissions=t.value:Le.value.getSelectionRows().forEach((function(e){e.permissions=t.value})),e.value=!1},setFromUserDefaultPermission:function(){t.value=ee.value.defaultPermissions}}}(),ve=ge.loadPermissionList,ye=ge.permissionList,he=ge.getPermissionName,_e=ge.showSetPermissionDialog,be=ge.currentOpenPermissions,we=ge.openSetPermissionDialog,je=ge.enterSetPermissionDialog,ke=ge.setFromUserDefaultPermission,xe=i(!1),Se=i(null),Pe=function(){var e=ee.value.userStorageSourceList.findIndex((function(e){return void 0===e.rootPath||null===e.rootPath||""===e.rootPath||!e.rootPath.startsWith("/")}));-1===e?(xe.value=!0,Se.value.validate((function(e){e?E(ee.value).then((function(e){M.success("保存成功");var n=e.data.id;n!=K?T.push("/admin/user-edit/"+n):pe()})).finally((function(){xe.value=!1})):xe.value=!1}))):M.error("第 ".concat(e+1," 个存储源的根目录配置错误，请检查。（不能为空，且必须以 / 开头）"))},Ve=i({username:[{required:!0,message:"请输入用户名"},{min:1,max:255,message:"长度应在 1 到 255 个字符",trigger:"blur"},{validator:function(e,n,l){if(null!=n&&""!==n){var t={id:ee.value.id,username:n};U(t).then((function(e){e.data?l(new Error("该用户名已存在，请修改。")):l()}))}else l()}}],password:[{min:6,max:255,message:"长度在 6 到 255 个字符",trigger:"blur"}]}),Le=i(null),ze=c((function(){return Le.value?Le.value.getSelectionRows().length:0})),Ce=c({get:function(){return ee.value.userStorageSourceList.every((function(e){return e.enable}))},set:function(e){ee.value.userStorageSourceList.forEach((function(n){n.enable=e}))}});return function(e,r){var a=C,o=N,i=L,s=te,c=P,U=ne,E=X,F=V,I=O,D=R,M=Z,H=Q,T=Y,K=A,le=S,pe=G,ge=z,ve=x,Ue=$;return l(),t(y,null,[d(ee)?f((l(),m(ge,{key:0,model:d(ee),"label-width":d(n).adminForm.labelWidth,"label-position":d(n).adminForm.labelPosition,size:d(n).adminForm.size,"scroll-to-error":"","status-icon":"",class:"z-admin-form",autocomplete:"nope",ref_key:"adminUserFormRef",ref:Se,rules:d(Ve)},{default:p((function(){return[g(a,{title:"用户设置",to:"/admin/user-list"}),g(i,{size:d(n).adminForm.size,label:"用户名",prop:"username"},{default:p((function(){return[g(o,{readonly:2===d(ee).id,modelValue:d(ee).username,"onUpdate:modelValue":r[0]||(r[0]=function(e){return d(ee).username=e})},{suffix:p((function(){return[0===d(ee).id?(l(),t("span",ue,"内置虚拟新用户")):1===d(ee).id?(l(),t("span",re,"内置管理员用户")):2===d(ee).id?(l(),t("span",ae,"内置匿名用户")):(l(),t("span",oe,"普通用户"))]})),_:1},8,["readonly","modelValue"])]})),_:1},8,["size"]),g(i,{label:"用户昵称",prop:"nickname"},{default:p((function(){return[g(o,{readonly:2===d(ee).id,modelValue:d(ee).nickname,"onUpdate:modelValue":r[1]||(r[1]=function(e){return d(ee).nickname=e})},null,8,["readonly","modelValue"])]})),_:1}),g(i,{label:"密码"},{default:p((function(){return[g(o,{autocomplete:"off",modelValue:d(ee).password,"onUpdate:modelValue":r[2]||(r[2]=function(e){return d(ee).password=e}),type:"password","show-password":""},null,8,["modelValue"]),r[16]||(r[16]=u("div",{class:"el-form-item-tips"}," 编辑时不显示密码，不修改密码请留空 ",-1))]})),_:1,__:[16]}),g(i,{label:"用户默认权限"},{default:p((function(){return[u("div",null,[g(F,{type:"primary",class:"mb-2"},{default:p((function(){return[g(c,{onClick:r[3]||(r[3]=function(e){return d(ee).defaultPermissions=d(ye).map((function(e){return e.value}))})},{default:p((function(){return[g(s,{class:"mr-1"}),r[17]||(r[17]=v(" 全选 "))]})),_:1,__:[17]}),g(c,{onClick:r[4]||(r[4]=function(e){return d(ee).defaultPermissions=[]})},{default:p((function(){return[g(U,{class:"mr-1"}),r[18]||(r[18]=v(" 全不选 "))]})),_:1,__:[18]}),g(c,{onClick:r[5]||(r[5]=function(e){return d(ee).defaultPermissions=d(ye).filter((function(e){return!d(ee).defaultPermissions.includes(e.value)})).map((function(e){return e.value}))})},{default:p((function(){return[g(E,{class:"mr-1"}),r[19]||(r[19]=v(" 反选 "))]})),_:1,__:[19]})]})),_:1}),g(D,{modelValue:d(ee).defaultPermissions,"onUpdate:modelValue":r[6]||(r[6]=function(e){return d(ee).defaultPermissions=e}),class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5"},{default:p((function(){return[(l(!0),t(y,null,h(d(ye),(function(e){return l(),m(I,{key:e.value,value:e.value},{default:p((function(){return[v(_(e.name),1)]})),_:2},1032,["value"])})),128))]})),_:1},8,["modelValue"])]),r[20]||(r[20]=u("div",{class:"el-form-item-tips"}," 这里控制新增存储源时，该用户默认拥有的权限（仅对新增的存储源有效，已存在的但未授予权限的存储源不会使用此配置；如没有任何默认权限，则添加存储源时不会授予使用） ",-1))]})),_:1,__:[20]}),g(i,{label:"存储源授权"},{default:p((function(){return[g(F,null,{default:p((function(){return[g(c,{type:"primary",size:"small",class:"mb-2",disabled:0===d(ze),onClick:r[7]||(r[7]=function(e){return d(we)(null)})},{default:p((function(){return r[21]||(r[21]=[v("批量设置存储源列表 ")])})),_:1,__:[21]},8,["disabled"])]})),_:1}),g(pe,{size:d(n).adminTable.size,data:d(ee).userStorageSourceList,border:"",ref_key:"userStorageSourceTableRef",ref:Le},{default:p((function(){return[g(M,{type:"selection",width:"50"}),g(M,{"show-overflow-tooltip":"",prop:"storageSourceName",label:"存储源名称"},{default:p((function(e){return[u("div",ie,[u("span",null,_(e.row.storageSourceName),1),e.row.new?(l(),m(T,{key:0,effect:"dark",content:"表示可能是新增的存储源，但该存储源还未授权.",placement:"left"},{default:p((function(){return[g(H,{type:"success",size:"small"},{default:p((function(){return r[22]||(r[22]=[v("new")])})),_:1,__:[22]})]})),_:1})):b("",!0)])]})),_:1}),g(M,{"show-overflow-tooltip":"",prop:"rootPath"},{header:p((function(){return[r[24]||(r[24]=u("span",null,"授予根目录",-1)),g(K,{placement:"right",width:"300",trigger:"hover"},{default:p((function(){return r[23]||(r[23]=[v(" 表示该用户使用存储源下哪个目录作为根目录，注意要先创建好目录，否则使用时可能会出现问题，且不能填写 URL 编码后的路径。 ")])})),reference:p((function(){return[g(d(W),{class:"inline w-4 ml-1 -mt-0.5"})]})),_:1})]})),default:p((function(e){return[g(o,{modelValue:e.row.rootPath,"onUpdate:modelValue":function(n){return e.row.rootPath=n},size:"small",placeholder:"请输入授权根目录"},null,8,["modelValue","onUpdate:modelValue"])]})),_:1}),g(M,{width:"120px",prop:"enable",label:"允许使用"},{header:p((function(){return[u("div",se,[r[25]||(r[25]=u("span",null,"允许使用",-1)),g(T,{effect:"dark",content:"批量选择",placement:"top"},{default:p((function(){return[g(I,{modelValue:d(Ce),"onUpdate:modelValue":r[8]||(r[8]=function(e){return w(Ce)?Ce.value=e:null}),size:"small"},null,8,["modelValue"])]})),_:1})])]})),default:p((function(e){return[g(le,{modelValue:e.row.enable,"onUpdate:modelValue":function(n){return e.row.enable=n}},null,8,["modelValue","onUpdate:modelValue"])]})),_:1}),g(M,{width:"120px",prop:"readOnly",label:"权限列表"},{default:p((function(e){return[u("div",ce,[g(K,{disabled:0===d(B)(e.row.permissions),placement:"left",width:10},{reference:p((function(){return[g(H,{effect:"dark"},{default:p((function(){return[v(_(d(B)(e.row.permissions))+" 个",1)]})),_:2},1024)]})),default:p((function(){return[u("div",de,[(l(!0),t(y,null,h(e.row.permissions,(function(e){return l(),t("div",{class:"space-x-2",key:e.id},[g(H,null,{default:p((function(){return[v(_(d(he)(e)),1)]})),_:2},1024)])})),128))])]})),_:2},1032,["disabled"]),g(d(J),{onClick:function(n){return d(we)(e.row)},class:"inline w-5 text-blue-400 cursor-pointer"},null,8,["onClick"])])]})),_:1})]})),_:1},8,["size","data"])]})),_:1}),g(i,{label:"启用状态"},{default:p((function(){return[g(le,{modelValue:d(ee).enable,"onUpdate:modelValue":r[9]||(r[9]=function(e){return d(ee).enable=e})},null,8,["modelValue"])]})),_:1}),g(i,{"label-width":d(n).adminForm.labelWidth,class:"admin-from-footer"},{default:p((function(){return[g(c,{class:"ml-auto",type:"primary",icon:d(q),loading:d(xe),onClick:Pe},{default:p((function(){return r[26]||(r[26]=[v("保存")])})),_:1,__:[26]},8,["icon","loading"])]})),_:1},8,["label-width"])]})),_:1},8,["model","label-width","label-position","size","rules"])),[[Ue,d(xe)]]):b("",!0),g(ve,{"append-to-body":"",title:"设置权限列表",top:"5vh",width:d(k)?"95%":"400px",modelValue:d(_e),"onUpdate:modelValue":r[15]||(r[15]=function(e){return w(_e)?_e.value=e:null})},{footer:p((function(){return[g(c,{size:"default",onClick:r[14]||(r[14]=function(e){return _e.value=!1})},{default:p((function(){return r[31]||(r[31]=[v("取消")])})),_:1,__:[31]}),g(c,{type:"primary",size:"default",icon:d(q),onClick:d(je)},{default:p((function(){return r[32]||(r[32]=[v("确认")])})),_:1,__:[32]},8,["icon","onClick"])]})),default:p((function(){return[u("div",fe,[g(c,{type:"primary",size:"small",onClick:r[10]||(r[10]=function(e){return be.value=d(ye).map((function(e){return e.value}))})},{default:p((function(){return r[27]||(r[27]=[v(" 全选 ")])})),_:1,__:[27]}),g(c,{type:"primary",size:"small",onClick:r[11]||(r[11]=function(e){return be.value=[]})},{default:p((function(){return r[28]||(r[28]=[v("全不选")])})),_:1,__:[28]}),g(c,{type:"primary",size:"small",onClick:r[12]||(r[12]=function(e){return be.value=d(ye).filter((function(e){return!d(be).includes(e.value)})).map((function(e){return e.value}))})},{default:p((function(){return r[29]||(r[29]=[v(" 反选 ")])})),_:1,__:[29]}),g(c,{type:"primary",size:"small",onClick:d(ke)},{default:p((function(){return r[30]||(r[30]=[v("设置为用户默认权限")])})),_:1,__:[30]},8,["onClick"])]),u("div",me,[g(D,{size:d(n).adminForm.size,modelValue:d(be),"onUpdate:modelValue":r[13]||(r[13]=function(e){return w(be)?be.value=e:null})},{default:p((function(){return[(l(!0),t(y,null,h(d(ye),(function(e){return l(),m(I,{class:"!block",key:e.value,value:e.value},{default:p((function(){return[u("span",null,_(e.name),1),g(K,{placement:"right",width:"300",trigger:"hover"},{default:p((function(){return[v(_(e.tips),1)]})),reference:p((function(){return[f(g(d(W),{class:"inline w-4 ml-1 -mt-0.5"},null,512),[[j,e.tips]])]})),_:2},1024)]})),_:2},1032,["value"])})),128))]})),_:1},8,["size","modelValue"])])]})),_:1},8,["width","modelValue"])],64)}}};"function"==typeof H&&H(pe),e("default",T(pe,[["__scopeId","data-v-12c37dd8"]]))}}}));
