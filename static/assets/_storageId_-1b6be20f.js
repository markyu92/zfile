import{r as w,a3 as X,Y as Z,_ as ee,o as te,ak as oe,b as _,g as le,x as l,f as e,e as b,w as n,k as a,y as ae,a0 as p,l as x,$ as ie,aj as R,a2 as se,F as re}from"./index-008199ed.js";/* empty css                */import{_ as ne,a as me}from"./el-table-column-plus-be255135.js";import{E as de}from"./button-30635c71.js";/* empty css            */import{E as pe,a as ue}from"./select-275ec4c7.js";/* empty css                  *//* empty css               */import"./input-73d413ba.js";import{_ as ce}from"./admin-form-header-819a5389.js";import{E as _e}from"./alert-f7baa744.js";import"./tooltip-4ed993c7.js";import{E as fe}from"./switch-6e3117dc.js";import{_ as ve}from"./arrow-left-6c74187b.js";import{r as be,t as ge,j as ye,u as xe}from"./admin-storage-185041e5.js";import we from"./readme-editor-dialog-52dabd20.js";import{i as S}from"./base-00eb0fe9.js";import{S as ke}from"./sortable.esm-20789f58.js";import{E as j,b as Ve}from"./request-7014ab81.js";import{E as Ie}from"./index-c0734d0a.js";import{b as z}from"./route-block-83d24a4e.js";import{_ as Ee}from"./_plugin-vue_export-helper-c27b6911.js";import{r as U,a as $e,b as Ce}from"./FolderIcon-e4e9f716.js";import{r as he}from"./DocumentTextIcon-be3b1186.js";import{r as Re,a as Se}from"./ArrowUpIcon-0322479b.js";import{r as Ue}from"./TrashIcon-6780b292.js";import{r as Te}from"./PlusIcon-76caf486.js";import{r as De}from"./CheckBadgeIcon-af1628c6.js";import{E as Me}from"./index-60380bfa.js";import{v as Be}from"./directive-20abcd4b.js";import"./index-91840f01.js";import"./index-0da14aee.js";import"./index-4ea0a277.js";import"./_initCloneObject-ffec0ace.js";import"./index-293710b7.js";import"./debounce-3f0c1a7c.js";import"./index-680901bf.js";import"./index-dc7d0be4.js";import"./strings-535b4609.js";import"./scroll-374ad3fb.js";import"./vnode-5e2fd68e.js";import"./validator-38288ad7.js";import"./dialog-9877e468.js";import"./index-8286893b.js";import"./overlay-64b24548.js";import"./refs-9142934b.js";let r=w([]),T=w(!1);function qe(D,k){let u=k.params.storageId;const V=()=>{be(u).then(s=>{r.value=s.data,r.value.length===0&&g(),I()})},I=()=>{const s=document.querySelectorAll(".el-table__body-wrapper table > tbody")[0];s&&ke.create(s,{filter:".el-button",onEnd:i=>{if(i.oldIndex===i.newIndex)return;const d=r.value.splice(i.oldIndex,1)[0];r.value.splice(i.newIndex,0,d)}})},E=()=>{if(!r.value.find(i=>{if(S(i.description)||S(i.expression)||S(i.readmeText))return j.warning("请检查数据填写是否完整"),!0})){T.value=!0;for(let i=0;i<r.value.length;i++){let d=r.value[i];d.id=i+1}ge(u,r.value).then(()=>{Ie.confirm("保存成功, 是否返回存储源列表？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"success",callback:i=>{i==="confirm"&&D.push("/admin/storage-list")}})}).finally(()=>{T.value=!1})}},g=()=>{r.value.push({description:"表达式 - "+(r.value.length+1),expression:"",readmeText:"",displayMode:"top",storageId:u})};return{loading:T,loadData:V,list:r,addItem:g,deleteItem:s=>{r.value.splice(s,1)},moveUp:s=>{if(s===0)return;const i=r.value[s];r.value.splice(s,1),r.value.splice(s-1,0,i)},moveDown:s=>{if(s===r.value.length-1)return;const i=r.value[s];r.value.splice(s,1),r.value.splice(s+1,0,i)},saveData:E}}const ze={class:"zfile-admin-readme-body"},je={class:"flex justify-between justify-items-center"},Ne={class:"flex justify-items-center cursor-pointer my-auto"},Fe={class:"rules-tips-link"},Ge={target:"_blank",class:"link",href:"http://www.ruanyifeng.com/blog/2018/09/bash-wildcards.html"},Ae={target:"_blank",class:"link",href:"http://www.ruanyifeng.com/blog/2018/09/bash-wildcards.html"},Le={target:"_blank",class:"link",href:"https://github.com/whinc/blog/issues/18"},Oe={class:"save-btn"},N={__name:"[storageId]",props:{storageId:{type:Number,required:!1}},setup(D){const k=X();let u=Z(),V=ee();te(()=>{E(),F()});const{loading:I,loadData:E,list:g,addItem:M,deleteItem:B,moveUp:q,moveDown:s,saveData:i}=qe(V,u),d=w(),F=()=>{ye(u.params.storageId).then(c=>{c.data.type=c.data.type.key,d.value=c.data})},G=()=>{xe(u.params.storageId,d.value.compatibilityReadme).then(c=>{j.success("保存成功")})};let $=w({}),f=w(!1);const A=c=>{f.value=!0,$.value=c};return(c,t)=>{const L=ve,O=oe("router-link"),W=fe,Y=Me,H=_e,J=ce,v=ne,C=Ve,h=pe,K=ue,y=de,P=me,Q=Be;return _(),le(re,null,[l("div",ze,[e(d)?(_(),b(J,{key:0},{title:n(()=>[l("div",je,[l("div",Ne,[a(O,{to:"/admin/storage-list"},{default:n(()=>[a(L,{class:"my-auto h-full mr-2"})]),_:1}),l("span",null,"目录文档（"+ae(e(d).name)+"）",1)]),a(Y,{placement:"top",content:"启用后下发的规则设置会失效，仅会为读取目录下的 readme.md 文件来渲染文档, 且固定在底部显示."},{default:n(()=>[l("div",null,[t[3]||(t[3]=l("span",{class:"mr-4 text-sm text-gray-500"},"兼容为读取 readme.md",-1)),a(W,{onChange:G,"active-text":"是","inline-prompt":"","inactive-text":"否",modelValue:e(d).compatibilityReadme,"onUpdate:modelValue":t[0]||(t[0]=o=>e(d).compatibilityReadme=o)},null,8,["modelValue"])])]),_:1})])]),subTitle:n(()=>[a(H,{closable:!1,type:"info"},{default:n(()=>[t[7]||(t[7]=l("div",{class:"rules-tips"},"Glob 表达式规则：",-1)),t[8]||(t[8]=l("div",{class:"rules-tips"},[l("b",null,"/"),p(": 根目录, 如 "),l("span",{class:"code select-all"},"/"),p(" 表示根路径下会加载此文档显示.")],-1)),t[9]||(t[9]=l("div",{class:"rules-tips"},[l("b",null,"*"),p("：单级路径通配符，如表达式 "),l("span",{class:"code select-all"},"/*"),p(" 表示根路径下的直接子文件夹会加载此文档显示.")],-1)),t[10]||(t[10]=l("div",{class:"rules-tips"},[l("b",null,"**"),p("：多级路径通配符，如表达式 "),l("span",{class:"code select-all"},"/music/**"),p(" 表示 /music 文件夹及以下所有文件夹都会加载此文档.")],-1)),t[11]||(t[11]=l("div",{class:"rules-tips"},"注：系统匹配到第一个符合的规则就会取文档进行显示，所以请调整好规则顺序，下方规则可进行拖拽排序。",-1)),l("div",Fe,[l("a",Ge,[a(e(U),{class:"inline mr-1"}),t[4]||(t[4]=l("span",null,"参考文章 (Wikipedia)",-1))]),l("a",Ae,[a(e(U),{class:"inline mr-1"}),t[5]||(t[5]=p("参考文章 (阮一峰)"))]),l("a",Le,[a(e(U),{class:"inline mr-1"}),t[6]||(t[6]=p("参考文章 (Github)"))])])]),_:1,__:[7,8,9,10,11]})]),_:1})):x("",!0),ie((_(),b(P,{size:e(k).adminTable.size,"row-key":"id",data:e(g)},{default:n(()=>[e(R)?(_(),b(v,{key:0,label:"ID",prop:"id"})):x("",!0),a(v,{label:"描述",prop:"description"},{default:n(o=>[a(C,{"prefix-icon":e($e),placeholder:"请输入表达式描述",modelValue:o.row.description,"onUpdate:modelValue":m=>o.row.description=m},null,8,["prefix-icon","modelValue","onUpdate:modelValue"])]),_:1}),a(v,{label:"表达式",prop:"expression"},{default:n(o=>[a(C,{"prefix-icon":e(Ce),placeholder:"请输入表达式",modelValue:o.row.expression,"onUpdate:modelValue":m=>o.row.expression=m,modelModifiers:{trim:!0}},null,8,["prefix-icon","modelValue","onUpdate:modelValue"])]),_:1}),a(v,{label:"目录文档",prop:"readmeText"},{default:n(o=>[a(C,{onClick:m=>A(o.row),readonly:"","prefix-icon":e(he),placeholder:"请点击编辑文档",modelValue:o.row.readmeText,"onUpdate:modelValue":m=>o.row.readmeText=m},null,8,["onClick","prefix-icon","modelValue","onUpdate:modelValue"])]),_:1}),a(v,{label:"显示位置",width:"120",prop:"displayMode"},{default:n(o=>[a(K,{modelValue:o.row.displayMode,"onUpdate:modelValue":m=>o.row.displayMode=m},{default:n(()=>[a(h,{label:"顶部显示",value:"top"}),a(h,{label:"底部显示",value:"bottom"}),a(h,{label:"弹窗显示",value:"dialog"})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1}),a(v,{align:"center",label:"操作",width:"60px"},{default:n(o=>[e(R)&&o.$index!==0?(_(),b(y,{key:0,type:"primary",onClick:m=>e(q)(o.$index),icon:e(Re)},null,8,["onClick","icon"])):x("",!0),e(R)&&o.$index!==e(g).length-1?(_(),b(y,{key:1,type:"primary",onClick:m=>e(s)(o.$index),icon:e(Se)},null,8,["onClick","icon"])):x("",!0),a(y,{type:"danger",onClick:m=>e(B)(o.$index),icon:e(Ue)},null,8,["onClick","icon"])]),_:1})]),_:1},8,["size","data"])),[[Q,e(I)]]),a(y,{class:"add-more-btn",size:"default",icon:e(Te),onClick:e(M)},{default:n(()=>t[12]||(t[12]=[p("添加更多")])),_:1,__:[12]},8,["icon","onClick"]),l("div",Oe,[a(y,{type:"primary",size:"default",icon:e(De),onClick:e(i)},{default:n(()=>t[13]||(t[13]=[p("保存设置")])),_:1,__:[13]},8,["icon","onClick"])])]),e(f)?(_(),b(we,{key:0,modelValue:e($).readmeText,"onUpdate:modelValue":t[1]||(t[1]=o=>e($).readmeText=o),visible:e(f),"onUpdate:visible":t[2]||(t[2]=o=>se(f)?f.value=o:f=o)},null,8,["modelValue","visible"])):x("",!0)],64)}}};typeof z=="function"&&z(N);const zt=Ee(N,[["__scopeId","data-v-c33744c4"]]);export{zt as default};
