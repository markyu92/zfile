import{a3 as H,r as k,f as e,$ as K,b as a,e as g,w as n,k as o,x as s,a0 as l,y,a2 as C,l as b,g as _,aD as B}from"./index-008199ed.js";/* empty css                *//* empty css                  */import{E as X}from"./button-30635c71.js";/* empty css               *//* empty css                */import{E as G,a as O}from"./input-73d413ba.js";import{_ as q}from"./admin-form-header-819a5389.js";import{t as j}from"./vue3-clipboard.esm-f774ce6a.js";import{u as J,c as Q,t as Y}from"./useAdminSetting-8228330a.js";import{u as h}from"./useClientInfo-4d899306.js";import{b as E}from"./route-block-83d24a4e.js";import{_ as tt}from"./_plugin-vue_export-helper-c27b6911.js";import{r as et}from"./QuestionMarkCircleIcon-492baaf8.js";import{d as M,c as w,E as T,b as st}from"./request-7014ab81.js";import{r as lt}from"./CheckBadgeIcon-af1628c6.js";import{E as ot}from"./index-751f7128.js";import{v as nt}from"./directive-20abcd4b.js";import"./index-4ea0a277.js";import"./_initCloneObject-ffec0ace.js";import"./index-60380bfa.js";import"./dropdown-40114633.js";const it={class:"el-form-item-tips"},at={class:"mt-1"},rt={class:"text-blue-400"},ut={class:"mt-4"},dt={key:0},mt={key:0},pt={class:"text-blue-500"},ct={key:1},ft={class:"el-form-item-tips"},_t={class:"mt-1"},vt={class:"text-blue-400"},It={class:"mt-4"},kt={key:0},gt={key:0},bt={class:"text-blue-500"},yt={key:1},Ut="*Thunder*\nMozilla/5.0 (Linux; Android) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/34.0.1847.131 Safari/537.36\n*Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;*",R={__name:"index",setup(xt){const U=H(),S=k(),{siteSetting:i,saveData:z,saveLoading:D}=J(Q,S),{clientIp:L,userAgent:W}=h(),u=k(""),v=k(null),P=B(()=>{var r;V("springSimple",(r=i.value)==null?void 0:r.accessUaBlocklist,u.value,v)},250),d=k(""),I=k(null),A=B(()=>{var r;V("ip",(r=i.value)==null?void 0:r.accessIpBlocklist,d.value,I)},250),V=(r,t,x,m)=>{let c={ruleType:r,rules:t,testValue:x};if(!(c.rules&&c.testValue)){m.value=null;return}Y(c).then(f=>{m.value=f.data})},N=()=>{j(Ut).then(()=>{i.value.accessUaBlocklist&&(i.value.accessUaBlocklist.endsWith("\n")||(i.value.accessUaBlocklist+="\n")),T.success("复制成功，请粘贴到 UA 黑名单中，然后保存。")}).catch(()=>{T.error("复制失败")})};return(r,t)=>{const x=q,m=st,c=ot,f=G,F=X,Z=O,$=nt;return e(i)?K((a(),g(Z,{key:0,model:e(i),"label-width":e(U).adminForm.labelWidth,"label-position":e(U).adminForm.labelPosition,size:e(U).adminForm.size,class:"z-admin-form"},{default:n(()=>[o(x,{title:"访问控制","sub-title":"此处设置可保护您的站点安全"}),o(f,{label:"IP 黑名单"},{default:n(()=>[o(m,{type:"textarea",onInput:e(A),rows:6,modelValue:e(i).accessIpBlocklist,"onUpdate:modelValue":t[0]||(t[0]=p=>e(i).accessIpBlocklist=p)},null,8,["onInput","modelValue"]),s("div",it,[t[12]||(t[12]=l(" 每行输入一个 IP 或 IP 段，如： ")),t[13]||(t[13]=s("ul",{class:"list-disc ml-4"},[s("li",null,"127.0.0.1"),s("li",null,"192.168.0.0/24"),s("li",null,"支持 IPv6 地址和网段。")],-1)),s("div",at,[t[6]||(t[6]=l(" 注意：检测到你当前 ip 为：")),s("span",rt,y(e(L)),1),t[7]||(t[7]=l("，别把自己 ip 配置进去（ ")),o(c,{placement:"top-start",title:"提示",width:300,trigger:"hover"},{reference:n(()=>[s("span",null,[t[4]||(t[4]=l("这里显示的不是你的 IP 地址？")),o(e(et),{class:"w-4 h-4 inline align-sub"})])]),default:n(()=>t[5]||(t[5]=[l(' 注意：如果你使用了反向代理，而不是直接访问的 ZFile 端口, 那你需要在反向代理处添加以下任意请求头为用户真实 IP："X-Forwarded-For", "X-Real-IP", "Proxy-Client-IP", "WL-Proxy-Client-IP", "HTTP_CLIENT_IP", "HTTP_X_FORWARDED_FOR"，不然不论谁访问 ZFile 都只能获取到反代服务器的 IP，同服务器一般是获取到 127.0.0.1 或 localhost, 这样此功能就无法正常使用!!! ')])),_:1}),t[8]||(t[8]=l(" ）。 "))]),s("div",ut,[t[11]||(t[11]=s("div",null,"可在下方输入你要测试的 IP, 显示绿色表示不会被拦截，红色表示触发了黑名单会被拦截",-1)),o(m,{onInput:e(A),modelValue:e(d),"onUpdate:modelValue":t[1]||(t[1]=p=>C(d)?d.value=p:null)},{suffix:n(()=>[e(d)&&e(I)!==null?(a(),g(e(M),{key:0,class:"error-icon"})):e(d)&&e(I)===null?(a(),g(e(w),{key:1,class:"success-icon"})):b("",!0)]),_:1},8,["onInput","modelValue"]),e(d)?(a(),_("div",dt,[e(I)?(a(),_("div",mt,[t[9]||(t[9]=l(" 输入的测试 IP 匹配了规则: ")),s("span",pt,y(e(I)),1),t[10]||(t[10]=l("，会被禁止访问 ZFile。 "))])):(a(),_("div",ct,"输入的测试 IP 未匹配任何规则, 可以正常访问 ZFile。"))])):b("",!0)])])]),_:1}),o(f,{label:"UA 黑名单"},{default:n(()=>[o(m,{type:"textarea",onInput:e(P),rows:6,modelValue:e(i).accessUaBlocklist,"onUpdate:modelValue":t[2]||(t[2]=p=>e(i).accessUaBlocklist=p)},null,8,["onInput","modelValue"]),s("div",ft,[t[19]||(t[19]=l(" 每行输入一个 UserAgent，支持 * 通配符，如： ")),t[20]||(t[20]=s("ul",{class:"list-disc ml-4"},[s("li",null,"Mozilla/5.0*"),s("li",null,"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/115.0.0.0 Safari/537.36")],-1)),s("div",_t,[t[14]||(t[14]=l("注意：当前浏览器 UserAgent 为：")),s("span",vt,y(e(W)),1),t[15]||(t[15]=l("，别把自己 ua 填到黑名单去。 "))]),s("div",It,[t[18]||(t[18]=s("div",null,"可在下方输入你要测试的 UserAgent, 显示绿色表示不会被拦截，红色表示触发了黑名单会被拦截",-1)),o(m,{onInput:e(P),modelValue:e(u),"onUpdate:modelValue":t[3]||(t[3]=p=>C(u)?u.value=p:null)},{suffix:n(()=>[e(u)&&e(v)!=null?(a(),g(e(M),{key:0,class:"error-icon"})):e(u)&&e(v)===null?(a(),g(e(w),{key:1,class:"success-icon"})):b("",!0)]),_:1},8,["onInput","modelValue"]),e(u)?(a(),_("div",kt,[e(v)?(a(),_("div",gt,[t[16]||(t[16]=l(" 输入的测试 UserAgent 匹配了规则: ")),s("span",bt,y(e(v)),1),t[17]||(t[17]=l("，会被禁止访问 ZFile。 "))])):(a(),_("div",yt,"输入的测试 UserAgent 未匹配任何规则, 可以正常访问 ZFile。"))])):b("",!0)])])]),_:1}),o(f,{label:"快捷操作"},{default:n(()=>[o(c,{placement:"top-start",title:"提示",width:300,trigger:"hover"},{reference:n(()=>[o(F,{type:"primary",onClick:N},{default:n(()=>t[21]||(t[21]=[l("屏蔽迅雷下载")])),_:1,__:[21]})]),default:n(()=>t[22]||(t[22]=[s("div",null,[l("使用迅雷下载，可能会导致服务器CPU和带宽长时间被耗尽，所以这里提供了一键屏蔽迅雷下载的功能，点击按钮即可复制到剪贴板，然后粘贴到 UA 黑名单中"),s("span",{class:"font-bold"},"保存"),l("即可。 ")],-1),s("div",{class:"mt-1"},"tips: 不保证该规则一直有效，迅雷的下载服务可能会更改 UA。",-1)])),_:1})]),_:1}),o(f,{class:"admin-from-footer"},{default:n(()=>[o(F,{class:"ml-auto",type:"primary",icon:e(lt),onClick:e(z)},{default:n(()=>t[23]||(t[23]=[l("保存设置")])),_:1,__:[23]},8,["icon","onClick"])]),_:1})]),_:1},8,["model","label-width","label-position","size"])),[[$,e(D)]]):b("",!0)}}};typeof E=="function"&&E(R);const Gt=tt(R,[["__scopeId","data-v-c939d214"]]);export{Gt as default};
