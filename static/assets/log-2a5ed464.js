import{a3 as me,r as g,o as ue,b as m,g as y,k as t,w as l,x as p,f as e,l as ce,F as fe,G as _e,e as V,y as v,al as ge,am as be,an as he,a0 as b,$ as we,ah as M}from"./index-008199ed.js";/* empty css                */import{E as ye}from"./pagination-27ecf7be.js";/* empty css            */import{E as ve,a as ke}from"./select-275ec4c7.js";/* empty css                  *//* empty css               */import{E as Se,a as ze}from"./input-73d413ba.js";/* empty css                     *//* empty css                 */import"./tooltip-4ed993c7.js";import{E as Ce}from"./popconfirm-dacced9d.js";/* empty css                */import{E as Ve}from"./button-30635c71.js";import{_ as Ee}from"./open-in-new-ca72a0c9.js";import{_ as xe}from"./baseline-content-copy-92f2b234.js";/* empty css                  */import{E as Le}from"./row-5d0d9aad.js";import{E as De,_ as Te}from"./col-abb40228.js";import{_ as Re}from"./admin-form-header-819a5389.js";import{E as Ke}from"./switch-6e3117dc.js";import{t as Ue}from"./vue3-clipboard.esm-f774ce6a.js";import{c as j}from"./path-229a1735.js";import{l as $e}from"./admin-storage-185041e5.js";import{u as Ae,b as Pe,l as qe}from"./useAdminSetting-8228330a.js";import{f as E,E as k,b as Fe}from"./request-7014ab81.js";import{b as G}from"./route-block-83d24a4e.js";import{r as Be}from"./MagnifyingGlassIcon-c7e26493.js";import{r as Ne}from"./ArrowPathIcon-f6c0972c.js";import{r as R}from"./TrashIcon-6780b292.js";import{E as Q}from"./index-c0734d0a.js";import{E as Ie,a as Me}from"./index-91840f01.js";import{E as je}from"./index-60380bfa.js";import{E as Ge}from"./index-dc7d0be4.js";import{v as Qe}from"./directive-20abcd4b.js";import"./index-4ea0a277.js";import"./index-0da14aee.js";import"./strings-535b4609.js";import"./scroll-374ad3fb.js";import"./debounce-3f0c1a7c.js";import"./index-293710b7.js";import"./vnode-5e2fd68e.js";import"./_initCloneObject-ffec0ace.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./dayjs.min-3b74a704.js";import"./index-3c7e69e5.js";import"./validator-38288ad7.js";import"./base-00eb0fe9.js";import"./index-8286893b.js";const Oe=u=>E({url:"/admin/download/log/list",method:"get",data:u}),He=u=>E({url:"/admin/download/log/delete/".concat(u),method:"delete"}),Je=u=>E({url:"/admin/download/log/delete/batch",method:"post",data:u}),We=u=>E({url:"/admin/download/log/delete/batch/query",method:"post",data:u}),Xe={class:"zfile-admin-down-link"},Ye={class:"flex justify-between"},Ze={key:0,class:"flex space-x-1.5 justify-center items-center cursor-pointer"},et={class:"flex justify-between space-x-20"},tt={class:"text-gray-400"},ot={class:"z-admin-table-tools"},at={key:0},lt={key:1},nt={__name:"log",setup(u){const{siteSetting:x,saveData:O}=Ae(Pe);let s=me();const n=g({shortKey:"",linkType:"",storageKey:null,page:1,limit:10,path:"",ip:"",userAgent:"",referer:"",searchDate:[],total:0}),K=g(),H=()=>{K.value.resetFields()},U=g(),h=g(!1),f=()=>{h.value=!0,Oe(n.value).then(r=>{U.value=r.data,n.value.total=r.dataCount}).finally(()=>{h.value=!1})},S=g(),J=()=>{qe().then(r=>{S.value=r.data})},$=g(),W=()=>{$e().then(r=>{$.value=r.data})};ue(()=>{f(),W(),J()});const X=r=>{n.value.limit=r,n.value.page=1,f()},Y=r=>{n.value.page=r,f()},Z=r=>{He(r).then(o=>{k.success("删除成功"),f()})},A=g(),ee=()=>{let r=A.value.getSelectionRows();if(r.length===0){k.warning("请至少选择一条数据");return}Q.confirm("是否确认删除选中的 ".concat(r.length," 条直链下载日志？"),"提示",{type:"warning"}).then(()=>{let o=r.map(z=>z.id);Je({ids:o}).then(z=>{k.success("删除成功"),f()})})},te=()=>{Q.confirm("是否确认删除当前查询条件下的 ".concat(n.value.total," 条直链下载日志？(如数量不对，请先点击查询后再用该功能按条件删除)"),"提示",{type:"warning"}).then(()=>{We(getSearchParam().value).then(r=>{k.success("清空成功"),f()})})};let P=r=>{Ue(r).then(()=>{k.success("复制成功")})},q=r=>{window.open(r)},L=r=>j(s.serverAddress,"s",r),D=r=>{var o;return j(s.serverAddress,(o=S==null?void 0:S.value)==null?void 0:o.directLinkPrefix,r.storageKey,r.path)};return(r,o)=>{const z=Ke,oe=Re,T=ve,F=ke,c=Se,d=De,w=Fe,ae=Te,C=Ve,le=Le,ne=ze,i=Ie,re=je,B=Ge,N=xe,I=Ee,se=Ce,ie=Me,pe=ye,de=Qe;return m(),y("div",Xe,[t(oe,{"hide-bottom-border":"","sub-title":"这里只记录用户通过直链/短链下载的记录，不包括文件预览，下载失败(超出访问次数，超出访问时间，无权限等)"},{title:l(()=>[p("div",Ye,[o[11]||(o[11]=p("span",null,"下载日志",-1)),e(x)?(m(),y("div",Ze,[o[10]||(o[10]=p("span",{class:"text-gray-400 text-sm font-bold"},"记录下载日志：",-1)),t(z,{modelValue:e(x).recordDownloadLog,"onUpdate:modelValue":o[0]||(o[0]=a=>e(x).recordDownloadLog=a),"active-text":"是","inactive-text":"否","inline-prompt":"",onChange:e(O)},null,8,["modelValue","onChange"])])):ce("",!0)])]),_:1}),t(ne,{inline:"",class:"z-admin-search-from",size:e(s).adminSearch.size,"label-width":"100",ref_key:"searchFormRef",ref:K,"label-position":e(s).adminSearch.labelPosition,model:e(n)},{default:l(()=>[t(le,{class:"z-admin-search-from-row",gutter:20},{default:l(()=>[t(d,{span:e(s).adminSearch.spanSize},{default:l(()=>[t(c,{label:"存储源",prop:"storageKey"},{default:l(()=>[t(F,{clearable:"",modelValue:e(n).storageKey,"onUpdate:modelValue":o[1]||(o[1]=a=>e(n).storageKey=a),placeholder:"请选择存储源"},{default:l(()=>[(m(!0),y(fe,null,_e(e($),a=>(m(),V(T,{key:a.id,label:a.name,value:a.key},{default:l(()=>[p("div",et,[p("span",null,v(a.name),1),p("span",tt,v(a.type.description),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["span"]),t(d,{span:e(s).adminSearch.spanSize},{default:l(()=>[t(c,{label:"下载类型",prop:"linkType"},{default:l(()=>[t(F,{clearable:"",modelValue:e(n).linkType,"onUpdate:modelValue":o[2]||(o[2]=a=>e(n).linkType=a),placeholder:"请选择下载类型"},{default:l(()=>[t(T,{label:"直链",value:"directLink"}),t(T,{label:"短链",value:"shortLink"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["span"]),t(d,{span:e(s).adminSearch.spanSize},{default:l(()=>[t(c,{label:"短链 Key",prop:"shortKey"},{default:l(()=>[t(w,{clearable:"",modelValue:e(n).shortKey,"onUpdate:modelValue":o[3]||(o[3]=a=>e(n).shortKey=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["span"]),t(d,{span:e(s).adminSearch.spanSize},{default:l(()=>[t(c,{label:"文件路径",prop:"path"},{default:l(()=>[t(w,{clearable:"",modelValue:e(n).path,"onUpdate:modelValue":o[4]||(o[4]=a=>e(n).path=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["span"]),t(d,{span:e(s).adminSearch.spanSize},{default:l(()=>[t(c,{label:"请求 IP",prop:"ip"},{default:l(()=>[t(w,{clearable:"",modelValue:e(n).ip,"onUpdate:modelValue":o[5]||(o[5]=a=>e(n).ip=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["span"]),t(d,{span:e(s).adminSearch.spanSize},{default:l(()=>[t(c,{label:"UserAgent",prop:"userAgent"},{default:l(()=>[t(w,{clearable:"",modelValue:e(n).userAgent,"onUpdate:modelValue":o[6]||(o[6]=a=>e(n).userAgent=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["span"]),t(d,{span:e(s).adminSearch.spanSize},{default:l(()=>[t(c,{label:"Referer",prop:"referer"},{default:l(()=>[t(w,{clearable:"",modelValue:e(n).referer,"onUpdate:modelValue":o[7]||(o[7]=a=>e(n).referer=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["span"]),t(d,{span:e(s).adminSearch.spanSize},{default:l(()=>[t(c,{label:"下载时间",prop:"searchDate"},{default:l(()=>[t(ae,{class:"w-full",shortcuts:e(ge),modelValue:e(n).searchDate,"onUpdate:modelValue":o[8]||(o[8]=a=>e(n).searchDate=a),type:"daterange","value-format":e(be),"default-time":e(he),"range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间"},null,8,["shortcuts","modelValue","value-format","default-time"])]),_:1})]),_:1},8,["span"]),t(d,{span:e(s).adminSearch.spanSize},{default:l(()=>[t(C,{type:"primary",icon:e(Be),loading:e(h),onClick:f},{default:l(()=>o[12]||(o[12]=[b(" 查询 ")])),_:1,__:[12]},8,["icon","loading"]),t(C,{icon:e(Ne),loading:e(h),onClick:H},{default:l(()=>o[13]||(o[13]=[b("重置")])),_:1,__:[13]},8,["icon","loading"])]),_:1},8,["span"])]),_:1})]),_:1},8,["size","label-position","model"]),p("div",ot,[t(C,{size:e(s).adminTable.size,onClick:ee,icon:e(R),type:"danger"},{default:l(()=>o[14]||(o[14]=[b("批量删除选中 ")])),_:1,__:[14]},8,["size","icon"]),t(C,{size:e(s).adminTable.size,onClick:te,icon:e(R),type:"danger"},{default:l(()=>o[15]||(o[15]=[b("删除全部页 ")])),_:1,__:[15]},8,["size","icon"])]),we((m(),V(ie,{border:"",data:e(U),size:e(s).adminTable.size,ref_key:"tableRef",ref:A},{default:l(()=>[t(i,{type:"selection",width:"55"}),t(i,{align:"center",fixed:e(M),width:"120",label:"存储源名称"},{default:l(a=>{var _;return[t(re,{content:(_=a.row.storageType)==null?void 0:_.description,placement:"right"},{default:l(()=>[p("span",null,v(a.row.storageName),1)]),_:2},1032,["content"])]}),_:1},8,["fixed"]),t(i,{fixed:e(M),width:"90",align:"center",label:"下载类型"},{default:l(a=>[a.row.shortKey?(m(),V(B,{key:0,type:"success"},{default:l(()=>o[16]||(o[16]=[b("短链")])),_:1,__:[16]})):(m(),V(B,{key:1},{default:l(()=>o[17]||(o[17]=[b("直链")])),_:1,__:[17]}))]),_:1},8,["fixed"]),t(i,{"min-width":"400","show-overflow-tooltip":"",prop:"shortKey",label:"下载链接"},{default:l(a=>[a.row.shortKey?(m(),y("div",at,[p("span",null,v(e(L)(a.row.shortKey)),1),t(N,{onClick:_=>e(P)(e(L)(a.row.shortKey)),class:"ml-2 inline cursor-pointer"},null,8,["onClick"]),t(I,{onClick:_=>e(q)(e(L)(a.row.shortKey)),class:"ml-1 inline cursor-pointer text-blue-500 text-sm"},null,8,["onClick"])])):(m(),y("div",lt,[p("span",null,v(e(D)(a.row)),1),t(N,{onClick:_=>e(P)(e(D)(a.row)),class:"ml-2 inline cursor-pointer"},null,8,["onClick"]),t(I,{onClick:_=>e(q)(e(D)(a.row)),class:"ml-1 inline cursor-pointer text-blue-500 text-sm"},null,8,["onClick"])]))]),_:1}),t(i,{width:"300","show-overflow-tooltip":"",prop:"path",label:"文件路径"}),t(i,{width:"100","show-overflow-tooltip":"",prop:"ip",label:"请求 IP"}),t(i,{width:"250","show-overflow-tooltip":"",prop:"userAgent",label:"UserAgent"}),t(i,{width:"200","show-overflow-tooltip":"",prop:"referer",label:"Referer"}),t(i,{width:"170",prop:"createTime",label:"下载时间"}),t(i,{fixed:"right",align:"center",width:"80",label:"操作"},{default:l(a=>[t(se,{title:"是否确认删除?",onConfirm:_=>Z(a.row.id)},{reference:l(()=>[t(e(R),{class:"z-btn-danger"})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data","size"])),[[de,e(h)]]),t(pe,{class:"mt-3","page-size":e(n).limit,background:"",layout:e(s).adminTable.pager.layout,size:e(s).adminTable.pager.size,"pager-count":e(s).adminTable.pager.pagerCount,onCurrentChange:Y,onSizeChange:X,"current-page":e(n).page,"onUpdate:currentPage":o[9]||(o[9]=a=>e(n).page=a),"default-current-page":10,"page-sizes":[10,50,100,200,1e3,99999999],total:e(n).total},null,8,["page-size","layout","size","pager-count","current-page","total"])])}}};typeof G=="function"&&G(nt);export{nt as default};
