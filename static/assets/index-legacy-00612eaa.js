!function(){function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var l=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=l){var n,r,a,o,i=[],u=!0,c=!1;try{if(a=(l=l.call(e)).next,0===t){if(Object(l)!==l)return;u=!1}else for(;!(u=(n=a.call(l)).done)&&(i.push(n.value),i.length!==t);u=!0);}catch(e){c=!0,r=e}finally{try{if(!u&&null!=l.return&&(o=l.return(),Object(o)!==o))return}finally{if(c)throw r}}return i}}(e,t)||l(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){if(e){if("string"==typeof e)return n(e,t);var l={}.toString.call(e).slice(8,-1);return"Object"===l&&e.constructor&&(l=e.constructor.name),"Map"===l||"Set"===l?Array.from(e):"Arguments"===l||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l)?n(e,t):void 0}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var l=0,n=Array(t);l<t;l++)n[l]=e[l];return n}function r(e,t){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),l.push.apply(l,n)}return l}function a(e){for(var t=1;t<arguments.length;t++){var l=null!=arguments[t]?arguments[t]:{};t%2?r(Object(l),!0).forEach((function(t){o(e,t,l[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):r(Object(l)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(l,t))}))}return e}function o(t,l,n){return(l=function(t){var l=function(t,l){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,l||"default");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===l?String:Number)(t)}(t,"string");return"symbol"==e(l)?l:l+""}(l))in t?Object.defineProperty(t,l,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[l]=n,t}System.register(["./index-legacy-e574cec8.js","./form-item-legacy-de8da7e8.js","./button-legacy-f53896dd.js","./baseline-content-copy-legacy-4d694d8f.js","./drawer-legacy-6dac5a3a.js","./overlay-legacy-6ebb9437.js","./input-legacy-bc871eba.js","./input-number-legacy-c1d86df3.js","./checkbox-group-legacy-8d8ae0d6.js","./checkbox-legacy-80a8805e.js","./table-column-legacy-0040b455.js","./tooltip-legacy-518b8698.js","./popper-legacy-ef8fd66b.js","./scrollbar-legacy-0817fabf.js","./rename-outline-legacy-34ada7a7.js","./tag-legacy-5e0686c8.js","./TrashIcon-legacy-3360f913.js","./CheckBadgeIcon-legacy-a01a5b9d.js","./index-legacy-1ae34dc2.js","./index-legacy-69b9ad2b.js","./request-legacy-61b983ae.js","./popover-legacy-fa927888.js","./link-legacy-fb8bdfde.js","./switch-legacy-a4b2d82c.js","./select-legacy-8b64fa67.js","./Cancel-legacy-ab83e01a.js","./admin-storage-legacy-6381f83d.js","./vue3-clipboard.esm-legacy-e37b8e98.js","./base-legacy-173045dc.js","./path-legacy-63087d21.js","./route-block-legacy-509c7347.js","./_plugin-vue_export-helper-legacy-8fcf0e06.js","./LinkIcon-legacy-ec966939.js","./index-legacy-47a1148a.js","./index-legacy-183af9d3.js","./index-legacy-32709ede.js","./index-legacy-c317e588.js","./index-legacy-b5baaeae.js","./vnode-legacy-bdad68af.js","./scroll-legacy-68db505b.js","./_initCloneObject-legacy-b35b9836.js","./index-legacy-e86b74e4.js","./index-legacy-ea3d196e.js","./index-legacy-d493f4b0.js","./debounce-legacy-321ba92e.js","./validator-legacy-a3ca6880.js","./strings-legacy-b2510e8b.js","./admin-form-header-legacy-5b0f136c.js","./arrow-left-legacy-eb9efd7f.js","./dropdown-legacy-648534c2.js"],(function(e,n){"use strict";var r,o,i,u,c,s,d,f,m,p,y,g,v,h,b,w,k,S,_,P,A,V,x,j,U,O,E,I,T,C,H,z,M,L,F,N,D,R,q,K,B,G,W,Z,$,Y,Q,X,J,ee,te,le,ne,re,ae,oe,ie,ue,ce,se,de;return{setters:[function(e){r=e.a3,o=e.B,i=e.r,u=e.c,c=e.b,s=e.g,d=e.k,f=e.w,m=e.a0,p=e.$,y=e.a1,g=e.f,v=e.x,h=e.y,b=e.F,w=e.G,k=e.aj,S=e._,_=e.Y,P=e.e,A=e.ah,V=e.W,x=e.a8,j=e.l,U=e.o},null,function(e){O=e.E},function(e){E=e._},function(e){I=e.E},null,function(e){T=e.E,C=e.a},function(e){H=e.E},null,null,null,null,null,null,function(e){z=e._},null,function(e){M=e.r},function(e){L=e.r},function(e){F=e.E},function(e){N=e.E,D=e.a},function(e){R=e.b,q=e.e,K=e.t,B=e.f,G=e.E},null,function(e){W=e.E},function(e){Z=e.E},function(e){$=e.E,Y=e.a},function(e){Q=e._},function(e){X=e.g,J=e.h,ee=e.e,te=e.i,le=e.j},function(e){ne=e.t},function(e){re=e.c},function(e){ae=e.c},function(e){oe=e.b},function(e){ie=e._},function(e){ue=e.r},function(e){ce=e.E},function(e){se=e.E},function(e){de=e.E},null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){var n=document.createElement("style");n.textContent=".zfile-cors-wrapper{width:100%}.zfile-cors-drawer-wrapper{min-width:400px}.zfile-cors-drawer-wrapper .el-drawer__header{margin-bottom:0;border-bottom-width:1px;padding-bottom:1rem}.zfile-cors-drawer-wrapper .el-drawer__header .el-drawer__title{font-weight:700;--tw-text-opacity: 1;color:rgb(0 0 0 / var(--tw-text-opacity, 1))}.zfile-cors-drawer-wrapper .z-admin-form{padding:1rem}.zfile-cors-drawer-wrapper .el-drawer__body{padding:0}.zfile-cors-drawer-wrapper .el-drawer__body .el-form .el-form-item-tips{font-size:.75rem;line-height:1rem}.zfile-storage-edit[data-v-46fd4c99] .el-form-item-input>.el-select{width:100%}\n",document.head.appendChild(n);var fe={class:"zfile-cors-wrapper"},me={class:"space-x-2"},pe={class:"el-form-item-tips"},ye={class:"list-disc ml-4"},ge={class:"select-all"},ve={__name:"Cors",props:{modelValue:{type:Object,required:!0}},emits:["update:modelValue"],setup:function(e,t){var l=t.emit,n=r(),S=e,_=l,P=function(e){_("update:modelValue",e)};o((function(){return S.modelValue}),(function(e){A.value=e}));var A=i(S.modelValue||[]);A.value.forEach((function(e,t){e.id||(e.id=Date.now()+t),e.allowedOrigins||(e.allowedOrigins=[]),e.allowedMethods||(e.allowedMethods=[]),e.allowedHeaders||(e.allowedHeaders=[]),e.exposeHeaders||(e.exposeHeaders=[]),e.maxAgeSeconds||(e.maxAgeSeconds=0)}));var V=i(!1),x=i({allowedOrigins:"",allowedMethods:["GET","PUT"],allowedHeaders:"",exposeHeaders:"",maxAgeSeconds:0}),j=["GET","POST","PUT","DELETE","HEAD"];function U(e,t){x.value="edit"===e&&t?a(a({},t),{},{allowedOriginsStr:t.allowedOrigins.join("\n").trim(),allowedHeadersStr:t.allowedHeaders?t.allowedHeaders.join("\n").trim():"",exposeHeadersStr:t.exposeHeaders?t.exposeHeaders.join("\n").trim():""}):{allowedOriginsStr:"",allowedMethods:["GET","PUT"],allowedHeadersStr:"content-type",exposeHeadersStr:"",maxAgeSeconds:0},V.value=!0}function E(){B.value.validate((function(e){if(e){var t=a(a({},x.value),{},{allowedOrigins:x.value.allowedOriginsStr.split("\n").filter((function(e){return e.trim()})),allowedHeaders:x.value.allowedHeadersStr.split("\n").filter((function(e){return e.trim()})),exposeHeaders:x.value.exposeHeadersStr.split("\n").filter((function(e){return e.trim()}))});if(t.id){var l=A.value.findIndex((function(e){return e.id===t.id}));A.value[l]=t}else A.value.push(a(a({},t),{},{id:Date.now()}));V.value=!1,P(A.value)}}))}var B=i(null),G={allowedOriginsStr:[{required:!0,message:"请输入允许来源",trigger:"blur"}],allowedMethods:[{type:"array",required:!0,message:"请选择允许方法",trigger:"change"}]},W=window.location.origin,Z=u((function(){return A.value.some((function(e){return e.allowedOrigins.includes(W)&&e.allowedMethods.includes("GET")&&e.allowedMethods.includes("PUT")}))})),$=function(){Z.value||(A.value.push({id:Date.now(),allowedOrigins:[W],allowedMethods:["GET","PUT"],allowedHeaders:["content-type"],exposeHeaders:[],maxAgeSeconds:0}),P(A.value))};return function(e,t){var l=O,r=F,a=N,o=z,i=D,u=R,S=T,_=q,Y=K,Q=H,X=C,J=I;return c(),s("div",fe,[d(l,{onClick:t[0]||(t[0]=function(e){return U("add",null)}),type:"primary"},{default:f((function(){return t[8]||(t[8]=[m("新增配置")])})),_:1,__:[8]}),d(r,{content:"检测到当前跨域配置异常，可能会影响在线预览、上传等功能，请点击添加推荐配置",placement:"top"},{default:f((function(){return[p(d(l,{onClick:$,type:"success"},{default:f((function(){return t[9]||(t[9]=[m("添加推荐配置")])})),_:1,__:[9]},512),[[y,!g(Z)]])]})),_:1}),d(i,{data:A.value,width:"100%"},{default:f((function(){return[d(a,{prop:"allowedOrigins",label:"允许来源","show-overflow-tooltip":""}),d(a,{prop:"allowedMethods",label:"允许Method","show-overflow-tooltip":""}),d(a,{prop:"allowedHeaders",label:"允许Headers","show-overflow-tooltip":""}),d(a,{prop:"exposeHeaders",label:"暴露Headers","show-overflow-tooltip":""}),d(a,{prop:"maxAgeSeconds",width:"110",label:"缓存时间(秒)","show-overflow-tooltip":""}),d(a,{label:"操作",align:"center","min-width":"60px"},{default:f((function(e){var t=e.row;return[v("div",me,[d(o,{class:"z-btn-primary",onClick:function(e){return U("edit",t)}},null,8,["onClick"]),d(g(M),{class:"z-btn-danger",onClick:function(e){return l=t,A.value=A.value.filter((function(e){return e!==l})),void P(A.value);var l}},null,8,["onClick"])])]})),_:1})]})),_:1},8,["data"]),d(J,{class:"zfile-cors-drawer-wrapper",modelValue:V.value,"onUpdate:modelValue":t[7]||(t[7]=function(e){return V.value=e}),"append-to-body":"",title:"跨域规则配置","destroy-on-close":!0,"close-on-click-modal":!1,size:g(k)?"80%":"30%"},{header:f((function(){return t[10]||(t[10]=[v("div",{class:"zfile-cors-drawer-title"},[v("div",{class:"mr-2"},"跨域规则配置"),v("a",{target:"_blank",class:"text-xs my-auto link",type:"success",href:"https://docs.aws.amazon.com/zh_cn/AmazonS3/latest/userguide/ManageCorsUsing.html"}," 参考文档 ")],-1)])})),default:f((function(){return[d(X,{model:x.value,"label-width":g(n).adminForm.labelWidth,"label-position":g(n).adminForm.labelPosition,size:g(n).adminForm.size,"status-icon":"",class:"z-admin-form",ref_key:"corsFormRef",ref:B,rules:G},{default:f((function(){return[d(S,{label:"来源",prop:"allowedOriginsStr"},{default:f((function(){return[d(u,{modelValue:x.value.allowedOriginsStr,"onUpdate:modelValue":t[1]||(t[1]=function(e){return x.value.allowedOriginsStr=e}),type:"textarea",placeholder:"请输入允许来源，如 https://xxx.com 或 http://192.168.0.1",autosize:{minRows:3,maxRows:6}},null,8,["modelValue"]),v("div",pe,[v("ul",ye,[t[12]||(t[12]=v("li",null,"来源可以设置多个，每行一个，每行最多能有一个通配符 *，每行前后不要后空格，最后不要加 /",-1)),t[13]||(t[13]=v("li",null,"如你有多个地址/域名访问该 ZFile 服务(如家里服务器搭建，有内网，也有公网)都要配置到这里，不然可能会影响上传、下载、预览功能，后续增加其他地址访问时，记得更新这里。更详细的配置请参考存储源官方提供的文档。",-1)),v("li",null,[t[11]||(t[11]=m("当前环境推荐配置: ")),v("span",ge,h(g(W)),1)])])])]})),_:1}),d(S,{label:"允许方法",prop:"allowedMethods"},{default:f((function(){return[d(Y,{modelValue:x.value.allowedMethods,"onUpdate:modelValue":t[2]||(t[2]=function(e){return x.value.allowedMethods=e})},{default:f((function(){return[(c(),s(b,null,w(j,(function(e){return d(_,{key:e,value:e},{default:f((function(){return[m(h(e),1)]})),_:2},1032,["value"])})),64))]})),_:1},8,["modelValue"]),t[14]||(t[14]=v("div",{class:"el-form-item-tips"}," ZFile 需要用 GET 和 PUT 方法，其他方法请根据需求添加。 ",-1))]})),_:1,__:[14]}),d(S,{label:"允许 Headers",prop:"allowedHeadersStr"},{default:f((function(){return[d(u,{modelValue:x.value.allowedHeadersStr,"onUpdate:modelValue":t[3]||(t[3]=function(e){return x.value.allowedHeadersStr=e}),type:"textarea",placeholder:"请输入允许Headers",autosize:{minRows:3,maxRows:6}},null,8,["modelValue"]),t[15]||(t[15]=v("div",{class:"el-form-item-tips"},[m(" 允许 Headers 可以设置多个，每行一个，每行最多能有一个通配符 *。 "),v("br"),m(" ZFile 当前版本需要用 "),v("span",{class:"select-all"},"content-type"),m("，其他的根据需求添加。 ")],-1))]})),_:1,__:[15]}),d(S,{label:"暴露 Headers",prop:"exposeHeadersStr"},{default:f((function(){return[d(u,{modelValue:x.value.exposeHeadersStr,"onUpdate:modelValue":t[4]||(t[4]=function(e){return x.value.exposeHeadersStr=e}),type:"textarea",placeholder:"请输入暴露Headers",autosize:{minRows:3,maxRows:6}},null,8,["modelValue"]),t[16]||(t[16]=v("div",{class:"el-form-item-tips"}," 暴露 Headers 可以设置多个，每行一个，不允许出现通配符 *，一般 ZFile 中使用不需要设置。 ",-1))]})),_:1,__:[16]}),d(S,{label:"缓存时间（秒）",prop:"maxAgeSeconds"},{default:f((function(){return[d(Q,{modelValue:x.value.maxAgeSeconds,"onUpdate:modelValue":t[5]||(t[5]=function(e){return x.value.maxAgeSeconds=e}),min:0,label:"缓存时间（秒）",step:1,"step-strictly":""},null,8,["modelValue"]),t[17]||(t[17]=v("div",{class:"el-form-item-tips"}," 指定在 S3 针对特定资源的预检 OPTIONS 请求作出响应后，浏览器缓存该响应的时间（以秒为单位）。通过缓存响应，在需要重复原始请求时，浏览器无需向 S3 发送预检请求。 ",-1))]})),_:1,__:[17]}),d(S,{"label-width":g(n).adminForm.labelWidth,class:"admin-from-footer"},{default:f((function(){return[d(l,{type:"primary",icon:g(L),onClick:E},{default:f((function(){return t[18]||(t[18]=[m("保存设置")])})),_:1,__:[18]},8,["icon"]),d(l,{onClick:t[6]||(t[6]=function(e){return V.value=!1})},{default:f((function(){return t[19]||(t[19]=[m("取消")])})),_:1,__:[19]})]})),_:1},8,["label-width"])]})),_:1},8,["model","label-width","label-position","size"])]})),_:1},8,["modelValue","size"])])}}},he={class:"el-form-item-tips"},be={style:{float:"left"}},we={style:{float:"right",color:"#8492a6","font-size":"13px"}},ke={style:{float:"left"}},Se={style:{float:"left"}},_e={class:"float-right"},Pe={class:"float-left"},Ae={class:"float-left"},Ve={class:"float-right"},xe={key:5,class:"w-full"},je=["innerHTML"],Ue={key:10},Oe={class:"el-form-item-tips"},Ee={key:0},Ie={key:0,class:"flex items-center"},Te=["innerHTML"],Ce={key:2,class:"font-bold"},He={class:"text-red-500"},ze={key:3},Me={key:4},Le={key:5},Fe={__name:"index",setup:function(e){var n=r(),k=S(),I=_(),H=null,z=i(),M=function(){z.value.validate((function(e){if(!e)return G.warning("表单验证失败, 请检查表单数据是否填写正确"),!1;q.value=!0,X(N.value).then((function(e){oe.value=!0,ce.confirm("保存成功, 是否前往用户管理配置权限（不配置将无法访问该存储源）？","提示",{confirmButtonText:"前往用户管理设置",cancelButtonText:"返回存储源列表",closeOnClickModal:!1,closeOnPressEscape:!1,showClose:!1,type:"success",callback:function(e){"confirm"===e?k.push("/admin/user-list"):k.push("/admin/storage-list")}})})).finally((function(){q.value=!1}))}))},F=function(){var e=i({orderNum:null,name:"",type:"",remark:"",alias:"",defaultSwitchToImgMode:!1,enable:!0,enableFileOperator:!0,enableFileAnnoOperator:!1,enableCache:!1,autoRefreshCache:!1,storageSourceAllParam:{endPoint:"",pathStyle:"",isPrivate:!1,accessKey:null,secretKey:null,bucketName:null,host:null,port:null,filePath:null,accessToken:null,refreshToken:null,secretId:null,username:null,password:null,privateKey:null,passphrase:null,basePath:"",domain:"",listId:"",redirectUri:"",siteId:"",proxyDomain:"",downloadLinkType:"",clientId:"",clientSecret:"",region:"",autoConfigCors:!1,driveId:""}}),t=i(!1),l=i([]);U((function(){J().then((function(e){l.value=e.data}));var n=I.params.storageId;n&&(t.value=!0,function(t){le(t).then((function(t){t.data.type=t.data.type.key,e.value=t.data,H=t.data.key}))}(n))}));var n=i(!1),r=i({name:[{required:!0,message:"请输入存储源名称"}],key:[{validator:function(e,t,l){if(null!=t&&""!==t)if(x.systemNames.includes(t))l(new Error("不可占用系统级名称，请修改。"));else{/^[\w\-]+$/.test(t)?H!==t?ee({storageKey:t}).then((function(e){e.data?l(new Error("该存储源别名已存在，请修改。")):l()})):l():l(new Error("只允许使用字母、数字、下划线、横杠。"))}else l()}}],type:[{required:!0,message:"存储策略不能为空"}],"storageSourceAllParam.url":[{type:"url",message:"请输入正确的地址，需以 http:// 或 https:// 开头"}],"storageSourceAllParam.domain":[{type:"url",message:"请输入正确的域名，需以 http:// 或 https:// 开头"},{validator:function(e,t,l){null!=t&&""!==t?"https:"!==window.location.protocol||0!==t.indexOf("http://")?l():l(new Error("检测到当前 ZFile 站点是 https 协议, 受浏览器限制, 此处也必须是 https 协议, 否则可能无法正常使用.")):l()}}],"storageSourceAllParam.endPointScheme":[{validator:function(e,t,l){null!=t&&""!==t?"https:"!==window.location.protocol||"http"!==t?l():l(new Error("检测到当前 ZFile 站点是 https 协议, 受浏览器限制, 此处也必须是 https 协议, 否则可能无法正常使用.")):l()}}],"storageSourceAllParam.filePath":[{validator:function(e,t,l){if(null!=t&&""!==t){var n=/^\/.*/.test(t),r=/^[a-zA-Z]+:.*/.test(t);console.log(n,r),n||r?l():l(new Error("本地存储路径必须是绝对路径，Linux 以 / 开头，Windows 以盘符开头"))}else l(new Error("本地存储路径不能为空"))}}],"storageSourceAllParam.bucketName":[{required:!0,message:"请选择存储器列表"}]});return{storageItem:e,supportStorageType:l,loading:n,rules:r,isEditMode:t}}(),N=F.storageItem,D=F.supportStorageType,q=F.loading,K=F.rules,oe=F.isEditMode,ie=function(){var e=i([]),t=i(""),l=u((function(){return{accessKey:N.value.storageSourceAllParam.accessKey||N.value.storageSourceAllParam.secretId,secretKey:N.value.storageSourceAllParam.secretKey,endPoint:N.value.storageSourceAllParam.endPoint,region:N.value.storageSourceAllParam.region,bucketName:N.value.storageSourceAllParam.bucketName}}));o((function(){return l.value}),(function(e){x.storageType.s3Type.includes(N.value.type)&&e.accessKey&&e.secretKey&&e.endPoint&&(n(e),e.bucketName&&r(e))}));var n=function(t){var l;(l=t,B({url:"/s3/getBuckets",method:"post",data:l,config:{showDefaultMsg:!1}})).then((function(t){e.value=t.data})).catch((function(t){e.value=[]}))},r=function(e){var l;(l=e,B({url:"/s3/getCorsConfig",method:"post",data:l,config:{showDefaultMsg:!1}})).then((function(e){N.value.storageSourceAllParam.corsConfigList=e.data,t.value="以上是自动获取到的跨域配置，如未正确配置跨域，可能会导致在线预览和上传失败。"})).catch((function(e){t.value="自动获取跨域配置失败，可能是存储源不支持/无需跨域配置，或者没有权限获取跨域配置或其他原因。<br>报错信息："+e.response.data.msg}))};return{bucketList:e,corsTips:t}}(),fe=ie.bucketList,me=ie.corsTips,pe=function(){var e=i([]),t=u((function(){return{accessToken:N.value.storageSourceAllParam.accessToken}}));o((function(){return t.value}),(function(e){"google-drive"===N.value.type&&l(e)}));var l=function(t){var l;(l=t,B({url:"/gd/drives",method:"post",data:l,config:{showDefaultMsg:!1}})).then((function(t){e.value=t.data})).catch((function(t){e.value=[]}))};return{drivesList:e}}(),ye=pe.drivesList,ge=function(){var e=i([]),t=i([]),l=function(e){return-1!==e.indexOf("sharepoint")},n=function(e){return"sharepoint"===e?"Standard":"China"};o((function(){return N.value.storageSourceAllParam.accessToken}),(function(e){e&&r()}));var r=function(){var t,r=N.value.type;if(l(r)){var a={type:n(r),accessToken:N.value.storageSourceAllParam.accessToken};(t=a,B({url:"/sharepoint/getSites",method:"post",data:t})).then((function(t){e.value=t.data}))}};o((function(){return N.value.storageSourceAllParam.siteId}),(function(e){e&&a()}));var a=function(){var e,r=N.value.type;if(l(r)){var a={type:n(r),accessToken:N.value.storageSourceAllParam.accessToken,siteId:N.value.storageSourceAllParam.siteId};(e=a,B({url:"/sharepoint/getSiteLists",method:"post",data:e})).then((function(e){t.value=e.data}))}};return{sharepointSites:e,sharepointSiteLists:t,isSharePoint:l}}(),Fe=ge.sharepointSites,Ne=ge.sharepointSiteLists,De=ge.isSharePoint,Re=function(){o((function(){return N.value.type}),(function(e){r(e)}));var e=i([]),n=i({}),r=function(r){r&&te({storageType:r}).then((function(r){e.value=r.data;var a,o=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=l(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){u=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(u)throw o}}}}(e.value);try{var i=function(){var e=a.value;!oe.value&&e.defaultValue?(e.defaultValue=re(e.defaultValue),N.value.storageSourceAllParam[e.key]=e.defaultValue):"redirectUri"!==e.key||N.value.storageSourceAllParam[e.key]||(N.value.storageSourceAllParam[e.key]=e.defaultValue),""===e.condition?n.value[e.key]=!0:n.value[e.key]=u((function(){var l=function(e){var l;-1!==e.indexOf("==")?l="==":-1!==e.indexOf("!=")?l="!=":alert("不支持的表达式 ".concat(e));var r=t(e.split(l),2);return function(e,t,l){var r=e.endsWith("?");return r&&(e=e.replace("?","")),!(!r&&!1===n.value[e])&&(t=re(t),"=="===l?N.value.storageSourceAllParam[e]===t:"!="!==l||N.value.storageSourceAllParam[e]!==t)}(r[0],r[1],l)},r=e.condition;return-1!==r.indexOf("||")?r.split("||").some((function(e){return l(e)})):-1!==r.indexOf("&&")?r.split("&&").every((function(e){return l(e)})):l(r)}))};for(o.s();!(a=o.n()).done;)i()}catch(c){o.e(c)}finally{o.f()}}))};return{storageSourceParamList:e,fieldShowMap:n}}(),qe=Re.storageSourceParamList,Ke=Re.fieldShowMap;o((function(){return qe.value}),(function(e){e&&(K.value=a(a({},K.value),e.reduce((function(e,t){return t.required&&(e["storageSourceAllParam.".concat(t.key)]=[{required:!0,message:"".concat(t.name,"不能为空")}]),e}),{})))}));var Be=function(e){ne(e).then((function(){G.success("复制成功")}))},Ge=u((function(){return"https:"===window.location.protocol&&0===N.value.storageSourceAllParam.domain.indexOf("http://")})),We=["endPoint","accessKey","secretKey","accessToken","refreshToken","secretId","clientId","clientSecret"];return function(e,t){var l=Q,r=R,a=T,o=$,i=Y,u=Z,k=se,S=W,_=de,U=ve,I=E,H=O,F=C;return c(),P(F,{model:g(N),"label-width":g(n).adminForm.labelWidth,"label-position":g(n).adminForm.labelPosition,size:g(n).adminForm.size,"scroll-to-error":"","status-icon":"",class:"zfile-storage-edit z-admin-form",rules:g(K),ref_key:"storageEditForm",ref:z},{default:f((function(){return[d(l,{title:"存储源信息",to:"/admin/storage-list"},{default:f((function(){return t[15]||(t[15]=[m(" 请维护您的存储源信息，可参考 "),v("a",{class:"link",target:"_blank",href:"https://docs.zfile.vip/category/%E5%AD%98%E5%82%A8%E6%BA%90%E7%A4%BA%E4%BE%8B%E9%85%8D%E7%BD%AE"},"ZFile 存储源配置文档",-1)])})),_:1,__:[15]}),d(a,{label:"存储源名称",prop:"name"},{default:f((function(){return[d(r,{modelValue:g(N).name,"onUpdate:modelValue":t[0]||(t[0]=function(e){return g(N).name=e})},null,8,["modelValue"])]})),_:1}),d(a,{label:"存储源别名",prop:"key"},{default:f((function(){return[d(r,{modelValue:g(N).key,"onUpdate:modelValue":t[1]||(t[1]=function(e){return g(N).key=e})},null,8,["modelValue"]),v("div",he," 存储源别名，用于 URL 中展示, 如 "+h(g(ae)(g(n).serverAddress,g(N).key||"{存储源别名}")),1)]})),_:1}),d(a,{label:"存储源备注"},{default:f((function(){return[d(r,{type:"textarea",rows:3,placeholder:"请输入存储源备注",modelValue:g(N).remark,"onUpdate:modelValue":t[2]||(t[2]=function(e){return g(N).remark=e})},null,8,["modelValue"]),t[16]||(t[16]=v("div",{class:"el-form-item-tips"}," 存储源备注信息, 用于辅助管理员区分不同的存储源, 此字段仅管理员可见 ",-1))]})),_:1,__:[16]}),d(a,{label:"存储策略",prop:"type"},{default:f((function(){return[d(i,{disabled:g(oe),filterable:g(A),modelValue:g(N).type,"onUpdate:modelValue":t[3]||(t[3]=function(e){return g(N).type=e}),placeholder:"请选择存储策略"},{default:f((function(){return[(c(!0),s(b,null,w(g(D),(function(e){return c(),P(o,{key:e.key,label:e.description,value:e.key},null,8,["label","value"])})),128))]})),_:1},8,["disabled","filterable","modelValue"])]})),_:1}),d(a,{label:"是否启用"},{default:f((function(){return[d(u,{modelValue:g(N).enable,"onUpdate:modelValue":t[4]||(t[4]=function(e){return g(N).enable=e})},null,8,["modelValue"]),t[17]||(t[17]=v("div",{class:"el-form-item-tips"}," 如不启用，则在前台不显示，且不可访问. ",-1))]})),_:1,__:[17]}),d(a,{label:"是否默认打开画廊模式"},{default:f((function(){return[d(u,{modelValue:g(N).defaultSwitchToImgMode,"onUpdate:modelValue":t[5]||(t[5]=function(e){return g(N).defaultSwitchToImgMode=e})},null,8,["modelValue"]),t[18]||(t[18]=v("div",{class:"el-form-item-tips"}," 启用后，每次切换到此存储源，将自动打开画廊模式（适用于纯图片的存储源） ",-1))]})),_:1,__:[18]}),(c(!0),s(b,null,w(g(qe),(function(l){return c(),s("div",{key:l.key},[g(Ke)[l.key]?(c(),P(a,{key:0,label:l.name,required:l.required,prop:"storageSourceAllParam."+l.key},V({default:f((function(){var a,V;return["endPoint"===l.key&&("constant"in e?e.constant:g(x)).region.hasOwnProperty(g(N).type)?(c(),P(i,{key:0,filterable:g(A),"allow-create":"","default-first-option":"",style:{width:"100%"},modelValue:g(N).storageSourceAllParam.endPoint,"onUpdate:modelValue":t[6]||(t[6]=function(e){return g(N).storageSourceAllParam.endPoint=e})},{default:f((function(){return[(c(!0),s(b,null,w(("constant"in e?e.constant:g(x)).region[g(N).type],(function(e){return c(),P(o,{label:e.name,value:e.val,key:e.name},{default:f((function(){return[v("span",be,h(e.name),1),v("span",we,h(e.val),1)]})),_:2},1032,["label","value"])})),128))]})),_:1},8,["filterable","modelValue"])):"siteId"===l.key&&g(De)(g(N).type)?(c(),P(i,{key:1,filterable:g(A),placeholder:"请选择站点列表",modelValue:g(N).storageSourceAllParam.siteId,"onUpdate:modelValue":t[7]||(t[7]=function(e){return g(N).storageSourceAllParam.siteId=e}),class:"input-with-select"},{default:f((function(){return[(c(!0),s(b,null,w(g(Fe),(function(e){return c(),P(o,{key:e.id,label:e.displayName,value:e.id},{default:f((function(){return[v("span",ke,[m(h(e.displayName)+" ",1),"Communication site"===e.displayName?(c(),P(k,{key:0,type:"success"},{default:f((function(){return t[20]||(t[20]=[m("默认网站")])})),_:1,__:[20]})):j("",!0)]),d(_,{placement:"right",width:"400",trigger:"hover",content:e.webUrl},{reference:f((function(){return[d(S,{target:"_blank",icon:g(ue),href:e.webUrl,underline:!1,class:"float-right",type:"primary"},{default:f((function(){return t[21]||(t[21]=[m("查看网站")])})),_:2,__:[21]},1032,["icon","href"])]})),_:2},1032,["content"])]})),_:2},1032,["label","value"])})),128))]})),_:1},8,["filterable","modelValue"])):"listId"===l.key&&g(De)(g(N).type)?(c(),P(i,{key:2,filterable:g(A),placeholder:"请选择网站子目录",modelValue:g(N).storageSourceAllParam.listId,"onUpdate:modelValue":t[8]||(t[8]=function(e){return g(N).storageSourceAllParam.listId=e}),class:"input-with-select"},{default:f((function(){return[(c(!0),s(b,null,w(g(Ne),(function(l){return c(),P(o,{key:l.id,label:l.displayName,value:l.id},{default:f((function(){return[v("span",Se,[m(h(l.displayName)+" ",1),"Communication site"===l.displayName?(c(),P(k,{key:0,type:"success"},{default:f((function(){return t[22]||(t[22]=[m("默认网站")])})),_:1,__:[22]})):j("",!0)]),d(_,{placement:"right",width:"400",trigger:"hover",content:l.webUrl},{reference:f((function(){return[d(S,{target:"_blank",icon:e.Link,href:l.webUrl,underline:!1,class:"float-right",type:"primary"},{default:f((function(){return t[23]||(t[23]=[m("查看网站")])})),_:2,__:[23]},1032,["icon","href"])]})),_:2},1032,["content"])]})),_:2},1032,["label","value"])})),128))]})),_:1},8,["filterable","modelValue"])):"driveId"===l.key&&(null===(a=g(ye))||void 0===a?void 0:a.length)>0?(c(),P(i,{key:3,filterable:g(A),placeholder:"请选择驱动器列表",modelValue:g(N).storageSourceAllParam.driveId,"onUpdate:modelValue":t[9]||(t[9]=function(e){return g(N).storageSourceAllParam.driveId=e}),class:"input-with-select"},{default:f((function(){return[d(o,{value:"",label:"默认空间"},{default:f((function(){return[t[25]||(t[25]=v("span",{class:"float-left"}," 默认空间 ",-1)),v("span",_e,[d(k,{type:"primary",class:"float-right"},{default:f((function(){return t[24]||(t[24]=[m(" 个人盘 ")])})),_:1,__:[24]})])]})),_:1,__:[25]}),(c(!0),s(b,null,w(g(ye),(function(e){return c(),P(o,{key:e.id,label:e.name,value:e.id},{default:f((function(){return[v("span",Pe,h(e.name),1),d(_,{placement:"left",width:"400",trigger:"hover",content:e.id},{reference:f((function(){return[d(k,{type:"success",class:"float-right"},{default:f((function(){return t[26]||(t[26]=[m(" 团队盘 ")])})),_:1,__:[26]})]})),_:2},1032,["content"])]})),_:2},1032,["label","value"])})),128))]})),_:1},8,["filterable","modelValue"])):"bucketName"===l.key&&(null===(V=g(fe))||void 0===V?void 0:V.length)>0?(c(),P(i,{key:4,"allow-create":"",filterable:g(A),placeholder:"请选择存储器列表",modelValue:g(N).storageSourceAllParam.bucketName,"onUpdate:modelValue":t[10]||(t[10]=function(e){return g(N).storageSourceAllParam.bucketName=e}),class:"input-with-select"},{default:f((function(){return[(c(!0),s(b,null,w(g(fe),(function(e){return c(),P(o,{key:e.name,label:e.name,value:e.name},{default:f((function(){return[v("span",Ae,h(e.name),1),v("span",Ve,h(e.date),1)]})),_:2},1032,["label","value"])})),128))]})),_:1},8,["filterable","modelValue"])):"corsConfigList"===l.key?(c(),s("div",xe,[d(U,{modelValue:g(N).storageSourceAllParam.corsConfigList,"onUpdate:modelValue":t[11]||(t[11]=function(e){return g(N).storageSourceAllParam.corsConfigList=e})},null,8,["modelValue"]),v("div",{class:"text-sm text-gray-400",innerHTML:g(me)},null,8,je)])):"select"===l.type?(c(),P(i,{key:6,"allow-create":l.optionAllowCreate,filterable:g(A),"default-first-option":"",modelValue:g(N).storageSourceAllParam[l.key],"onUpdate:modelValue":function(e){return g(N).storageSourceAllParam[l.key]=e}},{default:f((function(){return[(c(!0),s(b,null,w(l.options,(function(e){return c(),P(o,{label:e.label,value:e.value},null,8,["label","value"])})),256))]})),_:2},1032,["allow-create","filterable","modelValue","onUpdate:modelValue"])):"switch"===l.type?(c(),P(u,{key:7,modelValue:g(N).storageSourceAllParam[l.key],"onUpdate:modelValue":function(e){return g(N).storageSourceAllParam[l.key]=e}},null,8,["modelValue","onUpdate:modelValue"])):"input"===l.type?(c(),s(b,{key:8},[We.includes(l.key)?(c(),P(r,{key:0,modelValue:g(N).storageSourceAllParam[l.key],"onUpdate:modelValue":function(e){return g(N).storageSourceAllParam[l.key]=e},modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])):(c(),P(r,{key:1,modelValue:g(N).storageSourceAllParam[l.key],"onUpdate:modelValue":function(e){return g(N).storageSourceAllParam[l.key]=e}},null,8,["modelValue","onUpdate:modelValue"]))],64)):"textarea"===l.type?(c(),P(r,{key:9,type:"textarea",modelValue:g(N).storageSourceAllParam[l.key],"onUpdate:modelValue":function(e){return g(N).storageSourceAllParam[l.key]=e}},null,8,["modelValue","onUpdate:modelValue"])):(c(),s("div",Ue," 服务端配置错误, 字段 "+h(l.key)+" 类型为 "+h(l.type)+", 不支持此类型的渲染. ",1)),v("div",Oe,[l.link?(c(),s("div",Ee,["accessToken"===l.key?(c(),s("span",Ie,[d(S,{target:"_blank",icon:g(ue),type:"info",href:l.link+"?clientId="+encodeURIComponent(g(N).storageSourceAllParam.clientId)+"&clientSecret="+encodeURIComponent(g(N).storageSourceAllParam.clientSecret)+"&redirectUri="+encodeURIComponent(g(N).storageSourceAllParam.redirectUri)},{default:f((function(){return[m(h(l.linkName),1)]})),_:2},1032,["icon","href"]),d(I,{onClick:function(e){return g(Be)(l.link+"?clientId="+encodeURIComponent(g(N).storageSourceAllParam.clientId)+"&clientSecret="+encodeURIComponent(g(N).storageSourceAllParam.clientSecret)+"&redirectUri="+encodeURIComponent(g(N).storageSourceAllParam.redirectUri))},class:"inline cursor-pointer ml-2 w-4 text-lg relative"},null,8,["onClick"])])):(c(),P(S,{key:1,target:"_blank",icon:g(ue),href:l.link},{default:f((function(){return[m(h(l.linkName),1)]})),_:2},1032,["icon","href"]))])):j("",!0),l.description?(c(),s("div",{key:1,innerHTML:l.description},null,8,Te)):j("",!0),"domain"===l.key&&g(N).storageSourceAllParam.domain?(c(),s("div",Ce,[t[28]||(t[28]=m(" 注意: ")),v("ul",null,[p(v("li",He,"如果你的 zfile 是 https，则该存储源的下载域名也应是 https，否则可能会影响预览/下载!",512),[[y,g(Ge)]]),t[27]||(t[27]=v("li",null,"需域名支持跨域访问，否则也可能会导致下载/预览失败.",-1))])])):j("",!0),"redirectUri"===l.key&&l.description&&["onedrive","sharepoint"].includes(g(N).type)?(c(),s("div",ze,[m(" 如："+h(g(ae)(g(n).serverAddress,"onedrive/callback"))+" ",1),d(I,{onClick:t[12]||(t[12]=function(e){return g(Be)(g(ae)(g(n).serverAddress,"onedrive/callback"))}),class:"inline cursor-pointer ml-1"})])):j("",!0),"redirectUri"===l.key&&l.description&&["onedrive-china","sharepoint-china"].includes(g(N).type)?(c(),s("div",Me,[m(" 如："+h(g(ae)(g(n).serverAddress,"onedrive/china-callback"))+" ",1),d(I,{onClick:t[13]||(t[13]=function(e){return g(Be)(g(ae)(g(n).serverAddress,"onedrive/china-callback"))}),class:"inline cursor-pointer ml-1"})])):j("",!0),"redirectUri"===l.key&&l.description&&"google-drive"===g(N).type?(c(),s("div",Le,[m(" 如："+h(g(ae)(g(n).serverAddress,"gd/callback"))+" ",1),d(I,{onClick:t[14]||(t[14]=function(e){return g(Be)(g(ae)(g(n).serverAddress,"gd/callback"))}),class:"inline cursor-pointer ml-1"})])):j("",!0)])]})),_:2},[l.pro?{name:"label",fn:f((function(){return[m(h(l.name)+" ",1),t[19]||(t[19]=v("span",{class:"badge-blue"},"Pro",-1))]})),key:"0"}:void 0]),1032,["label","required","prop"])):j("",!0)])})),128)),d(a,{"label-width":g(n).adminForm.labelWidth,class:"admin-from-footer"},{default:f((function(){return[d(H,{class:"ml-auto",type:"primary",icon:g(L),loading:g(q),onClick:M},{default:f((function(){return t[29]||(t[29]=[m("保存设置")])})),_:1,__:[29]},8,["icon","loading"])]})),_:1},8,["label-width"])]})),_:1},8,["model","label-width","label-position","size","rules"])}}};"function"==typeof oe&&oe(Fe);e("default",ie(Fe,[["__scopeId","data-v-46fd4c99"]]))}}}))}();
