System.register(["./index-legacy-e574cec8.js","./loading-legacy-2688a411.js","./dialog-legacy-5ef05c71.js","./overlay-legacy-6ebb9437.js","./table-column-legacy-0040b455.js","./checkbox-legacy-80a8805e.js","./tooltip-legacy-518b8698.js","./popper-legacy-ef8fd66b.js","./scrollbar-legacy-0817fabf.js","./tag-legacy-5e0686c8.js","./form-item-legacy-de8da7e8.js","./tab-pane-legacy-04f72dff.js","./select-legacy-8b64fa67.js","./input-legacy-bc871eba.js","./input-number-legacy-c1d86df3.js","./ArrowUpIcon-legacy-896909a5.js","./button-legacy-f53896dd.js","./radio-legacy-bf353ae9.js","./switch-legacy-a4b2d82c.js","./useAdminSetting-legacy-246910c5.js","./admin-storage-legacy-6381f83d.js","./useClientInfo-legacy-47dbf540.js","./_plugin-vue_export-helper-legacy-8fcf0e06.js","./request-legacy-61b983ae.js","./CheckBadgeIcon-legacy-a01a5b9d.js","./index-legacy-69b9ad2b.js","./directive-legacy-64af483a.js","./index-legacy-b5baaeae.js","./vnode-legacy-bdad68af.js","./index-legacy-c317e588.js","./scroll-legacy-68db505b.js","./refs-legacy-1635e56d.js","./strings-legacy-b2510e8b.js","./index-legacy-1ae34dc2.js","./index-legacy-ea3d196e.js","./index-legacy-183af9d3.js","./debounce-legacy-321ba92e.js","./index-legacy-d493f4b0.js","./_initCloneObject-legacy-b35b9836.js","./index-legacy-e86b74e4.js","./validator-legacy-a3ca6880.js"],(function(e,l){"use strict";var n,t,a,u,o,i,r,s,d,c,f,m,p,v,g,b,h,y,x,_,w,V,k,j,C,L,P,I,z,U,E,T,F,A,D,R,S,Z,B,M,H,W,N,O,q,X,G,Q,$,J,K;return{setters:[function(e){n=e.b,t=e.g,a=e.x,u=e.r,o=e.B,i=e.f,r=e.F,s=e.G,d=e.k,c=e.aB,f=e.w,m=e.a8,p=e.e,v=e.h,g=e.$,b=e.a1,h=e.y,y=e.l,x=e.aC,_=e.a3,w=e.a2,V=e.a0,k=e.aD},null,function(e){j=e.E},null,null,null,null,null,null,null,null,function(e){C=e.E,L=e.a},function(e){P=e.E,I=e.a},function(e){z=e.E,U=e.a},function(e){E=e.E},function(e){T=e.r,F=e.a},function(e){A=e.E},function(e){D=e.E,R=e.a},function(e){S=e.E},function(e){Z=e.g,B=e.u,M=e.b,H=e.t},function(e){W=e.e},function(e){N=e.u},function(e){O=e._},function(e){q=e.d,X=e.c,G=e.b},function(e){Q=e.r},function(e){$=e.E,J=e.a},function(e){K=e.v},null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){var l=document.createElement("style");function Y(e,l){return n(),t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[a("path",{"fill-rule":"evenodd",d:"M4.755 10.059a7.5 7.5 0 0 1 12.548-3.364l1.903 1.903h-3.183a.75.75 0 1 0 0 1.5h4.992a.75.75 0 0 0 .75-.75V4.356a.75.75 0 0 0-1.5 0v3.18l-1.9-1.9A9 9 0 0 0 3.306 9.67a.75.75 0 1 0 1.45.388Zm15.408 3.352a.75.75 0 0 0-.919.53 7.5 7.5 0 0 1-12.548 3.364l-1.902-1.903h3.183a.75.75 0 0 0 0-1.5H2.984a.75.75 0 0 0-.75.75v4.992a.75.75 0 0 0 1.5 0v-3.18l1.9 1.9a9 9 0 0 0 15.059-4.035.75.75 0 0 0-.53-.918Z","clip-rule":"evenodd"})])}function ee(e,l){return n(),t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[a("path",{d:"M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"}),a("path",{"fill-rule":"evenodd",d:"M1.323 11.447C2.811 6.976 7.028 3.75 12.001 3.75c4.97 0 9.185 3.223 10.675 7.69.12.362.12.752 0 1.113-1.487 4.471-5.705 7.697-10.677 7.697-4.97 0-9.186-3.223-10.675-7.69a1.762 1.762 0 0 1 0-1.113ZM17.25 12a5.25 5.25 0 1 1-10.5 0 5.25 5.25 0 0 1 10.5 0Z","clip-rule":"evenodd"})])}function le(e,l){return n(),t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[a("path",{"fill-rule":"evenodd",d:"M4.25 12a.75.75 0 0 1 .75-.75h14a.75.75 0 0 1 0 1.5H5a.75.75 0 0 1-.75-.75Z","clip-rule":"evenodd"})])}function ne(e,l){return n(),t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[a("path",{"fill-rule":"evenodd",d:"M12 3.75a.75.75 0 0 1 .75.75v6.75h6.75a.75.75 0 0 1 0 1.5h-6.75v6.75a.75.75 0 0 1-1.5 0v-6.75H4.5a.75.75 0 0 1 0-1.5h6.75V4.5a.75.75 0 0 1 .75-.75Z","clip-rule":"evenodd"})])}l.textContent=".zfile-admin-down-link-body[data-v-3f4df69f] .el-tabs__content{margin-top:-20px}.zfile-admin-down-link-body[data-v-3f4df69f] .el-form{padding:0}\n",document.head.appendChild(l);var te={key:0,class:"flex flex-wrap w-full"},ae={class:"flex items-center"},ue=["onClick"],oe=["onClick"],ie=["onClick"],re=["onClick"],se={class:"ml-3 text-gray-500"},de={__name:"TimePicker",props:{modelValue:{type:Array,required:!0}},emits:["update:modelValue"],setup:function(e,l){var _=l.emit,w=e,V=u(w.modelValue?w.modelValue:[{value:"1",unit:"d",second:86400}]),k=_;o(V,(function(e){k("update:modelValue",e)}),{deep:!0});var j=function(e){e.seconds=x(e)};return function(e,l){var u=E,o=P,x=I;return i(V)?(n(),t("div",te,[(n(!0),t(r,null,s(w.modelValue,(function(l,y){return n(),t("div",{key:l.second,class:"mb-4 w-full"},[a("div",ae,[d(u,{class:"min-w-[100px]",modelValue:l.value,"onUpdate:modelValue":function(e){return l.value=e},min:1,max:i(c)(l.unit),onChange:function(e){return j(l)},disabled:"forever"===l.unit},null,8,["modelValue","onUpdate:modelValue","max","onChange","disabled"]),d(x,{onChange:function(e){return j(l)},modelValue:l.unit,"onUpdate:modelValue":function(e){return l.unit=e},class:"ml-1 min-w-[75px]"},{default:f((function(){return[(n(!0),t(r,null,s(("constant"in e?e.constant:i(m)).timeUnitArr,(function(e){return n(),p(o,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])})),128))]})),_:2},1032,["onChange","modelValue","onUpdate:modelValue"]),a("button",{class:v([0===y?"invisible":"visible","ml-2 py-2 px-2 rounded-md bg-blue-500 text-white hover:bg-blue-600 focus:bg-blue-700 focus:outline-none font-bold"]),type:"button",onClick:function(e){return function(e){if(0!==e){var l=V.value[e];V.value.splice(e,1),V.value.splice(e-1,0,l)}}(y)}},[d(i(T),{class:"h-4"})],10,ue),g(a("button",{type:"button",onClick:function(e){return function(e){if(e!==V.value.length-1){var l=V.value[e];V.value.splice(e,1),V.value.splice(e+1,0,l)}}(y)},class:"ml-2 py-2 px-2 rounded-md bg-blue-500 text-white hover:bg-blue-600 focus:bg-blue-700 focus:outline-none font-bold"},[d(i(F),{class:"h-4"})],8,oe),[[b,y!==i(V).length-1]]),g(a("button",{type:"button",onClick:function(e){return function(e){V.value.splice(e,0,{value:1,unit:"s",second:1})}(y+1)},class:"ml-2 py-2 px-2 rounded-md bg-blue-500 text-white hover:bg-blue-600 focus:bg-blue-700 focus:outline-none font-bold"},[d(i(ne),{class:"h-4"})],8,ie),[[b,y===i(V).length-1]]),g(a("button",{type:"button",onClick:function(e){return function(e){V.value.splice(e,1)}(y)},class:"ml-2 py-2 px-2 rounded-md bg-red-500 text-white hover:bg-red-600 focus:bg-red-700 focus:outline-none font-bold"},[d(i(le),{class:"h-4"})],8,re),[[b,i(V).length>1]])]),a("small",se,h(l.formatted),1)])})),128))])):y("",!0)}}},ce=u([]);function fe(){return{linkLimitInfoList:ce,loadLinkLimitInfo:function(){Z().then((function(e){ce.value=e.data}))}}}var me={class:"zfile-admin-down-link-body"},pe={class:"el-form-item-tips"},ve={key:0},ge={key:1},be={class:"mt-4"},he={class:"text-blue-500"},ye={class:"el-form-item-tips"},xe={class:"text-blue-400 select-all"},_e={class:"el-form-item-tips"},we={class:"select-all"},Ve={class:"text-red-400 font-bold"},ke={class:"text-blue-400"},je={class:"text-blue-400"},Ce={class:"text-blue-400"},Le={class:"text-center text-gray-400"},Pe={class:"dialog-footer"},Ie={__name:"basic-setting",setup:function(e){var l=_(),o=u(),s=B(M,o),c=s.siteSetting,x=s.saveData,P=s.saveLoading,I=N().clientIp,T=fe(),F=T.loadLinkLimitInfo,Z=T.linkLimitInfoList,O=u("a"),le={directLinkPrefix:[{required:!0,message:"直链前缀不能为空",trigger:"change"},{validator:function(e,l,n){null!=l&&""!==l?m.systemNames.includes(l)?n(new Error("不可占用系统级名称，请修改。")):/^[\w\-]+$/.test(l)?W({storageKey:l}).then((function(e){e.data?n(new Error("不可与存储源别名重复，请修改。")):n()})):n(new Error("只允许使用字母、数字、下划线、横杠。")):n()}}]},ne=u(""),te=u(null),ae=k((function(){var e,l={ruleType:"antPath",rules:null==c||null===(e=c.value)||void 0===e?void 0:e.refererValue,testValue:ne.value};l.rules&&l.testValue?H(l).then((function(e){te.value=e.data})):null!==te.value&&(te.value=null)}),250),ue=u(!1),oe=function(){F(),ue.value=!0};return function(e,u){var s=S,m=z,_=D,k=R,T=G,B=E,M=A,H=C,W=de,N=L,ie=U,re=$,se=J,ce=j,fe=K;return n(),t(r,null,[a("div",me,[i(c)?g((n(),p(ie,{key:0,model:i(c),rules:le,"label-width":i(l).adminForm.labelWidth,"label-position":i(l).adminForm.labelPosition,size:i(l).adminForm.size,"status-icon":"",class:"z-admin-form",ref_key:"settingFormRef",ref:o,"element-loading-text":"保存中..."},{default:f((function(){return[d(N,{modelValue:i(O),"onUpdate:modelValue":u[11]||(u[11]=function(e){return w(O)?O.value=e:null})},{default:f((function(){return[d(H,{label:"通用设置",name:"a"},{default:f((function(){return[d(m,{label:"记录下载日志"},{default:f((function(){return[d(s,{modelValue:i(c).recordDownloadLog,"onUpdate:modelValue":u[0]||(u[0]=function(e){return i(c).recordDownloadLog=e})},null,8,["modelValue"]),u[15]||(u[15]=a("div",{class:"el-form-item-tips"}," 是否记录直/短链下载日志 ",-1))]})),_:1,__:[15]}),d(m,{label:"Referer 防盗链"},{default:f((function(){return[d(k,{modelValue:i(c).refererType,"onUpdate:modelValue":u[1]||(u[1]=function(e){return i(c).refererType=e})},{default:f((function(){return[d(_,{value:"off"},{default:f((function(){return u[16]||(u[16]=[V("不启用 Referer 防盗链")])})),_:1,__:[16]}),d(_,{value:"white_list"},{default:f((function(){return u[17]||(u[17]=[V("启用白名单")])})),_:1,__:[17]}),d(_,{value:"black_list"},{default:f((function(){return u[18]||(u[18]=[V("启用黑名单")])})),_:1,__:[18]})]})),_:1},8,["modelValue"]),u[19]||(u[19]=a("div",{class:"el-form-item-tips"}," 防盗链支持访问文件直链或短链时校验，如用户直接访问直链跳转后的存储源原始链接，无法进行校验和拦截。 ",-1))]})),_:1,__:[19]}),g(d(m,{label:"Referer 配置"},{default:f((function(){return[d(k,{modelValue:i(c).refererAllowEmpty,"onUpdate:modelValue":u[2]||(u[2]=function(e){return i(c).refererAllowEmpty=e})},{default:f((function(){return[d(_,{value:!0},{default:f((function(){return u[20]||(u[20]=[V("允许 Referer 为空")])})),_:1,__:[20]}),d(_,{value:!1},{default:f((function(){return u[21]||(u[21]=[V("禁止 Referer 为空")])})),_:1,__:[21]})]})),_:1},8,["modelValue"])]})),_:1},512),[[b,"off"!==i(c).refererType]]),g(d(m,{label:"white_list"===i(c).refererType?"白名单":"黑名单"},{default:f((function(){return[d(T,{type:"textarea",onInput:i(ae),rows:6,modelValue:i(c).refererValue,"onUpdate:modelValue":u[3]||(u[3]=function(e){return i(c).refererValue=e})},null,8,["onInput","modelValue"]),a("div",pe,[u[24]||(u[24]=V(" 每行输入一个域名，如： ")),u[25]||(u[25]=a("ul",null,[a("li",null,[V("限制泛域名 "),a("span",{class:"text-red-400"},"http 协议"),V(" 全部子目录可访问： "),a("div",{class:"inline select-all font-bold"},[a("span",{class:"text-red-400"},"http://"),V("*example.com/** ")])]),a("li",null,[V("限制泛域名 "),a("span",{class:"text-red-400"},"https 协议"),V(" 全部子目录可访问： "),a("div",{class:"inline select-all font-bold"},[a("span",{class:"text-red-400"},"https://"),V("*example.com/** ")])]),a("li",null,[V("限制泛域名 "),a("span",{class:"text-red-400"},"全部协议"),V(" 全部子目录可访问： "),a("div",{class:"inline select-all font-bold"},[a("span",{class:"text-red-400"},"*://"),V("*example.com/** ")])])],-1)),"white_list"===i(c).refererType?(n(),t("div",ve," 每行输入一个域名，需要写协议头支持 * 通配符，如白名单 http://*zfile.vip 将只允许 http://zfile.vip、http://www.zfile.vip、http://demo.zfile.vip 等网站访问。 ")):y("",!0),"black_list"===i(c).refererType?(n(),t("div",ge," 每行输入一个域名，需要写协议头，支持 * 通配符，如黑名单 http://*zfile.vip 将禁止所有如 http://zfile.vip、http://www.zfile.vip、http://demo.zfile.vip 等网站访问。 ")):y("",!0),a("div",be,[u[23]||(u[23]=a("div",null,"可在下方输入你要测试的地址，应包含协议和路径（如 http://example.com/1.html）",-1)),d(T,{onInput:i(ae),modelValue:i(ne),"onUpdate:modelValue":u[4]||(u[4]=function(e){return w(ne)?ne.value=e:null})},{suffix:f((function(){return[i(ne)&&null===i(te)?(n(),p(i(q),{key:0,class:"w-4 text-red-500"})):i(ne)&&null!==i(te)?(n(),p(i(X),{key:1,class:"w-4 text-green-500"})):y("",!0)]})),_:1},8,["onInput","modelValue"]),g(a("div",null,[u[22]||(u[22]=V("输入的测试地址匹配了规则: ")),a("span",he,h(i(te)),1)],512),[[b,i(te)]])])])]})),_:1},8,["label"]),[[b,"off"!==i(c).refererType]]),d(m,{label:"下载频率限制"},{default:f((function(){return[a("div",null,[u[27]||(u[27]=a("span",null,"单 IP",-1)),d(B,{modelValue:i(c).linkLimitSecond,"onUpdate:modelValue":u[5]||(u[5]=function(e){return i(c).linkLimitSecond=e}),min:0,max:86400,step:1,size:"small",class:"mx-2"},null,8,["modelValue"]),u[28]||(u[28]=a("span",null,"秒内允许下载",-1)),d(B,{modelValue:i(c).linkDownloadLimit,"onUpdate:modelValue":u[6]||(u[6]=function(e){return i(c).linkDownloadLimit=e}),min:0,max:9999999,step:1,size:"small",class:"mx-2"},null,8,["modelValue"]),u[29]||(u[29]=a("span",null,"次",-1)),d(M,{icon:i(ee),size:"small",type:"primary",class:"ml-2",onClick:oe},{default:f((function(){return u[26]||(u[26]=[V("统计信息 ")])})),_:1,__:[26]},8,["icon"])]),a("div",ye,[u[32]||(u[32]=a("span",null,"用来防止恶意下载，单 IP N 秒内只允许访问 M 次直链，如其中一个为 0 则不做任何限制.",-1)),u[33]||(u[33]=a("br",null,null,-1)),u[34]||(u[34]=a("br",null,null,-1)),u[35]||(u[35]=a("span",null,"注意：此功能对直链、短链都有效，且共享限制次数。但直链/短链跳转后的实际下载链接无法限制，因为那些链接不经过 ZFile.",-1)),u[36]||(u[36]=a("br",null,null,-1)),u[37]||(u[37]=a("br",null,null,-1)),a("span",null,[u[30]||(u[30]=V('注意：如果你使用了反向代理，而不是直接访问的 ZFile 端口, 那你需要在反向代理处设置以下请求头为用户真实 IP："X-Forwarded-For", "X-Real-IP", "Proxy-Client-IP", "WL-Proxy-Client-IP", "HTTP_CLIENT_IP", "HTTP_X_FORWARDED_FOR"，不然不论谁访问 ZFile 都只能获取到反代服务器的 IP，同服务器一般是获取到 127.0.0.1 或 localhost, 这样此功能就无法正常使用!!! (辅助信息: 系统获取到您当前 IP 为 ')),a("span",xe,h(i(I)),1),u[31]||(u[31]=V(")"))])])]})),_:1})]})),_:1}),d(H,{label:"直链设置",name:"b"},{default:f((function(){return[d(m,{label:"是否允许使用直链（路径）"},{default:f((function(){return[d(s,{modelValue:i(c).showPathLink,"onUpdate:modelValue":u[7]||(u[7]=function(e){return i(c).showPathLink=e})},null,8,["modelValue"]),u[38]||(u[38]=a("div",{class:"el-form-item-tips"},[V(" 全局控制是否显示获取直链按钮及是否允许使用直链进行下载，"),a("span",{class:"font-bold"},"优先级大于存储源权限设置.")],-1))]})),_:1,__:[38]}),d(m,{label:"直链地址前缀",prop:"directLinkPrefix"},{default:f((function(){return[d(T,{modelValue:i(c).directLinkPrefix,"onUpdate:modelValue":u[8]||(u[8]=function(e){return i(c).directLinkPrefix=e})},null,8,["modelValue"]),a("div",_e,[u[40]||(u[40]=V(" 直链地址前缀, 如 ")),a("span",we,[V(h(l.serverAddress.endsWith("/")?l.serverAddress:l.serverAddress+"/"),1),a("span",Ve,h(i(c).directLinkPrefix),1),u[39]||(u[39]=V("/path/filename"))])])]})),_:1})]})),_:1}),d(H,{label:"短链设置",name:"c"},{default:f((function(){return[d(m,{label:"是否允许使用短链"},{default:f((function(){return[d(s,{modelValue:i(c).showShortLink,"onUpdate:modelValue":u[9]||(u[9]=function(e){return i(c).showShortLink=e})},null,8,["modelValue"]),u[41]||(u[41]=a("div",{class:"el-form-item-tips"},[V(" 全局控制是否显示生成短链按钮及是否允许使用已存在的短链进行下载，"),a("span",{class:"font-bold"},"优先级大于存储源权限设置.")],-1))]})),_:1,__:[41]}),d(m,{label:"短链有效期"},{default:f((function(){return[d(W,{modelValue:i(c).linkExpireTimes,"onUpdate:modelValue":u[10]||(u[10]=function(e){return i(c).linkExpireTimes=e})},null,8,["modelValue"]),u[42]||(u[42]=a("div",{class:"el-form-item-tips"}," 控制生成短链的有效期 ",-1))]})),_:1,__:[42]})]})),_:1})]})),_:1},8,["modelValue"]),d(m,{"label-width":i(l).adminForm.labelWidth,class:"admin-from-footer"},{default:f((function(){return[d(M,{class:"ml-auto",type:"primary",size:i(l).adminForm.size,icon:i(Q),loading:i(P),onClick:u[12]||(u[12]=function(e){return i(x)(!0)})},{default:f((function(){return u[43]||(u[43]=[V(" 保存设置 ")])})),_:1,__:[43]},8,["size","icon","loading"])]})),_:1},8,["label-width"])]})),_:1},8,["model","label-width","label-position","size"])),[[fe,i(P)]]):y("",!0)]),d(ce,{"append-to-body":"",title:"统计信息",modelValue:i(ue),"onUpdate:modelValue":u[14]||(u[14]=function(e){return w(ue)?ue.value=e:null}),width:"80%",top:"5vh"},{footer:f((function(){return[a("span",Pe,[d(M,{onClick:u[13]||(u[13]=function(e){return ue.value=!1})},{default:f((function(){return u[47]||(u[47]=[V("关 闭")])})),_:1,__:[47]})])]})),default:f((function(){return[a("span",null,[u[44]||(u[44]=V("当前系统限制单 IP ")),a("span",ke,h(i(c).linkLimitSecond),1),u[45]||(u[45]=V(" 秒内下载 ")),a("span",je,h(i(c).linkDownloadLimit),1),u[46]||(u[46]=V(" 次，已记录 ")),a("span",Ce,h(i(Z).length),1),V(" 条记录。（超出 "+h(i(c).linkLimitSecond)+" 秒的记录将被清除。）",1)]),d(i(Y),{onClick:i(F),class:"w-4 inline-block cursor-pointer hover:text-blue-400"},null,8,["onClick"]),d(se,{data:i(Z),"max-height":"400px"},{empty:f((function(){return[a("div",Le,h(i(c).linkLimitSecond)+" 秒内没有任何下载记录",1)]})),default:f((function(){return[d(re,{prop:"key",label:"IP"}),d(re,{prop:"count",label:"次数"},{default:f((function(e){var l=e.row;return[a("div",{class:v([l.value>i(c).linkDownloadLimit?"text-red-500":""])},h(l.value),3)]})),_:1}),d(re,{prop:"ttl",label:"统计区间"},{default:f((function(e){var l=e.row;return[V(h(l.ttl/1e3)+" 秒 ",1)]})),_:1}),d(re,{prop:"expiredTime",label:"过期时间"})]})),_:1},8,["data"])]})),_:1},8,["modelValue"])],64)}}};e("default",O(Ie,[["__scopeId","data-v-3f4df69f"]]))}}}));
